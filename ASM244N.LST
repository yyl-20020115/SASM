     1                                  ; Seattle Computer Products 8086 Assembler  version 2.44
     2                                  ;   by Tim Paterson
     3                                  ; Runs on the 8086 under MS-DOS
     4                                  
     5                                  ;* * * * * * REVISION HISTORY * * * * * *
     6                                  ;
     7                                  ; 12/29/80  2.01  General release with 86-DOS version 0.34
     8                                  ; 02/22/81  2.10  Increased buffer size from 128 bytes to 1024 bytes
     9                                  ; 03/18/81  2.11  General cleanup and more documentation
    10                                  ; 03/24/81  2.20  Modify ESC handling for full 8087 operation
    11                                  ; 04/01/81  2.21  Fix date in HEX and PRN files; modify buffer handling
    12                                  ; 04/03/81  2.22  Fix 2.21 buffer handling
    13                                  ; 04/13/81  2.23  Re-open source file for listing to allow assembling CON:
    14                                  ; 04/28/81  2.24  Allow nested IFs
    15                                  ; 07/30/81  2.25  Add Intel string mnemonics; clean up a little
    16                                  ; 08/02/81  2.30  Re-write pass 2:
    17                                  ;			Always report errors to console
    18                                  ;			Exact byte lengths for HEX and PRN files
    19                                  ; 11/08/81  2.40  Add 8087 mnemonics; print full error messages;
    20                                  ;		  allow expressions with *, /, and ()
    21                                  ; 07/04/82  2.41  Fix Intel's 8087 "reverse-bit" bug; don't copy date
    22                                  ; 08/18/82  2.42  Increase stack from 80 to 256 (Damn! Overflowed again!)
    23                                  ; 01/05/83  2.43  Correct over-zealous optimization in 2.42
    24                                  ; 05/09/83  2.44  Add memory usage report
    25                                  ;
    26                                  ;* * * * * * * * * * * * * * * * * * * * *
    27                                  
    28                                  SYMWID:	EQU	5	;5 symbols per line in dump
    29                                  FCB:	EQU	5CH
    30                                  BUFSIZ:	EQU	1024	;Source code buffer
    31                                  LSTBUFSIZ:EQU	BUFSIZ	;List file buffer
    32                                  HEXBUFSIZ:EQU	70	;Hex file buffer (26*2 + 5*2 + 3 + EXTRA)
    33                                  EOL:	EQU	13	;ASCII carriage return
    34                                  OBJECT:	EQU	100H	;UDDEFAULT "PUT" ADDRESS
    35                                  
    36                                  ;System call function codes
    37                                  PRINTMES: EQU	9
    38                                  OPEN:	EQU	15
    39                                  CLOSE:	EQU	16
    40                                  READ:	EQU	20
    41                                  SETDMA:	EQU	26
    42                                  MAKE:	EQU	22
    43                                  BLKWRT:	EQU	40
    44                                  
    45                                  ;The following equates define some token values returned by GETSYM
    46                                  UNDEFID:EQU	0	;Undefined identifier (including no nearby RET)
    47                                  CONST:	EQU	1	;Constant (including $)
    48                                  REG:	EQU	2	;8-bit register
    49                                  XREG:	EQU	3	;16-bit register (except segment registers)
    50                                  SREG:	EQU	4	;Segment register
    51                                  FREG:	EQU	6	;8087 floating point register
    52                                  
    53                                  ;Bits to build 8087 opcode table entries
    54                                  ONEREG:	EQU	40H	;Single ST register OK as operand
    55                                  NEEDOP:	EQU	80H	;Must have an operand
    56                                  INTEGER:EQU	20H	;For integer operations
    57                                  REAL:	EQU	28H	;For real operations
    58                                  EXTENDED EQU	10H	;For Long integers or Temporary real
    59                                  MEMORY:	EQU	18H	;For general memory operations
    60                                  STACKOP:EQU	10H	;Two register arithmetic with pop
    61                                  ARITH:	EQU	8	;Non-pop arithmetic operations
    62                                  
    63                                  	org	0100H
    64 00000000 EB74                    	JMP	BEGIN
    65                                  
    66 00000002 0D0A53656174746C65-     HEADER:	DB	13,10,'Seattle Computer Products 8086 Assembler Version 2.44'
    66 0000000B 20436F6D7075746572-
    66 00000014 2050726F6475637473-
    66 0000001D 203830383620417373-
    66 00000026 656D626C6572205665-
    66 0000002F 7273696F6E20322E34-
    66 00000038 34                 
    67 00000039 0D0A436F7079726967-     	DB	13,10,'Copyright 1979-1983 by Seattle Computer Products, Inc.'
    67 00000042 687420313937392D31-
    67 0000004B 393833206279205365-
    67 00000054 6174746C6520436F6D-
    67 0000005D 70757465722050726F-
    67 00000066 64756374732C20496E-
    67 0000006F 632E               
    68 00000071 0D0A0D0A24              	DB	13,10,13,10,'$'
    69                                  
    70                                  BEGIN:
    71 00000076 BC[F829]                	MOV	SP,STACK
    72 00000079 BA[0200]                	MOV	DX,HEADER
    73 0000007C B409                    	MOV	AH,PRINTMES
    74 0000007E CD21                    	INT	33
    75 00000080 A06D00                  	MOV	AL,[FCB+17]
    76 00000083 A2[8620]                	MOV	[SYMFLG],AL	;Save symbol table request flag
    77 00000086 BE6500                  	MOV	SI,FCB+9	;Point to file extension
    78 00000089 AC                      	LODSB			;Get source drive letter
    79 0000008A E81401                  	CALL	CHKDSK		;Valid drive?
    80 0000008D 08C0                    	OR	AL,AL
    81 0000008F 7403                    	JZ	UDDEFAULT		;If no extension, use existing drive spec
    82 00000091 A25C00                  	MOV	[FCB],AL
    83                                  UDDEFAULT:
    84 00000094 AC                      	LODSB			;Get HEX file drive letter
    85 00000095 3C5A                    	CMP	AL,'Z'		;Suppress HEX file?
    86 00000097 7403                    	JZ	L0000
    87 00000099 E80501                  	CALL	CHKDSK
    88                                  L0000:	
    89 0000009C A2[D11F]                	MOV	[HEXFCB],AL
    90 0000009F AC                      	LODSB			;Get PRN file drive letter
    91 000000A0 B400                    	MOV	AH,0		;Signal no PRN file
    92 000000A2 3C5A                    	CMP	AL,'Z'		;Suppress PRN file?
    93 000000A4 7415                    	JZ	NOPRN
    94 000000A6 3C59                    	CMP	AL,'Y'		;Print errors only on console?
    95 000000A8 7411                    	JZ	NOPRN
    96 000000AA B402                    	MOV	AH,2
    97 000000AC 3C58                    	CMP	AL,'X'		;PRN file to console?
    98 000000AE 740B                    	JZ	NOPRN
    99 000000B0 B404                    	MOV	AH,4
   100 000000B2 3C50                    	CMP	AL,'P'		;PRN file to printer?
   101 000000B4 7405                    	JZ	NOPRN
   102 000000B6 E8E800                  	CALL	CHKDSK
   103 000000B9 B480                    	MOV	AH,80H
   104                                  NOPRN:
   105 000000BB A2[F61F]                	MOV	[LSTFCB],AL
   106 000000BE 8826[A320]              	MOV	[LSTDEV],AH	;Flag device for list ouput
   107 000000C2 BE[C01F]                	MOV	SI,EXTEND
   108 000000C5 BF6500                  	MOV	DI,FCB+9
   109 000000C8 A5                      	MOVSW
   110 000000C9 A4                      	MOVSB			;Set extension to ASM
   111 000000CA A5                      	MOVSW			;Zero extent field
   112 000000CB BA5C00                  	MOV	DX,FCB
   113 000000CE B40F                    	MOV	AH,OPEN
   114 000000D0 CD21                    	INT	33
   115 000000D2 BB[3B1F]                	MOV	BX,NOFILE
   116 000000D5 08C0                    	OR	AL,AL
   117 000000D7 7403                    	JZ	$+5
   118 000000D9 E99A00                  	JMP	PRERR
   119 000000DC BA[D11F]                	MOV	DX,HEXFCB
   120 000000DF E89C00                  	CALL	MAKFIL
   121 000000E2 BA[F61F]                	MOV	DX,LSTFCB
   122 000000E5 E89600                  	CALL	MAKFIL
   123 000000E8 31C0                    	XOR	AX,AX
   124 000000EA A36800                  	MOV	[FCB+12],AX	;Zero CURRENT BLOCK field
   125 000000ED A27C00                  	MOV	[FCB+32],AL	;Zero Next Record field
   126 000000F0 C7066A000004            	MOV	WORD[FCB+14],BUFSIZ	;Set record size
   127 000000F6 C706[F524][F724]        	MOV	WORD[BUFPT],SRCBUF	;Initialize buffer pointer
   128 000000FC C706[8820][F929]        	MOV	WORD[CODE],START+1	;POINTER TO NEXT BYTE OF INTERMEDIATE CODE
   129 00000102 C706[A920][F829]        	MOV	WORD[IY],START	;POINTER TO CURRENT RELOCATION BYTE
   130 00000108 31C0                    	XOR	AX,AX
   131 0000010A A3[1B20]                	MOV	[PC],AX		;UDDEFAULT PROGRAM COUNTER
   132 0000010D A3[8220]                	MOV	[BASE],AX	;POINTER TO ROOT OF ID TREE=NIL
   133 00000110 A3[A120]                	MOV	[RETPT],AX	;Pointer to last RET record
   134 00000113 A2[9B20]                	MOV	[IFFLG],AL	;NOT WITHIN IF/ENDIF
   135 00000116 A2[9C20]                	MOV	[CHKLAB],AL	;LOOKUP ALL LABELS
   136 00000119 48                      	DEC	AX
   137 0000011A A3[9F20]                	MOV	[LSTRET],AX	;Location of last RET
   138 0000011D A10600                  	MOV	AX,[6]		;HL=END OF MEMORY
   139 00000120 A3[8420]                	MOV	[HEAP],AX	;BACK END OF SYMBOL TABLE SPACE
   140 00000123 C706[8C20]0400          	MOV	WORD[BCOUNT],4	;CODE BYTES PER RELOCATION BYTE
   141                                  
   142                                  ;Assemble each line of code
   143                                  
   144                                  LOOP:
   145 00000129 E88A00                  	CALL	NEXTCHR		;Get first character on line
   146 0000012C 3C1A                    	CMP	AL,1AH
   147 0000012E 741E                    	JZ	ENDJ
   148 00000130 B0FF                    	MOV	AL,-1		;Flag that no tokens have been read yet
   149 00000132 A2[8120]                	MOV	[SYM],AL
   150 00000135 E81B07                  	CALL	ASMLIN		;Assemble the line
   151 00000138 A0[8120]                	MOV	AL,[SYM]
   152 0000013B 3CFF                    	CMP	AL,-1		;Any tokens found on line?
   153 0000013D 7503                    	JNZ	L0002
   154 0000013F E8C003                  	CALL	GETSYM		;If no tokens read yet, read first one
   155                                  L0002:	
   156 00000142 3C3B                    	CMP	AL,';'
   157 00000144 740B                    	JZ	ENDLN
   158 00000146 3C0D                    	CMP	AL,EOL
   159 00000148 7407                    	JZ	ENDLN
   160 0000014A B014                    	MOV	AL,14H		;Garbage at end of line error
   161 0000014C EB05                    	JMP SHORT	ENDLIN
   162 0000014E E9060F                  ENDJ:	JMP	UDEND
   163                                  
   164                                  ENDLN:
   165 00000151 30C0                    	XOR	AL,AL		;Flag no errors on line
   166                                  ENDLIN:
   167                                  ;AL = error code for line. Stack depth unknown
   168 00000153 BC[F829]                	MOV	SP,STACK
   169 00000156 E80200                  	CALL	NEXLIN
   170 00000159 EBCE                    	JMP SHORT	LOOP
   171                                  
   172                                  NEXLIN:
   173 0000015B B5C0                    	MOV	CH,0C0H		;Put end of line marker and error code (AL)
   174 0000015D E87F09                  	CALL	PUTCD
   175 00000160 E84409                  	CALL	GEN1
   176 00000163 A0[8020]                	MOV	AL,[CHR]
   177                                  GETEOL:
   178 00000166 3C0A                    	CMP	AL,10
   179 00000168 7436                    	JZ	GETEOLUDRET
   180 0000016A 3C1A                    	CMP	AL,1AH
   181 0000016C 74E0                    	JZ	ENDJ
   182 0000016E E84500                  	CALL	NEXTCHR		;Scan over comments for linefeed
   183 00000171 EBF3                    	JMP SHORT	GETEOL
   184                                  ABORT:
   185 00000173 BB[231F]                	MOV	BX,NOMEM
   186                                  PRERR:
   187 00000176 89DA                    	MOV	DX,BX
   188 00000178 B409                    	MOV	AH,PRINTMES
   189 0000017A CD21                    	INT	33
   190 0000017C CD20                    	INT	32
   191                                  
   192                                  MAKFIL:
   193 0000017E 89D6                    	MOV	SI,DX
   194 00000180 AC                      	LODSB			;Get drive select byte
   195 00000181 3C20                    	CMP	AL,20H		;If not valid, don't make file
   196 00000183 731B                    	JNC	MAKFILUDRET
   197 00000185 B90400                  	MOV	CX,4
   198 00000188 89F7                    	MOV	DI,SI
   199 0000018A BE5D00                  	MOV	SI,FCB+1
   200 0000018D F3                      	REP
   201 0000018E A5                      	MOVSW			;Copy source file name
   202 0000018F B416                    	MOV	AH,MAKE
   203 00000191 CD21                    	INT	33
   204 00000193 C745050100              	MOV	WORD[DI-9+14],1	;Set record length to 1 byte
   205 00000198 BB[0B1F]                	MOV	BX,NOSPAC
   206 0000019B 08C0                    	OR	AL,AL		;Success?
   207 0000019D 75D7                    	JNZ	PRERR
   208 0000019F C3                      	RET
   209                                  GETEOLUDRET:
   210                                  MAKFILUDRET:
   211                                  CHKDSKUDRET:
   212                                  MROPSUDRET:
   213 000001A0 C3                      	RET
   214                                  CHKDSK:
   215 000001A1 2C20                    	SUB	AL,' '		;If not present, set zero flag
   216 000001A3 74FB                    	JZ	CHKDSKUDRET
   217 000001A5 2C20                    	SUB	AL,20H
   218 000001A7 7404                    	JZ	DSKERR		;Must be in range A-O
   219 000001A9 3C10                    	CMP	AL,'P'-'@'
   220 000001AB 72F3                    	JC	CHKDSKUDRET
   221                                  DSKERR:
   222 000001AD BB[5C1F]                	MOV	BX,BADDSK
   223 000001B0 EBC4                    	JMP SHORT	PRERR
   224                                  ERROR:
   225 000001B2 88C8                    	MOV	AL,CL
   226 000001B4 EB9D                    	JMP	ENDLIN
   227                                  
   228                                  NEXTCHR:
   229 000001B6 8B36[F524]              	MOV	SI,[BUFPT]
   230 000001BA 81FE[F724]              	CMP	SI,SRCBUF
   231 000001BE 751A                    	JNZ	GETCH
   232                                  ;Buffer empty so refill it
   233 000001C0 52                      	PUSH	DX
   234 000001C1 50                      	PUSH	AX		;AH must be saved
   235 000001C2 89F2                    	MOV	DX,SI
   236 000001C4 B41A                    	MOV	AH,SETDMA
   237 000001C6 CD21                    	INT	33
   238 000001C8 BA5C00                  	MOV	DX,FCB
   239 000001CB B414                    	MOV	AH,READ
   240 000001CD CD21                    	INT	33
   241 000001CF 92                      	XCHG	AX,DX		;Put error code in DL
   242 000001D0 58                      	POP	AX		;Restore AH
   243 000001D1 88D0                    	MOV	AL,DL		;Error code back in AL
   244 000001D3 5A                      	POP	DX
   245 000001D4 3C01                    	CMP	AL,1
   246 000001D6 B01A                    	MOV	AL,1AH		;Possibly signal End of File
   247 000001D8 740A                    	JZ	NOMOD		;If nothing read
   248                                  GETCH:
   249 000001DA AC                      	LODSB
   250 000001DB 81FE[F728]              	CMP	SI,SRCBUF+BUFSIZ
   251 000001DF 7503                    	JNZ	NOMOD
   252 000001E1 BE[F724]                	MOV	SI,SRCBUF
   253                                  NOMOD:
   254 000001E4 8936[F524]              	MOV	[BUFPT],SI
   255 000001E8 A2[8020]                	MOV	[CHR],AL
   256 000001EB C3                      	RET
   257                                  
   258                                  
   259                                  MROPS:
   260                                  
   261                                  ; Get two operands and check for certain types, according to flag byte
   262                                  ; in CL. OP code in CH. Returns only if immediate operation.
   263                                  
   264 000001EC 51                      	PUSH	CX		;Save type flags
   265 000001ED E8D800                  	CALL	GETOP
   266 000001F0 52                      	PUSH	DX		;Save first operand
   267 000001F1 E8CB00                  	CALL	GETOP2
   268 000001F4 5B                      	POP	BX		;First op in BX, second op in DX
   269 000001F5 B004                    	MOV	AL,SREG		;Check for a segment register
   270 000001F7 38F8                    	CMP	AL,BH
   271 000001F9 7441                    	JZ	SEGCHK
   272 000001FB 38F0                    	CMP	AL,DH
   273 000001FD 743D                    	JZ	SEGCHK
   274 000001FF B001                    	MOV	AL,CONST	;Check if the first operand is immediate
   275 00000201 B11A                    	MOV	CL,26
   276 00000203 38F8                    	CMP	AL,BH
   277 00000205 74AB                    	JZ	ERROR		;Error if so
   278 00000207 59                      	POP	CX		;Restore type flags
   279 00000208 38F0                    	CMP	AL,DH		;If second operand is immediate, then done
   280 0000020A 7494                    	JZ	MROPSUDRET
   281 0000020C B000                    	MOV	AL,UNDEFID	;Check for memory reference
   282 0000020E 38F8                    	CMP	AL,BH
   283 00000210 744F                    	JZ	STORE		;Is destination memory?
   284 00000212 38F0                    	CMP	AL,DH
   285 00000214 7455                    	JZ	LOAD		;Is source memory?
   286 00000216 F6C101                  	TEST	CL,1		;Check if register-to-register operation OK
   287 00000219 B11B                    	MOV	CL,27
   288 0000021B 7495                    	JZ	ERROR
   289 0000021D 88F0                    	MOV	AL,DH
   290 0000021F 38F8                    	CMP	AL,BH		;Registers must be of same length
   291                                  RR:
   292 00000221 B116                    	MOV	CL,22
   293 00000223 758D                    	JNZ	ERROR
   294                                  RR1:
   295 00000225 2401                    	AND	AL,1		;Get register length (1=16 bits)
   296 00000227 08E8                    	OR	AL,CH		;Or in to OP code
   297 00000229 E86E08                  	CALL	PUT		;And write it
   298 0000022C 59                      	POP	CX		;Dump return address
   299 0000022D 88D8                    	MOV	AL,BL
   300 0000022F 00C0                    	ADD	AL,AL		;Rotate register number into middle position
   301 00000231 00C0                    	ADD	AL,AL
   302 00000233 00C0                    	ADD	AL,AL
   303 00000235 0CC0                    	OR	AL,0C0H		;Set register-to-register mode
   304 00000237 08D0                    	OR	AL,DL		;Combine with other register number
   305 00000239 E95E08                  	JMP	PUT
   306                                  SEGCHK:
   307                                  ;Come here if at least one operand is a segment register
   308 0000023C 59                      	POP	CX		;Restore flags
   309 0000023D F6C108                  	TEST	CL,8		;Check if segment register OK
   310 00000240 B116                    	MOV	CL,22
   311 00000242 7478                    	JZ	ERR1
   312 00000244 B9038E                  	MOV	CX,8E03H	;Segment register move OP code
   313 00000247 B000                    	MOV	AL,UNDEFID
   314 00000249 38F0                    	CMP	AL,DH		;Check if source is memory
   315 0000024B 741E                    	JZ	LOAD
   316 0000024D 38F8                    	CMP	AL,BH		;Check if destination is memory
   317 0000024F 7410                    	JZ	STORE
   318 00000251 B003                    	MOV	AL,XREG
   319 00000253 28F0                    	SUB	AL,DH		;Check if source is 16-bit register
   320 00000255 74CA                    	JZ	RR		;If so, AL must be zero
   321 00000257 B58C                    	MOV	CH,8CH		;Change direction
   322 00000259 87DA                    	XCHG	DX,BX		;Flip which operand is first and second
   323 0000025B B003                    	MOV	AL,XREG
   324 0000025D 28F0                    	SUB	AL,DH		;Let RR perform finish the test
   325 0000025F EBC0                    	JMP SHORT	RR
   326                                  
   327                                  STORE:
   328 00000261 F6C104                  	TEST	CL,004H		;Check if storing is OK
   329 00000264 7552                    	JNZ	STERR
   330 00000266 87DA                    	XCHG	DX,BX		;If so, flip operands
   331 00000268 80E5FD                  	AND	CH,0FDH		;   and zero direction bit
   332                                  LOAD:
   333 0000026B B619                    	MOV	DH,25
   334 0000026D 38F8                    	CMP	AL,BH		;Check if memory-to-memory
   335 0000026F 7449                    	JZ	MRERR
   336 00000271 88F8                    	MOV	AL,BH
   337 00000273 3C02                    	CMP	AL,REG		;Check if 8-bit operation
   338 00000275 7507                    	JNZ	XRG
   339 00000277 B616                    	MOV	DH,22
   340 00000279 F6C101                  	TEST	CL,1		;See if 8-bit operation is OK
   341 0000027C 743C                    	JZ	MRERR
   342                                  XRG:
   343 0000027E 88D0                    	MOV	AL,DL
   344 00000280 2C06                    	SUB	AL,6		;Check for R/M mode 6 and register 0
   345 00000282 08D8                    	OR	AL,BL		;   meaning direct load/store of accumulator
   346 00000284 7519                    	JNZ	NOTAC
   347 00000286 F6C108                  	TEST	CL,8		;See if direct load/store of accumulator
   348 00000289 7414                    	JZ	NOTAC		;   means anything in this case
   349                                  ; Process direct load/store of accumulator
   350 0000028B 88E8                    	MOV	AL,CH
   351 0000028D 2402                    	AND	AL,2		;Preserve direction bit only
   352 0000028F 3402                    	XOR	AL,2		;   but flip it
   353 00000291 0CA0                    	OR	AL,0A0H		;Combine with OP code
   354 00000293 88C5                    	MOV	CH,AL
   355 00000295 88F8                    	MOV	AL,BH		;Check byte/word operation
   356 00000297 2401                    	AND	AL,1
   357 00000299 08E8                    	OR	AL,CH
   358 0000029B 59                      	POP	CX		;Dump return address
   359 0000029C E9BB08                  	JMP	PUTADD		;Write the address
   360                                  
   361                                  NOTAC:
   362 0000029F 88F8                    	MOV	AL,BH
   363 000002A1 2401                    	AND	AL,1		;Get byte/word bit
   364 000002A3 20C8                    	AND	AL,CL		;But don't use it in word-only operations
   365 000002A5 08E8                    	OR	AL,CH		;Combine with OP code
   366 000002A7 E8F007                  	CALL	PUT
   367 000002AA 88D8                    	MOV	AL,BL
   368 000002AC 00C0                    	ADD	AL,AL		;Rotate to middle position
   369 000002AE 00C0                    	ADD	AL,AL
   370 000002B0 00C0                    	ADD	AL,AL
   371 000002B2 08D0                    	OR	AL,DL		;Combine register field
   372 000002B4 59                      	POP	CX		;Dump return address
   373 000002B5 E9A208                  	JMP	PUTADD		;Write the address
   374                                  
   375                                  STERR:
   376 000002B8 B61D                    	MOV	DH,29
   377                                  MRERR:
   378 000002BA 88F1                    	MOV	CL,DH
   379                                  
   380 000002BC E9F3FE                  ERR1:	JMP	ERROR
   381                                  
   382                                  GETOP2:
   383                                  ;Get the second operand: look for a comma and drop into GETOP
   384 000002BF A0[8120]                	MOV	AL,[SYM]
   385 000002C2 3C2C                    	CMP	AL,','
   386 000002C4 B115                    	MOV	CL,21
   387 000002C6 75F4                    	JNZ	ERR1
   388                                  
   389                                  
   390                                  GETOP:
   391                                  
   392                                  ; Get one operand. Operand may be a memory reference in brackets, a register,
   393                                  ; or a constant. If a flag (such as "B" for byte operation) is encountered,
   394                                  ; it is noted and processing continues to find the operand.
   395                                  ;
   396                                  ; On exit, AL (=DH) has the type of operand. Other information depends
   397                                  ; on the actual operand:
   398                                  ;
   399                                  ; AL=DH=0  Memory Reference.  DL has the address mode properly prepared in
   400                                  ; the 8086 R/M format (middle bits zero). The constant part of the address
   401                                  ; is in ADDR. If an undefined label needs to be added to this, a pointer to
   402                                  ; its information fields is in ALABEL, otherwise ALABEL is zero.
   403                                  ;
   404                                  ; AL=DH=1  Value. The constant part is in DATA. If an undefined label needs
   405                                  ; to be added to this, a pointer to its information fields is in DLABEL,
   406                                  ; otherwise DLABEL is zero. "$" and "RET" are in this class.
   407                                  ;
   408                                  ; AL=DH=2  8-bit Register. DL has the register number.
   409                                  ;
   410                                  ; AL=DH=3  16-bit Register. DL has the register number.
   411                                  ;
   412                                  ; AL=DH=4  Segment Register. DL has the register number.
   413                                  
   414 000002C8 E83702                  	CALL	GETSYM
   415                                  GETOP1:
   416                                  ;Enter here if we don't need a GETSYM first
   417 000002CB 3C5B                    	CMP	AL,'['		;Memory reference?
   418 000002CD 7430                    	JZ	MEM
   419 000002CF 3C05                    	CMP	AL,5		;Flag ("B", "W", etc.)?
   420 000002D1 7457                    	JZ	FLG
   421 000002D3 3C02                    	CMP	AL,REG		;8-Bit register?
   422 000002D5 7420                    	JZ	NREG
   423 000002D7 3C03                    	CMP	AL,XREG		;16-Bit register?
   424 000002D9 741C                    	JZ	NREG
   425 000002DB 3C04                    	CMP	AL,SREG		;Segment register?
   426 000002DD 7418                    	JZ	NREG
   427                                  VAL:				;Must be immediate
   428 000002DF 30C0                    	XOR	AL,AL		;No addressing modes allowed
   429                                  VAL1:
   430 000002E1 E85700                  	CALL	GETVAL
   431 000002E4 A1[2B20]                	MOV	AX,[CON]	;Defined part
   432 000002E7 A3[2720]                	MOV	[DATA],AX
   433 000002EA A1[2D20]                	MOV	AX,[UNDEF]	;Undefined part
   434 000002ED A3[2920]                	MOV	[DLABEL],AX
   435 000002F0 88EA                    	MOV	DL,CH
   436 000002F2 B601                    	MOV	DH,CONST
   437 000002F4 88F0                    	MOV	AL,DH
   438 000002F6 C3                      	RET
   439                                  NREG:
   440 000002F7 52                      	PUSH	DX
   441 000002F8 E80702                  	CALL	GETSYM
   442 000002FB 5A                      	POP	DX
   443 000002FC 88F0                    	MOV	AL,DH
   444 000002FE C3                      	RET
   445                                  MEM:
   446 000002FF E80002                  	CALL	GETSYM
   447 00000302 B001                    	MOV	AL,1
   448 00000304 E83400                  	CALL	GETVAL
   449 00000307 A0[8120]                	MOV	AL,[SYM]
   450 0000030A 3C5D                    	CMP	AL,']'
   451 0000030C B118                    	MOV	CL,24
   452 0000030E 75AC                    	JNZ	ERR1
   453 00000310 E8EF01                  	CALL	GETSYM
   454 00000313 8B1E[2B20]              	MOV	BX,[CON]
   455 00000317 891E[2320]              	MOV	[ADDR],BX
   456 0000031B 8B1E[2D20]              	MOV	BX,[UNDEF]
   457 0000031F 891E[2520]              	MOV	[ALABEL],BX
   458 00000323 88EA                    	MOV	DL,CH
   459 00000325 B600                    	MOV	DH,UNDEFID
   460 00000327 88F0                    	MOV	AL,DH
   461 00000329 C3                      	RET
   462                                  FLG:
   463 0000032A 3A16[2220]              	CMP	DL,[MAXFLG]	;Invalid flag for this operation?
   464 0000032E B127                    	MOV	CL,27H
   465 00000330 7F8A                    	JG	ERR1
   466 00000332 E8CD01                  	CALL	GETSYM
   467 00000335 3C2C                    	CMP	AL,','
   468 00000337 748F                    	JZ	GETOP
   469 00000339 EB90                    	JMP SHORT	GETOP1
   470                                  
   471                                  
   472                                  GETVAL:
   473                                  
   474                                  ; Expression analyzer. On entry, if AL=0 then do not allow base or index
   475                                  ; registers. If AL=1, we are analyzing a memory reference, so allow base
   476                                  ; and index registers, and compute addressing mode when done. The constant
   477                                  ; part of the expression will be found in CON. If an undefined label is to
   478                                  ; be added to this, a pointer to its information fields will be found in
   479                                  ; UNDEF.
   480                                  
   481 0000033B 88C4                    	MOV	AH,AL		;Flag is kept in AH
   482 0000033D C706[2D20]0000          	MOV	WORD[UNDEF],0
   483 00000343 A0[8120]                	MOV	AL,[SYM]
   484 00000346 E85100                  	CALL	EXPRESSION
   485 00000349 8916[2B20]              	MOV	[CON],DX
   486 0000034D 88E0                    	MOV	AL,AH
   487 0000034F B500                    	MOV	CH,0		;Initial mode
   488 00000351 A810                    	TEST	AL,10H		;Test INDEX bit
   489 00000353 D0D0                    	RCL	AL,1		;BASE bit (zero flag not affected)
   490 00000355 7437                    	JZ	NOIND		;Jump if not indexed, with BASE bit in carry
   491 00000357 F5                      	CMC
   492 00000358 D0D5                    	RCL	CH,1		;Rotate in BASE bit
   493 0000035A D0D0                    	RCL	AL,1		;BP bit
   494 0000035C D0D5                    	RCL	CH,1
   495 0000035E D0D0                    	RCL	AL,1		;DI bit
   496 00000360 D0D5                    	RCL	CH,1		;The low 3 bits now have indexing mode
   497                                  MODE:
   498 00000362 80CD80                  	OR	CH,080H		;If undefined label, force 16-bit displacement
   499 00000365 F706[2D20]FFFF          	TEST	WORD[UNDEF],-1
   500 0000036B 7520                    	JNZ	MODEUDRET
   501 0000036D 8B1E[2B20]              	MOV	BX,[CON]
   502 00000371 88D8                    	MOV	AL,BL
   503 00000373 98                      	CBW			;Extend sign
   504 00000374 39D8                    	CMP	AX,BX		;Is it a signed 8-bit number?
   505 00000376 7515                    	JNZ	MODEUDRET		;If not, use 16-bit displacement
   506 00000378 80E57F                  	AND	CH,07FH		;Reset 16-bit displacement
   507 0000037B 80CD40                  	OR	CH,040H		;Set 8-bit displacement
   508 0000037E 09DB                    	OR	BX,BX
   509 00000380 750B                    	JNZ	MODEUDRET		;Use it if not zero displacement
   510 00000382 80E507                  	AND	CH,7		;Specify no displacement
   511 00000385 80FD06                  	CMP	CH,6		;Check for BP+0 addressing mode
   512 00000388 7503                    	JNZ	MODEUDRET
   513 0000038A 80CD40                  	OR	CH,040H		;If BP+0, use 8-bit displacement
   514                                  MODEUDRET:
   515 0000038D C3                      	RET
   516                                  NOIND:
   517 0000038E B506                    	MOV	CH,6		;Try direct address mode
   518 00000390 73FB                    	JNC	MODEUDRET		;If no base register, that's right
   519 00000392 D0D0                    	RCL	AL,1		;Check BP bit
   520 00000394 72CC                    	JC	MODE
   521 00000396 FEC5                    	INC	CH		;If not, must be BX
   522 00000398 EBC8                    	JMP SHORT	MODE
   523                                  
   524                                  EXPRESSION:
   525                                  ;Analyze arbitrary expression. Flag byte in AH.
   526                                  ;On exit, AL has type byte: 0=register or undefined label
   527 0000039A B5FF                    	MOV	CH,-1		;Initial type
   528 0000039C 89D7                    	MOV	DI,DX
   529 0000039E 31D2                    	XOR	DX,DX		;Initial value
   530 000003A0 3C2B                    	CMP	AL,'+'
   531 000003A2 740C                    	JZ	PLSMNS
   532 000003A4 3C2D                    	CMP	AL,'-'
   533 000003A6 7408                    	JZ	PLSMNS
   534 000003A8 B12B                    	MOV	CL,'+'
   535 000003AA 52                      	PUSH	DX
   536 000003AB 51                      	PUSH	CX
   537 000003AC 89FA                    	MOV	DX,DI
   538 000003AE EB0A                    	JMP SHORT	OPERATE
   539                                  PLSMNS:
   540 000003B0 88C1                    	MOV	CL,AL
   541 000003B2 52                      	PUSH	DX
   542 000003B3 51                      	PUSH	CX
   543 000003B4 80CC04                  	OR	AH,4		;Flag that a sign was found
   544 000003B7 E84801                  	CALL	GETSYM
   545                                  OPERATE:
   546 000003BA E82B00                  	CALL	TERM
   547 000003BD 59                      	POP	CX		;Recover operator
   548 000003BE 5B                      	POP	BX		;Recover current value
   549 000003BF 87DA                    	XCHG	DX,BX
   550 000003C1 20C5                    	AND	CH,AL
   551 000003C3 08C0                    	OR	AL,AL		;Is it register or undefined label?
   552 000003C5 7417                    	JZ	NOCON		;If so, then no constant part
   553 000003C7 80F92D                  	CMP	CL,"-"		;Subtract it?
   554 000003CA 7502                    	JNZ	ADD
   555 000003CC F7DB                    	NEG	BX
   556                                  ADD:
   557 000003CE 01DA                    	ADD	DX,BX
   558                                  NEXTERM:
   559 000003D0 A0[8120]                	MOV	AL,[SYM]
   560 000003D3 3C2B                    	CMP	AL,'+'
   561 000003D5 74D9                    	JZ	PLSMNS
   562 000003D7 3C2D                    	CMP	AL,'-'
   563 000003D9 74D5                    	JZ	PLSMNS
   564 000003DB 88E8                    	MOV	AL,CH
   565 000003DD C3                      	RET
   566                                  NOCON:
   567 000003DE 80F92D                  	CMP	CL,"-"
   568 000003E1 75ED                    	JNZ	NEXTERM
   569                                  BADOP:
   570 000003E3 B105                    	MOV	CL,5
   571 000003E5 E9CAFD                  	JMP	ERROR
   572                                  
   573                                  TERM:
   574 000003E8 E84000                  	CALL	FACTOR
   575                                  MULOP:
   576 000003EB 52                      	PUSH	DX		;Save value
   577 000003EC 50                      	PUSH	AX		;Save type
   578 000003ED E81201                  	CALL	GETSYM
   579 000003F0 59                      	POP	CX
   580 000003F1 3C2A                    	CMP	AL,"*"
   581 000003F3 7404                    	JZ	GETFACT
   582 000003F5 3C2F                    	CMP	AL,"/"
   583 000003F7 752E                    	JNZ	ENDTERM
   584                                  GETFACT:
   585 000003F9 08C9                    	OR	CL,CL		;Can we operate on this type?
   586 000003FB 74E6                    	JZ	BADOP
   587 000003FD 50                      	PUSH	AX		;Save operator
   588 000003FE E80101                  	CALL	GETSYM		;Get past operator
   589 00000401 E82700                  	CALL	FACTOR
   590 00000404 08C0                    	OR	AL,AL
   591 00000406 74DB                    	JZ	BADOP
   592 00000408 59                      	POP	CX		;Recover operator
   593 00000409 5D                      	POP	BP		;And current value
   594 0000040A 95                      	XCHG	AX,BP		;Save AH in BP
   595 0000040B 80F92F                  	CMP	CL,"/"		;Do we divide?
   596 0000040E 750E                    	JNZ	DOMUL
   597 00000410 09D2                    	OR	DX,DX		;Dividing by zero?
   598 00000412 B129                    	MOV	CL,29H
   599 00000414 7451                    	JZ	ERR2
   600 00000416 89D3                    	MOV	BX,DX
   601 00000418 31D2                    	XOR	DX,DX		;Make 32-bit dividend
   602 0000041A F7F3                    	DIV	BX
   603 0000041C EB02                    	JMP SHORT	NEXFACT
   604                                  DOMUL:
   605 0000041E F7E2                    	MUL	DX
   606                                  NEXFACT:
   607 00000420 89C2                    	MOV	DX,AX		;Result in DX
   608 00000422 95                      	XCHG	AX,BP		;Restore flags to AH
   609 00000423 B0FF                    	MOV	AL,-1		;Indicate a number
   610 00000425 EBC4                    	JMP SHORT	MULOP
   611                                  ENDTERM:
   612 00000427 5A                      	POP	DX
   613 00000428 88C8                    	MOV	AL,CL
   614 0000042A C3                      	RET
   615                                  
   616                                  FACTOR:
   617 0000042B A0[8120]                	MOV	AL,[SYM]
   618 0000042E 3C01                    	CMP	AL,CONST
   619 00000430 7443                    	JZ	FACTORUDRET
   620 00000432 3C00                    	CMP	AL,UNDEFID
   621 00000434 745C                    	JZ	UVAL
   622 00000436 3C28                    	CMP	AL,"("
   623 00000438 7448                    	JZ	PAREN
   624 0000043A 3C22                    	CMP	AL,'"'
   625 0000043C 7466                    	JZ	STRING
   626 0000043E 3C27                    	CMP	AL,"'"
   627 00000440 7462                    	JZ	STRING
   628 00000442 3C03                    	CMP	AL,XREG		;Only 16-bit register may index
   629 00000444 B114                    	MOV	CL,20
   630 00000446 751F                    	JNZ	ERR2
   631 00000448 F6C401                  	TEST	AH,1		;Check to see if indexing is OK
   632 0000044B B101                    	MOV	CL,1
   633 0000044D 7418                    	JZ	ERR2
   634 0000044F 88D0                    	MOV	AL,DL
   635 00000451 B103                    	MOV	CL,3
   636 00000453 2C03                    	SUB	AL,3		;Check for BX
   637 00000455 7422                    	JZ	BXJ
   638 00000457 2C02                    	SUB	AL,2		;Check for BP
   639 00000459 741B                    	JZ	BPJ
   640 0000045B FEC8                    	DEC	AL		;Check for SI
   641 0000045D B104                    	MOV	CL,4
   642 0000045F 740C                    	JZ	SIJ
   643 00000461 FEC8                    	DEC	AL		;Check for DI
   644 00000463 7405                    	JZ	DIJ
   645 00000465 B102                    	MOV	CL,2		;Invalid base/index register
   646 00000467 E948FD                  ERR2:	JMP	ERROR
   647                                  DIJ:
   648 0000046A 80CC20                  	OR	AH,20H		;Flag seeing index register DI
   649                                  SIJ:
   650 0000046D F6C410                  	TEST	AH,10H		;Check if already seen index register
   651 00000470 75F5                    	JNZ	ERR2
   652 00000472 80CC10                  	OR	AH,10H		;Flag seeing index register
   653                                  FACTORUDRET:
   654 00000475 C3                      	RET
   655                                  
   656                                  BPJ:
   657 00000476 80CC40                  	OR	AH,40H		;Flag seeing base register BP
   658                                  BXJ:
   659 00000479 F6C480                  	TEST	AH,80H		;Check if already seen base register
   660 0000047C 75E9                    	JNZ	ERR2
   661 0000047E 80CC80                  	OR	AH,80H		;Flag seeing base register
   662 00000481 C3                      	RET
   663                                  
   664                                  PAREN:
   665 00000482 E87D00                  	CALL	GETSYM		;Eat the "("
   666 00000485 E812FF                  	CALL	EXPRESSION
   667 00000488 803E[8120]29            	CMP	BYTE[SYM],")"	;Better have closing paren
   668 0000048D B114                    	MOV	CL,20
   669 0000048F 7510                    	JNZ	ERR30
   670 00000491 C3                      	RET
   671                                  
   672                                  UVAL:
   673 00000492 B106                    	MOV	CL,6
   674 00000494 F6C408                  	TEST	AH,8		;Check if undefined label has been seen
   675 00000497 7508                    	JNZ	ERR30
   676 00000499 80CC08                  	OR	AH,8		;Flag seeing undefined label
   677 0000049C 891E[2D20]              	MOV	[UNDEF],BX
   678 000004A0 C3                      	RET
   679                                  
   680 000004A1 E90EFD                  ERR30:	JMP	ERROR
   681                                  
   682                                  STRING:
   683 000004A4 88C5                    	MOV	CH,AL
   684 000004A6 A0[8020]                	MOV	AL,[CHR]
   685 000004A9 38E8                    	CMP	AL,CH
   686 000004AB B123                    	MOV	CL,35
   687 000004AD 88C2                    	MOV	DL,AL
   688 000004AF B600                    	MOV	DH,0
   689 000004B1 7503                    	JNZ	L0003
   690 000004B3 E83200                  	CALL	ZERLEN
   691                                  L0003:
   692 000004B6 E83700                  	CALL	GETCHR
   693 000004B9 B125                    	MOV	CL,37
   694 000004BB F6C402                  	TEST	AH,2
   695 000004BE 74E1                    	JZ	ERR30
   696 000004C0 F6C404                  	TEST	AH,4
   697 000004C3 B126                    	MOV	CL,38
   698 000004C5 75DA                    	JNZ	ERR30
   699                                  STRGDAT:
   700 000004C7 88D0                    	MOV	AL,DL
   701 000004C9 3C0D                    	CMP	AL,EOL
   702 000004CB B127                    	MOV	CL,39
   703 000004CD 74D2                    	JZ	ERR30
   704 000004CF E8C805                  	CALL	PUT
   705 000004D2 A0[8A20]                	MOV	AL,[DATSIZ]
   706 000004D5 08C0                    	OR	AL,AL
   707 000004D7 7505                    	JNZ	BYTSIZ
   708 000004D9 88F0                    	MOV	AL,DH
   709 000004DB E8BC05                  	CALL	PUT
   710                                  BYTSIZ:
   711 000004DE A0[8020]                	MOV	AL,[CHR]
   712 000004E1 88C2                    	MOV	DL,AL
   713 000004E3 E80A00                  	CALL	GETCHR
   714 000004E6 EBDF                    	JMP SHORT	STRGDAT
   715                                  
   716                                  ZERLEN:
   717 000004E8 E8CBFC                  	CALL	NEXTCHR
   718 000004EB 38E8                    	CMP	AL,CH
   719 000004ED 75B2                    	JNZ	ERR30
   720 000004EF C3                      	RET
   721                                  
   722                                  GETCHR:
   723 000004F0 E8C3FC                  	CALL	NEXTCHR
   724 000004F3 38E8                    	CMP	AL,CH
   725 000004F5 750A                    	JNZ	GETCHRUDRET
   726 000004F7 E8BCFC                  	CALL	NEXTCHR
   727 000004FA 38E8                    	CMP	AL,CH
   728 000004FC 7403                    	JZ	GETCHRUDRET
   729 000004FE 5B                      	POP	BX		;Kill return address to STRGDAT loop
   730 000004FF B0FF                    	MOV	AL,-1		;Flag type as constant
   731                                  GETCHRUDRET:
   732 00000501 C3                      	RET
   733                                  
   734                                  GETSYM:
   735                                  
   736                                  ; The lexical scanner. Used only in the operand field. Returns with the token
   737                                  ; in SYM and AL, sometimes with additional info in BX or DX.
   738                                  ;
   739                                  ; AL=SYM=0  Undefined label. BX has pointer to information fields.
   740                                  ;
   741                                  ; AL=SYM=1  Constant (or defined label). DX has value.
   742                                  ;
   743                                  ; AL=SYM=2,3,4  8-bit register, 16-bit register, or segment register,
   744                                  ; respectively. DL has register number.
   745                                  ;
   746                                  ; AL=SYM=5  A mode flag (such as "B" for byte operation). Type of flag in DL
   747                                  ; and also stored in FLAG: -1=no flags, 0=B, 1=W, 2=S, 3=L, 4=T.
   748                                  ;
   749                                  ; AL=SYM=6  8087 floating point register, ST(n) or ST. DL has register number.
   750                                  ;
   751                                  ; All other values are the ASCII code of the character. Note that this may
   752                                  ; never be a letter or number.
   753                                  
   754 00000502 50                      	PUSH	AX		;Save AH
   755 00000503 E82100                  	CALL	GETSY
   756 00000506 58                      	POP	AX
   757 00000507 A0[8120]                	MOV	AL,[SYM]
   758                                  SCANBUDRET:
   759 0000050A C3                      	RET
   760                                  
   761                                  SCANB:
   762 0000050B A0[8020]                	MOV	AL,[CHR]
   763                                  SCANT:
   764 0000050E 3C20                    	CMP	AL,' '
   765 00000510 7404                    	JZ	NEXB
   766 00000512 3C09                    	CMP	AL,9
   767 00000514 75F4                    	JNZ	SCANBUDRET
   768                                  NEXB:
   769 00000516 E89DFC                  	CALL	NEXTCHR
   770 00000519 EBF3                    	JMP SHORT	SCANT
   771                                  DOLLAR:
   772 0000051B 8B16[1D20]              	MOV	DX,[OLDPC]
   773 0000051F B001                    	MOV	AL,CONST
   774 00000521 A2[8120]                	MOV	[SYM],AL
   775                                  NEXTCHJ:
   776 00000524 E98FFC                  	JMP	NEXTCHR
   777                                  
   778                                  GETSY:
   779 00000527 E8E1FF                  	CALL	SCANB
   780 0000052A 3C24                    	CMP	AL,'$'
   781 0000052C 74ED                    	JZ	DOLLAR
   782 0000052E A2[8120]                	MOV	[SYM],AL
   783 00000531 0C20                    	OR	AL,20H
   784 00000533 3C7B                    	CMP	AL,'z'+1
   785 00000535 73ED                    	JNC	NEXTCHJ
   786 00000537 3C61                    	CMP	AL,'a'
   787 00000539 7203                    	JC	$+5
   788 0000053B E9BE00                  	JMP	LETTER
   789 0000053E 3C3A                    	CMP	AL,'9'+1
   790 00000540 73E2                    	JNC	NEXTCHJ
   791 00000542 3C30                    	CMP	AL,'0'
   792 00000544 72DE                    	JC	NEXTCHJ
   793 00000546 BB[8120]                	MOV	BX,SYM
   794 00000549 C60701                  	MOV	BYTE[BX],CONST
   795 0000054C E88200                  	CALL	READID
   796 0000054F 4B                      	DEC	BX
   797 00000550 8A07                    	MOV	AL,[BX]
   798 00000552 B107                    	MOV	CL,7
   799 00000554 BB0000                  	MOV	BX,0
   800 00000557 3C68                    	CMP	AL,'h'
   801 00000559 7503                    	JNZ	$+5
   802 0000055B EB32                    	JMP	HEX
   803 0000055D FEC1                    	INC	CL
   804 0000055F C706[A720][3020]        	MOV	WORD[IX],ID
   805                                  DEC:
   806 00000565 8B36[A720]              	MOV	SI,[IX]
   807 00000569 8A04                    	MOV	AL,[SI]
   808 0000056B FF06[A720]              	INC	WORD[IX]
   809 0000056F 3C3A                    	CMP	AL,'9'+1
   810 00000571 7203                    	JC	$+5
   811 00000573 E93CFC                  	JMP	ERROR
   812 00000576 2C30                    	SUB	AL,'0'
   813 00000578 89DA                    	MOV	DX,BX
   814 0000057A D1E3                    	SHL	BX,1
   815 0000057C D1E3                    	SHL	BX,1
   816 0000057E 01D3                    	ADD	BX,DX
   817 00000580 D1E3                    	SHL	BX,1
   818 00000582 88C2                    	MOV	DL,AL
   819 00000584 B600                    	MOV	DH,0
   820 00000586 01D3                    	ADD	BX,DX
   821 00000588 FECD                    	DEC	CH
   822 0000058A 75D9                    	JNZ	DEC
   823 0000058C 87DA                    	XCHG	DX,BX
   824 0000058E C3                      	RET
   825                                  
   826                                  HEX:
   827 0000058F BA[3020]                	MOV	DX,ID
   828 00000592 FECD                    	DEC	CH
   829                                  HEX1:
   830 00000594 89D6                    	MOV	SI,DX
   831 00000596 AC                      	LODSB
   832 00000597 42                      	INC	DX
   833 00000598 2C30                    	SUB	AL,'0'
   834 0000059A 3C0A                    	CMP	AL,10
   835 0000059C 7206                    	JC	GOTIT
   836 0000059E 3C37                    	CMP	AL,'g'-'0'
   837 000005A0 7313                    	JNC	ERR4
   838 000005A2 2C27                    	SUB	AL,'a'-10-'0'
   839                                  GOTIT:
   840 000005A4 D1E3                    	SHL	BX,1
   841 000005A6 D1E3                    	SHL	BX,1
   842 000005A8 D1E3                    	SHL	BX,1
   843 000005AA D1E3                    	SHL	BX,1
   844 000005AC 00C3                    	ADD	BL,AL
   845 000005AE FECD                    	DEC	CH
   846 000005B0 75E2                    	JNZ	HEX1
   847 000005B2 87DA                    	XCHG	DX,BX
   848 000005B4 C3                      	RET
   849                                  
   850 000005B5 E9FAFB                  ERR4:	JMP	ERROR
   851                                  
   852                                  GETLET:
   853 000005B8 E850FF                  	CALL	SCANB
   854 000005BB 3C0D                    	CMP	AL,EOL
   855 000005BD F9                      	STC
   856 000005BE 743B                    	JZ	GETLETUDRET
   857 000005C0 3C3B                    	CMP	AL,';'
   858 000005C2 F9                      	STC
   859 000005C3 7436                    	JZ	GETLETUDRET
   860 000005C5 B10A                    	MOV	CL,10
   861 000005C7 0C20                    	OR	AL,20H
   862 000005C9 3C61                    	CMP	AL,'a'
   863 000005CB 72E8                    	JC	ERR4
   864 000005CD 3C7B                    	CMP	AL,'z'+1
   865 000005CF 73E4                    	JNC	ERR4
   866                                  READID:
   867 000005D1 BB[3020]                	MOV	BX,ID
   868 000005D4 B500                    	MOV	CH,0
   869                                  MOREID:
   870 000005D6 8807                    	MOV	[BX],AL
   871 000005D8 FEC5                    	INC	CH
   872 000005DA 43                      	INC	BX
   873 000005DB E8D8FB                  	CALL	NEXTCHR
   874 000005DE 3C30                    	CMP	AL,'0'
   875 000005E0 720E                    	JC	NOMORE
   876 000005E2 0C20                    	OR	AL,20H
   877 000005E4 3C7B                    	CMP	AL,'z'+1
   878 000005E6 7308                    	JNC	NOMORE
   879 000005E8 3C3A                    	CMP	AL,'9'+1
   880 000005EA 72EA                    	JC	MOREID
   881 000005EC 3C61                    	CMP	AL,'a'
   882 000005EE 73E6                    	JNC	MOREID
   883                                  NOMORE:
   884 000005F0 88C1                    	MOV	CL,AL
   885 000005F2 88E8                    	MOV	AL,CH
   886 000005F4 A2[2F20]                	MOV	[LENID],AL
   887 000005F7 08C0                    	OR	AL,AL
   888 000005F9 88C8                    	MOV	AL,CL
   889                                  GETLETUDRET:
   890 000005FB C3                      	RET
   891                                  LETTER:
   892 000005FC E8D2FF                  	CALL	READID
   893 000005FF 88E8                    	MOV	AL,CH
   894 00000601 FEC8                    	DEC	AL
   895 00000603 7514                    	JNZ	NOFLG
   896 00000605 A0[3020]                	MOV	AL,[ID]
   897 00000608 B90500                  	MOV	CX,5
   898 0000060B BF[3F06]                	MOV	DI,FLGTAB
   899 0000060E FC                      	CLD
   900 0000060F F2                      	REPNE
   901 00000610 AE                      	SCASB			;See if one of B,W,S,L,T
   902 00000611 741A                    	JZ	SAVFLG		;Go save flag
   903 00000613 30C0                    	XOR	AL,AL
   904 00000615 8A2E[2F20]              	MOV	CH,[LENID]
   905                                  NOFLG:
   906 00000619 FEC8                    	DEC	AL
   907 0000061B 53                      	PUSH	BX
   908 0000061C 7503                    	JNZ	L0004
   909 0000061E E85A00                  	CALL	REGCHK
   910                                  L0004:	
   911 00000621 5B                      	POP	BX
   912 00000622 88F0                    	MOV	AL,DH
   913 00000624 7403                    	JZ	SYMSAV
   914 00000626 E8F900                  	CALL	LOOKRET
   915                                  SYMSAV:
   916 00000629 A2[8120]                	MOV	[SYM],AL
   917 0000062C C3                      	RET
   918                                  
   919                                  SAVFLG:
   920 0000062D 88CA                    	MOV	DL,CL		;Need flag type in DL
   921 0000062F 860E[2120]              	XCHG	[FLAG],CL
   922 00000633 80F9FF                  	CMP	CL,-1
   923 00000636 B120                    	MOV	CL,32
   924 00000638 B005                    	MOV	AL,5
   925 0000063A 74ED                    	JZ	SYMSAV
   926 0000063C E973FB                  ERRJ3:	JMP	ERROR
   927                                  
   928 0000063F 746C737762              FLGTAB:	DB	"tlswb"
   929                                  
   930                                  FPREG:
   931                                  ;Have detected "ST" for 8087 floating point stack register
   932 00000644 B200                    	MOV	DL,0		;Default is ST(0)
   933 00000646 E8C2FE                  	CALL	SCANB		;Get next character
   934 00000649 3C28                    	CMP	AL,"("		;Specifying register number?
   935 0000064B 7529                    	JNZ	HAVREG
   936                                  ;Get register number
   937 0000064D E866FB                  	CALL	NEXTCHR		;Skip over the "("
   938 00000650 E875FC                  	CALL	GETOP		;A little recursion never hurt anybody
   939 00000653 3C01                    	CMP	AL,CONST	;Better have found a constant
   940 00000655 B114                    	MOV	CL,20		;Operand error if not
   941 00000657 75E3                    	JNZ	ERRJ3
   942 00000659 833E[2920]00            	CMP	WORD[DLABEL],0	;Constant must be defined
   943 0000065E B11E                    	MOV	CL,30
   944 00000660 75DA                    	JNZ	ERRJ3
   945 00000662 8B16[2720]              	MOV	DX,[DATA]	;Get constant
   946 00000666 83FA07                  	CMP	DX,7		;Constant must be in range 0-7
   947 00000669 B11F                    	MOV	CL,31
   948 0000066B 77CF                    	JA	ERRJ3
   949 0000066D A0[8120]                	MOV	AL,[SYM]
   950 00000670 3C29                    	CMP	AL,")"
   951 00000672 B118                    	MOV	CL,24
   952 00000674 75C6                    	JNZ	ERRJ3
   953                                  HAVREG:
   954 00000676 B606                    	MOV	DH,FREG
   955 00000678 30C0                    	XOR	AL,AL		;Zero set means register found
   956 0000067A C3                      	RET
   957                                  
   958                                  REGCHK:
   959 0000067B BB[3020]                	MOV	BX,ID
   960 0000067E 813F7374                	CMP	WORD[BX],"s"+7400H	;"st"
   961 00000682 74C0                    	JZ	FPREG
   962 00000684 8A0F                    	MOV	CL,[BX]
   963 00000686 43                      	INC	BX
   964 00000687 8A07                    	MOV	AL,[BX]
   965 00000689 BB[E606]                	MOV	BX,REGTAB
   966 0000068C B603                    	MOV	DH,XREG
   967 0000068E B200                    	MOV	DL,0
   968 00000690 3C78                    	CMP	AL,'x'
   969 00000692 743B                    	JZ	SCANREG
   970 00000694 B602                    	MOV	DH,REG
   971 00000696 3C6C                    	CMP	AL,'l'
   972 00000698 7435                    	JZ	SCANREG
   973 0000069A B204                    	MOV	DL,4
   974 0000069C 3C68                    	CMP	AL,'h'
   975 0000069E 742F                    	JZ	SCANREG
   976 000006A0 B604                    	MOV	DH,SREG
   977 000006A2 B200                    	MOV	DL,0
   978 000006A4 BB[EA06]                	MOV	BX,SEGTAB
   979 000006A7 3C73                    	CMP	AL,'s'
   980 000006A9 7424                    	JZ	SCANREG
   981 000006AB B603                    	MOV	DH,XREG
   982 000006AD 3C70                    	CMP	AL,'p'
   983 000006AF 7411                    	JZ	PREG
   984 000006B1 3C69                    	CMP	AL,'i'
   985 000006B3 750C                    	JNZ	REGCHKUDRET
   986 000006B5 B206                    	MOV	DL,6
   987 000006B7 88C8                    	MOV	AL,CL
   988 000006B9 3C73                    	CMP	AL,'s'
   989 000006BB 7404                    	JZ	REGCHKUDRET
   990 000006BD FEC2                    	INC	DL
   991 000006BF 3C64                    	CMP	AL,'d'
   992                                  REGCHKUDRET:
   993 000006C1 C3                      	RET
   994                                  PREG:
   995 000006C2 B204                    	MOV	DL,4
   996 000006C4 88C8                    	MOV	AL,CL
   997 000006C6 3C73                    	CMP	AL,'s'
   998 000006C8 7404                    	JZ	PREGUDRET
   999 000006CA FEC2                    	INC	DL
  1000 000006CC 3C62                    	CMP	AL,'b'
  1001                                  PREGUDRET:
  1002 000006CE C3                      	RET
  1003                                  SCANREG:
  1004 000006CF 88C8                    	MOV	AL,CL
  1005 000006D1 B90400                  	MOV	CX,4
  1006 000006D4 FC                      	CLD
  1007 000006D5 89DF                    	MOV	DI,BX
  1008 000006D7 F2                      	REPNZ
  1009 000006D8 AE                      	SCASB
  1010 000006D9 89FB                    	MOV	BX,DI
  1011 000006DB 7508                    	JNZ	SCANREGUDRET
  1012 000006DD 88C8                    	MOV	AL,CL
  1013 000006DF 00D0                    	ADD	AL,DL
  1014 000006E1 88C2                    	MOV	DL,AL
  1015 000006E3 30C0                    	XOR	AL,AL
  1016                                  SCANREGUDRET:
  1017                                  LOOKUDRET:
  1018 000006E5 C3                      	RET
  1019 000006E6 62646361                REGTAB:	DB	'bdca'
  1020                                  
  1021 000006EA 64736365                SEGTAB:	DB	'dsce'
  1022                                  
  1023                                  LOOK:
  1024 000006EE 8A2F                    	MOV	CH,[BX]
  1025 000006F0 43                      	INC	BX
  1026 000006F1 BA[3020]                	MOV	DX,ID
  1027 000006F4 E8FA00                  	CALL	CPSLP
  1028 000006F7 74EC                    	JZ	LOOKUDRET
  1029 000006F9 3480                    	XOR	AL,80H
  1030 000006FB D0C0                    	ROL	AL,1		;Make end-of-symbol bit least significant
  1031 000006FD 88C1                    	MOV	CL,AL
  1032 000006FF 4B                      	DEC	BX
  1033 00000700 8A07                    	MOV	AL,[BX]
  1034 00000702 3480                    	XOR	AL,80H
  1035 00000704 D0C0                    	ROL	AL,1
  1036 00000706 38C8                    	CMP	AL,CL
  1037 00000708 7304                    	JNC	SMALL
  1038 0000070A FEC5                    	INC	CH
  1039 0000070C FEC5                    	INC	CH
  1040                                  SMALL:
  1041 0000070E 88EA                    	MOV	DL,CH
  1042 00000710 B600                    	MOV	DH,0
  1043 00000712 01D3                    	ADD	BX,DX
  1044 00000714 8B17                    	MOV	DX,[BX]
  1045 00000716 43                      	INC	BX
  1046 00000717 88D0                    	MOV	AL,DL
  1047 00000719 08F0                    	OR	AL,DH
  1048 0000071B F9                      	STC
  1049 0000071C 74C7                    	JZ	LOOKUDRET
  1050 0000071E 87DA                    	XCHG	DX,BX
  1051 00000720 EBCC                    	JMP SHORT	LOOK
  1052                                  LOOKRET:
  1053 00000722 88E8                    	MOV	AL,CH
  1054 00000724 3C03                    	CMP	AL,3	;RET has 3 letters
  1055 00000726 754F                    	JNZ	LOOKUP
  1056 00000728 4B                      	DEC	BX
  1057 00000729 800F80                  	OR	BYTE[BX],080H
  1058 0000072C BA[D01F]                	MOV	DX,RETSTR+2
  1059                                  CHKRET:
  1060 0000072F 89D6                    	MOV	SI,DX
  1061 00000731 AC                      	LODSB
  1062 00000732 3A07                    	CMP	AL,[BX]
  1063 00000734 7545                    	JNZ	LOOKIT
  1064 00000736 4B                      	DEC	BX
  1065 00000737 4A                      	DEC	DX
  1066 00000738 FECD                    	DEC	CH
  1067 0000073A 75F3                    	JNZ	CHKRET
  1068 0000073C 8B16[9F20]              	MOV	DX,[LSTRET]
  1069 00000740 88D0                    	MOV	AL,DL
  1070 00000742 20F0                    	AND	AL,DH
  1071 00000744 FEC0                    	INC	AL
  1072 00000746 740F                    	JZ	ALLRET
  1073 00000748 8B1E[1B20]              	MOV	BX,[PC]
  1074 0000074C 29D3                    	SUB	BX,DX
  1075 0000074E 88D8                    	MOV	AL,BL
  1076 00000750 98                      	CBW
  1077 00000751 39D8                    	CMP	AX,BX		;Signed 8-bit number?
  1078 00000753 B001                    	MOV	AL,1
  1079 00000755 741F                    	JZ	CHKRETUDRET
  1080                                  ALLRET:
  1081 00000757 8B1E[A120]              	MOV	BX,[RETPT]
  1082 0000075B 88F8                    	MOV	AL,BH
  1083 0000075D 08D8                    	OR	AL,BL
  1084 0000075F B000                    	MOV	AL,0
  1085 00000761 7513                    	JNZ	CHKRETUDRET
  1086 00000763 8B1E[8420]              	MOV	BX,[HEAP]
  1087 00000767 4B                      	DEC	BX
  1088 00000768 4B                      	DEC	BX
  1089 00000769 4B                      	DEC	BX
  1090 0000076A 891E[8420]              	MOV	[HEAP],BX
  1091 0000076E 30C0                    	XOR	AL,AL
  1092 00000770 8807                    	MOV	[BX],AL
  1093 00000772 891E[A120]              	MOV	[RETPT],BX
  1094                                  CHKRETUDRET:
  1095 00000776 C3                      	RET
  1096                                  LOOKUP:
  1097 00000777 4B                      	DEC	BX
  1098 00000778 800F80                  	OR	BYTE[BX],080H
  1099                                  LOOKIT:
  1100 0000077B 8B1E[8220]              	MOV	BX,[BASE]
  1101 0000077F 88F8                    	MOV	AL,BH
  1102 00000781 08D8                    	OR	AL,BL
  1103 00000783 741E                    	JZ	EMPTY
  1104 00000785 E866FF                  	CALL	LOOK
  1105 00000788 7210                    	JC	ENTER
  1106 0000078A BA0400                  	MOV	DX,4
  1107 0000078D 01D3                    	ADD	BX,DX
  1108 0000078F 8A07                    	MOV	AL,[BX]
  1109 00000791 08C0                    	OR	AL,AL
  1110 00000793 7404                    	JZ	LOOKITUDRET
  1111 00000795 43                      	INC	BX
  1112 00000796 8B17                    	MOV	DX,[BX]
  1113 00000798 43                      	INC	BX
  1114                                  LOOKITUDRET:
  1115 00000799 C3                      	RET
  1116                                  ENTER:
  1117 0000079A 53                      	PUSH	BX		;Save pointer to link field
  1118 0000079B E80D00                  	CALL	CREATE		;Add the node
  1119 0000079E 5E                      	POP	SI
  1120 0000079F 8954FF                  	MOV	[SI-1],DX	;Link new node
  1121 000007A2 C3                      	RET			;Zero was set by CREATE
  1122                                  
  1123                                  EMPTY:
  1124 000007A3 E80500                  	CALL	CREATE
  1125 000007A6 8916[8220]              	MOV	[BASE],DX
  1126 000007AA C3                      	RET
  1127                                  
  1128                                  
  1129                                  CREATE:
  1130                                  
  1131                                  ; Add a new node to the identifier tree. The identifier is at ID with
  1132                                  ; bit 7 of the last character set to one. The length of the identifier is
  1133                                  ; in LENID, which is ID-1.
  1134                                  ;
  1135                                  ; Node format:
  1136                                  ;	1. Length of identifier (1 byte)
  1137                                  ;	2. Identifier (1-80 bytes)
  1138                                  ;	3. Left link (2-byte pointer to alphabetically smaller identifiers)
  1139                                  ;	4. Right link (0 if none larger)
  1140                                  ;	5. Data field:
  1141                                  ;	   a. Defined flag (0=undefined, 1=defined)
  1142                                  ;	   b. Value (2 bytes)
  1143                                  ;
  1144                                  ; This routine returns with AL=zero and zero flag set (which indicates
  1145                                  ; on return from LOOKUP that it has not yet been defined), DX points
  1146                                  ; to start of new node, and BX points to data field of new node.
  1147                                  
  1148 000007AB A0[2F20]                	MOV	AL,[LENID]
  1149 000007AE 0408                    	ADD	AL,8		;Storage needed for the node
  1150 000007B0 8B1E[8420]              	MOV	BX,[HEAP]
  1151 000007B4 88C2                    	MOV	DL,AL
  1152 000007B6 B600                    	MOV	DH,0
  1153 000007B8 29D3                    	SUB	BX,DX		;Heap grows downward
  1154 000007BA 891E[8420]              	MOV	[HEAP],BX
  1155 000007BE 87DA                    	XCHG	DX,BX
  1156 000007C0 8B1E[8820]              	MOV	BX,[CODE]	;Check to make sure there's enough
  1157 000007C4 39D3                    	CMP	BX,DX
  1158 000007C6 7203                    	JB	$+5
  1159 000007C8 E9A8F9                  	JMP	ABORT
  1160 000007CB 52                      	PUSH	DX
  1161 000007CC BB[2F20]                	MOV	BX,LENID
  1162 000007CF 8A0F                    	MOV	CL,[BX]
  1163 000007D1 FEC1                    	INC	CL
  1164 000007D3 B500                    	MOV	CH,0
  1165 000007D5 FC                      	CLD
  1166 000007D6 89DE                    	MOV	SI,BX
  1167 000007D8 89D7                    	MOV	DI,DX
  1168 000007DA F3                      	REP
  1169 000007DB A4                      	MOVSB			;Move identifier and length into node
  1170 000007DC 89FA                    	MOV	DX,DI
  1171 000007DE 89F3                    	MOV	BX,SI
  1172 000007E0 B504                    	MOV	CH,4
  1173 000007E2 87DA                    	XCHG	DX,BX
  1174                                  NILIFY:
  1175 000007E4 880F                    	MOV	[BX],CL		;Zero left and right links
  1176 000007E6 43                      	INC	BX
  1177 000007E7 FECD                    	DEC	CH
  1178 000007E9 75F9                    	JNZ	NILIFY
  1179 000007EB 30C0                    	XOR	AL,AL		;Set zero flag
  1180 000007ED 8807                    	MOV	[BX],AL		;Zero defined flag
  1181 000007EF 5A                      	POP	DX		;Restore pointer to node
  1182 000007F0 C3                      	RET
  1183                                  
  1184                                  CPSLP:
  1185 000007F1 89D6                    	MOV	SI,DX
  1186 000007F3 AC                      	LODSB
  1187 000007F4 3A07                    	CMP	AL,[BX]
  1188 000007F6 9F                      	LAHF
  1189 000007F7 42                      	INC	DX
  1190 000007F8 43                      	INC	BX
  1191 000007F9 9E                      	SAHF
  1192 000007FA 7504                    	JNZ	CPSLPUDRET
  1193 000007FC FECD                    	DEC	CH
  1194 000007FE 75F1                    	JNZ	CPSLP
  1195                                  CPSLPUDRET:
  1196                                  GETLABUDRET:
  1197 00000800 C3                      	RET
  1198                                  GETLAB:
  1199 00000801 BB0000                  	MOV	BX,0
  1200 00000804 891E[1F20]              	MOV	[LABPT],BX
  1201 00000808 C606[2120]FF            	MOV	BYTE[FLAG],-1
  1202 0000080D B600                    	MOV	DH,0
  1203 0000080F A0[8020]                	MOV	AL,[CHR]
  1204 00000812 3C21                    	CMP	AL,' '+1
  1205 00000814 7203                    	JC	NOT1
  1206 00000816 80CE01                  	OR	DH,001H
  1207                                  NOT1:
  1208 00000819 E89CFD                  	CALL	GETLET
  1209 0000081C 72E2                    	JC	GETLABUDRET
  1210 0000081E 3C3A                    	CMP	AL,':'
  1211 00000820 7505                    	JNZ	LABCHK
  1212 00000822 E891F9                  	CALL	NEXTCHR
  1213 00000825 EB07                    	JMP SHORT	LABEL
  1214                                  LABCHK:
  1215 00000827 08C0                    	OR	AL,AL
  1216 00000829 F6C601                  	TEST	DH,001H
  1217 0000082C 74D2                    	JZ	GETLABUDRET
  1218                                  LABEL:
  1219 0000082E A0[9C20]                	MOV	AL,[CHKLAB]
  1220 00000831 08C0                    	OR	AL,AL
  1221 00000833 7403                    	JZ	$+5
  1222 00000835 E980FD                  	JMP	GETLET
  1223 00000838 E83CFF                  	CALL	LOOKUP
  1224 0000083B B10B                    	MOV	CL,11
  1225 0000083D 7511                    	JNZ	ERR5
  1226 0000083F 8B16[1B20]              	MOV	DX,[PC]
  1227 00000843 C60701                  	MOV	BYTE[BX],1
  1228 00000846 43                      	INC	BX
  1229 00000847 8917                    	MOV	[BX],DX
  1230 00000849 891E[1F20]              	MOV	[LABPT],BX
  1231 0000084D E968FD                  	JMP	GETLET
  1232                                  
  1233 00000850 E95FF9                  ERR5:	JMP	ERROR
  1234                                  ASMLIN:
  1235 00000853 C606[2220]01            	MOV	BYTE[MAXFLG],1	;Allow only B and W flags normally
  1236 00000858 8B1E[1B20]              	MOV	BX,[PC]
  1237 0000085C 891E[1D20]              	MOV	[OLDPC],BX
  1238 00000860 E89EFF                  	CALL	GETLAB
  1239 00000863 7303                    	JNC	$+5
  1240 00000865 E9E9F8                  	JMP	ENDLN
  1241 00000868 BB[2F20]                	MOV	BX,LENID
  1242 0000086B 8A07                    	MOV	AL,[BX]
  1243 0000086D B10C                    	MOV	CL,12
  1244 0000086F 2C02                    	SUB	AL,2
  1245 00000871 88C5                    	MOV	CH,AL
  1246 00000873 72DB                    	JC	ERR5
  1247 00000875 43                      	INC	BX
  1248 00000876 803F66                  	CMP	BYTE[BX],"f"	;See if an 8087 mnemonic
  1249 00000879 744C                    	JZ	NDPOP
  1250 0000087B 3C05                    	CMP	AL,5
  1251 0000087D 73D1                    	JNC	ERR5
  1252 0000087F 8A07                    	MOV	AL,[BX]
  1253 00000881 2C61                    	SUB	AL,'a'
  1254 00000883 88C1                    	MOV	CL,AL
  1255 00000885 00C0                    	ADD	AL,AL
  1256 00000887 00C0                    	ADD	AL,AL
  1257 00000889 00C8                    	ADD	AL,CL
  1258 0000088B 00E8                    	ADD	AL,CH
  1259 0000088D 00C0                    	ADD	AL,AL
  1260 0000088F BB[F619]                	MOV	BX,OPTAB
  1261 00000892 88C2                    	MOV	DL,AL
  1262 00000894 B600                    	MOV	DH,0
  1263 00000896 01D3                    	ADD	BX,DX
  1264 00000898 8B1F                    	MOV	BX,[BX]
  1265 0000089A FEC5                    	INC	CH
  1266 0000089C 88E9                    	MOV	CL,CH
  1267 0000089E 8A27                    	MOV	AH,[BX]
  1268 000008A0 43                      	INC	BX
  1269 000008A1 08E4                    	OR	AH,AH
  1270 000008A3 7418                    	JZ	OPERR
  1271                                  FINDOP:
  1272 000008A5 88CD                    	MOV	CH,CL
  1273 000008A7 BA[3120]                	MOV	DX,ID+1
  1274 000008AA 95                      	XCHG	AX,BP		;Save count of opcodes in BP
  1275 000008AB E843FF                  	CALL	CPSLP
  1276 000008AE 7412                    	JZ	HAVOP
  1277 000008B0 95                      	XCHG	AX,BP
  1278 000008B1 B600                    	MOV	DH,0
  1279 000008B3 88EA                    	MOV	DL,CH
  1280 000008B5 42                      	INC	DX
  1281 000008B6 42                      	INC	DX
  1282 000008B7 01D3                    	ADD	BX,DX
  1283 000008B9 FECC                    	DEC	AH
  1284 000008BB 75E8                    	JNZ	FINDOP
  1285                                  OPERR:
  1286 000008BD B10C                    	MOV	CL,12
  1287 000008BF E9F0F8                  	JMP	ERROR
  1288                                  
  1289                                  HAVOP:
  1290 000008C2 8A4702                  	MOV	AL,[BX+2]	;Get opcode
  1291 000008C5 FF27                    	JMP	[BX]
  1292                                  
  1293                                  NDPOP:	;First letter is "F" so must be 8087 opcode ("Numeric Data Processor")
  1294 000008C7 C606[2220]04            	MOV	BYTE[MAXFLG],4	;Allow all type flags
  1295 000008CC 43                      	INC	BX
  1296 000008CD 803F6E                  	CMP	BYTE[BX],"n"	;"No-wait" form?
  1297 000008D0 B400                    	MOV	AH,0
  1298 000008D2 7505                    	JNZ	SAVNFLG
  1299 000008D4 B401                    	MOV	AH,1
  1300 000008D6 FEC8                    	DEC	AL
  1301 000008D8 43                      	INC	BX		;Skip over the "N"
  1302                                  SAVNFLG:
  1303 000008D9 8826[A620]              	MOV	[NOWAIT],AH	;0 for wait, 1 for no wait
  1304 000008DD 3C01                    	CMP	AL,1
  1305 000008DF 72DC                    	JB	OPERR		;Not enough char left for valid opcode?
  1306 000008E1 3C05                    	CMP	AL,5
  1307 000008E3 77D8                    	JA	OPERR		;Too many?
  1308 000008E5 98                      	CBW
  1309 000008E6 92                      	XCHG	AX,DX		;Save length in DX
  1310 000008E7 89D6                    	MOV	SI,DX
  1311 000008E9 800880                  	OR	BYTE[SI+BX],80H	;Set high bit of last character
  1312 000008EC 8A07                    	MOV	AL,[BX]		;Get first char of opcode
  1313 000008EE 43                      	INC	BX
  1314 000008EF 2C61                    	SUB	AL,"a"
  1315 000008F1 7228                    	JB	TRY2XM1		;Go see if opcode starts with "2"
  1316 000008F3 3C19                    	CMP	AL,"z"-"a"
  1317 000008F5 77C6                    	JA	OPERR
  1318 000008F7 98                      	CBW
  1319 000008F8 D1E0                    	SHL	AX,1		;Double to index into address table
  1320 000008FA 96                      	XCHG	AX,SI		;Put in index register
  1321 000008FB 8BBC[FA1A]              	MOV	DI,[SI+NDPTAB]	;Get start of opcode table for this letter
  1322                                  LOOKNDP:
  1323 000008FF 8A25                    	MOV	AH,[DI]		;Number of opcodes starting with this letter
  1324 00000901 08E4                    	OR	AH,AH
  1325 00000903 74B8                    	JZ	OPERR		;Any start with this letter?
  1326                                  FNDNDP:
  1327 00000905 47                      	INC	DI
  1328 00000906 89DE                    	MOV	SI,BX		;Pointer to start of opcode
  1329 00000908 89D1                    	MOV	CX,DX		;Get length of opcode
  1330 0000090A F3                      	REPE
  1331 0000090B A6                      	CMPSB			;Compare opcode to table entry
  1332 0000090C 7438                    	JZ	HAVNDP
  1333 0000090E 4F                      	DEC	DI		;Back up in case that was last letter
  1334 0000090F B080                    	MOV	AL,80H		;Look for char with high bit set
  1335                                  ENDOP:
  1336 00000911 AE                      	SCASB
  1337 00000912 77FD                    	JA	ENDOP
  1338 00000914 47                      	INC	DI		;Skip over info about opcode
  1339 00000915 FECC                    	DEC	AH
  1340 00000917 75EC                    	JNZ	FNDNDP
  1341 00000919 EBA2                    OPERRJ:	JMP SHORT	OPERR
  1342                                  
  1343                                  TRY2XM1:
  1344 0000091B 3CD1                    	CMP	AL,"2"-"a"
  1345 0000091D 759E                    	JNZ	OPERR
  1346 0000091F BF[8418]                	MOV	DI,XM1
  1347 00000922 EBDB                    	JMP SHORT	LOOKNDP
  1348                                  
  1349                                  SPECIALOP:
  1350 00000924 2407                    	AND	AL,7		;Mask to special op number
  1351 00000926 7416                    	JZ	FWAIT		;If zero, go handle FWAIT
  1352                                  ;Handle FNOP
  1353 00000928 803E[A620]00            	CMP	BYTE[NOWAIT],0	;Was "N" present (If not opcode was "FOP")
  1354 0000092D 748E                    	JZ	OPERR
  1355 0000092F B09B                    	MOV	AL,9BH		;Need Wait opcode after all
  1356 00000931 E86601                  	CALL	PUT
  1357 00000934 B0D9                    	MOV	AL,0D9H
  1358 00000936 E86101                  	CALL	PUT
  1359 00000939 B0D0                    	MOV	AL,0D0H
  1360 0000093B E95C01                  	JMP	PUT
  1361                                  
  1362                                  FWAIT:
  1363 0000093E 803E[A620]00            	CMP	BYTE[NOWAIT],0	;"FNWAIT" not legal
  1364 00000943 75D4                    	JNZ	OPERRJ
  1365 00000945 C3                      	RET			;Nothing to do - "WAIT" already sent
  1366                                  
  1367                                  HAVNDP:
  1368 00000946 89FE                    	MOV	SI,DI
  1369 00000948 803E[A620]00            	CMP	BYTE[NOWAIT],0
  1370 0000094D 7505                    	JNZ	NWAIT
  1371 0000094F B09B                    	MOV	AL,9BH		;Wait opcode
  1372 00000951 E84601                  	CALL	PUT
  1373                                  NWAIT:
  1374 00000954 AD                      	LODSW			;Get opcode info
  1375 00000955 A8F8                    	TEST	AL,0F8H		;Any operand bits set?
  1376 00000957 7466                    	JZ	NOOPS		;If no operands, output code
  1377 00000959 A878                    	TEST	AL,78H		;Special case?
  1378 0000095B 74C7                    	JZ	SPECIALOP
  1379 0000095D 50                      	PUSH	AX
  1380 0000095E E8A1FB                  	CALL	GETSYM		;See if any operands
  1381 00000961 59                      	POP	CX
  1382 00000962 3C3B                    	CMP	AL,";"
  1383 00000964 7452                    	JZ	NOOPCHK
  1384 00000966 3C0D                    	CMP	AL,EOL
  1385 00000968 744E                    	JZ	NOOPCHK
  1386 0000096A 3C06                    	CMP	AL,FREG		;Is it 8087 register?
  1387 0000096C 756F                    	JNZ	MEMOP
  1388 0000096E 91                      	XCHG	AX,CX
  1389 0000096F A840                    	TEST	AL,ONEREG	;One register OK as operand?
  1390 00000971 7536                    	JNZ	PUTREG		;Yes - save it
  1391 00000973 A820                    	TEST	AL,20H		;Memory-only operation?
  1392 00000975 B114                    	MOV	CL,20
  1393 00000977 7561                    	JNZ	ERRJ4
  1394 00000979 A818                    	TEST	AL,18H		;Two-register operation?
  1395 0000097B 7A5D                    	JPE	ERRJ4		;Must be exactly one bit set
  1396 0000097D 52                      	PUSH	DX		;Save register number
  1397 0000097E 50                      	PUSH	AX		;Save opcode
  1398 0000097F E880FB                  	CALL	GETSYM
  1399 00000982 3C2C                    	CMP	AL,","
  1400 00000984 B115                    	MOV	CL,15H
  1401 00000986 7552                    	JNZ	ERRJ4
  1402 00000988 E877FB                  	CALL	GETSYM
  1403 0000098B B114                    	MOV	CL,20
  1404 0000098D 3C06                    	CMP	AL,FREG
  1405 0000098F 7549                    	JNZ	ERRJ4
  1406 00000991 58                      	POP	AX
  1407 00000992 5B                      	POP	BX
  1408 00000993 3402                    	XOR	AL,2		;Flip "POP" bit
  1409 00000995 24FB                    	AND	AL,0FBH		;Reset direction bit to ST(0)
  1410 00000997 08DB                    	OR	BL,BL		;Is first register ST(0)?
  1411 00000999 740A                    	JZ	ST0DEST
  1412 0000099B 87DA                    	XCHG	DX,BX
  1413 0000099D 08DB                    	OR	BL,BL		;One of these must be ST(0)
  1414 0000099F 7539                    	JNZ	ERRJ4
  1415 000009A1 3404                    	XOR	AL,4		;Flip direction
  1416 000009A3 EB04                    	JMP SHORT	PUTREG
  1417                                  ST0DEST:
  1418 000009A5 A802                    	TEST	AL,2		;Is POP bit set?
  1419 000009A7 7531                    	JNZ	ERRJ4		;Don't allow destination ST(0) then pop
  1420                                  PUTREG:
  1421 000009A9 80E4F8                  	AND	AH,0F8H		;Zero out register field
  1422 000009AC 08D4                    	OR	AH,DL
  1423 000009AE 80CCC0                  	OR	AH,0C0H
  1424 000009B1 50                      	PUSH	AX
  1425 000009B2 E84DFB                  	CALL	GETSYM		;Get to next symbol
  1426 000009B5 58                      	POP	AX
  1427 000009B6 EB07                    	JMP SHORT	NOOPS
  1428                                  
  1429                                  NOOPCHK:
  1430 000009B8 91                      	XCHG	AX,CX
  1431 000009B9 A880                    	TEST	AL,80H		;Is no operands OK?
  1432 000009BB B114                    	MOV	CL,20
  1433 000009BD 751B                    	JNZ	ERRJ4
  1434                                  NOOPS:
  1435                                  ;First test for FDIV or FSUB and reverse "R" bit if "D" bit is set
  1436 000009BF 50                      	PUSH	AX
  1437 000009C0 2505E0                  	AND	AX,0E005H
  1438 000009C3 3D04E0                  	CMP	AX,0E004H
  1439 000009C6 58                      	POP	AX
  1440 000009C7 7503                    	JNZ	NOREV
  1441 000009C9 80F408                  	XOR	AH,8		;Reverse "R" bit
  1442                                  NOREV:
  1443 000009CC 2407                    	AND	AL,7
  1444 000009CE 0CD8                    	OR	AL,0D8H		;ESC hook
  1445 000009D0 E8C700                  	CALL	PUT
  1446 000009D3 88E0                    	MOV	AL,AH
  1447 000009D5 E9C200                  	JMP	PUT
  1448                                  
  1449                                  BADFLAG:
  1450 000009D8 B120                    	MOV	CL,20H
  1451 000009DA E9D5F7                  ERRJ4:	JMP	ERROR
  1452                                  
  1453                                  MEMOP:
  1454 000009DD 51                      	PUSH	CX		;Save opcode
  1455 000009DE E8EAF8                  	CALL	GETOP1		;Get memory operand
  1456 000009E1 3C00                    	CMP	AL,UNDEFID	;Is it?
  1457 000009E3 B114                    	MOV	CL,20
  1458 000009E5 75F3                    	JNZ	ERRJ4
  1459 000009E7 58                      	POP	AX
  1460 000009E8 A820                    	TEST	AL,20H		;Does it have memory format field?
  1461 000009EA 7508                    	JNZ	GETFORMAT
  1462 000009EC A808                    	TEST	AL,8		;Check if any memory operand legal
  1463 000009EE 74EA                    	JZ	ERRJ4
  1464 000009F0 A810                    	TEST	AL,10H		;Check for 2-op arithmetic
  1465 000009F2 751E                    	JNZ	PUTMEM		;If not, just use as plain memory op
  1466                                  GETFORMAT:
  1467 000009F4 24F9                    	AND	AL,0F9H		;Zero memory format bits
  1468 000009F6 8A0E[2120]              	MOV	CL,[FLAG]
  1469 000009FA FEC9                    	DEC	CL		;Must now be in range 0-3
  1470 000009FC 7CDA                    	JL	BADFLAG
  1471 000009FE 88C5                    	MOV	CH,AL		;Save opcode byte
  1472 00000A00 D0E8                    	SHR	AL,1		;Put format bits in bits 2 & 3
  1473 00000A02 240C                    	AND	AL,0CH
  1474 00000A04 08C8                    	OR	AL,CL		;Combine format bits with flag
  1475 00000A06 BB[220A]                	MOV	BX,FORMATTAB
  1476 00000A09 D7                      	XLAT
  1477 00000A0A 08C0                    	OR	AL,AL		;Valid combination?
  1478 00000A0C 78CA                    	JS	BADFLAG
  1479 00000A0E 08C4                    	OR	AH,AL		;Possibly set new bits in second byte
  1480 00000A10 08E8                    	OR	AL,CH		;Set memory format bits
  1481                                  PUTMEM:
  1482 00000A12 2407                    	AND	AL,7
  1483 00000A14 0CD8                    	OR	AL,0D8H
  1484 00000A16 E88100                  	CALL	PUT
  1485 00000A19 88E0                    	MOV	AL,AH
  1486 00000A1B 2438                    	AND	AL,38H
  1487 00000A1D 08D0                    	OR	AL,DL		;Combine addressing mode
  1488 00000A1F E93801                  	JMP	PUTADD
  1489                                  
  1490                                  FORMATTAB:
  1491                                  ;There are 16 entries in this table. The 4-bit index is built like this:
  1492                                  ;	Bit 3		0 for normal memory ops, 1 if extended is OK
  1493                                  ;	Bit 2		0 for integer, 1 for real
  1494                                  ;	Bit 0 & 1	Flag: 00=W, 01=S, 10=L, 11=T
  1495                                  ;
  1496                                  ;The entries in the table are used as two 3-bit fields. Bits 0-2 are ORed
  1497                                  ;into the first byte of the opcode for the Memory Format field. Bits 3-6
  1498                                  ;are ORed into the second byte to modify the opcode for extended operands.
  1499                                  ;If bit 7 is set, then that combination is illegal.
  1500                                  
  1501 00000A22 06028080                	DB	6,2,80H,80H	;Normal integers
  1502 00000A26 80000480                	DB	80H,0,4,80H	;Normal reals
  1503 00000A2A 06022E80                	DB	6,2,2EH,80H	;Extended integers
  1504 00000A2E 8000042B                	DB	80H,0,4,2BH	;Extended reals
  1505                                  
  1506                                  GRP1:
  1507 00000A32 B9098A                  	MOV	CX,8A09H
  1508 00000A35 E8B4F7                  	CALL	MROPS
  1509 00000A38 B9C600                  	MOV	CX,0C6H
  1510 00000A3B 88F8                    	MOV	AL,BH
  1511 00000A3D 3C00                    	CMP	AL,UNDEFID
  1512 00000A3F 7503                    	JNZ	L0006
  1513 00000A41 E83B00                  	CALL	STIMM
  1514                                  L0006:	
  1515 00000A44 2401                    	AND	AL,1
  1516 00000A46 740A                    	JZ	BYTIMM
  1517 00000A48 B0B8                    	MOV	AL,0B8H
  1518 00000A4A 08D8                    	OR	AL,BL
  1519 00000A4C E84B00                  	CALL	PUT
  1520 00000A4F E99700                  	JMP	PUTWOR
  1521                                  
  1522                                  BYTIMM:
  1523 00000A52 B0B0                    	MOV	AL,0B0H
  1524 00000A54 08D8                    	OR	AL,BL
  1525 00000A56 E84100                  	CALL	PUT
  1526 00000A59 E99400                  PUTBJ:	JMP	PUTBYT
  1527                                  
  1528                                  IMMED:
  1529 00000A5C 88F8                    	MOV	AL,BH
  1530 00000A5E 3C00                    	CMP	AL,UNDEFID
  1531 00000A60 741D                    	JZ	STIMM
  1532 00000A62 88D8                    	MOV	AL,BL
  1533 00000A64 08C0                    	OR	AL,AL
  1534 00000A66 7431                    	JZ	IMMEDUDRET
  1535 00000A68 88F8                    	MOV	AL,BH
  1536 00000A6A E81D00                  	CALL	IMM
  1537 00000A6D 0CC0                    	OR	AL,0C0H
  1538 00000A6F E82800                  	CALL	PUT
  1539                                  FINIMM:
  1540 00000A72 88C8                    	MOV	AL,CL
  1541 00000A74 59                      	POP	CX
  1542 00000A75 A801                    	TEST	AL,1
  1543 00000A77 74E0                    	JZ	PUTBJ
  1544 00000A79 3C83                    	CMP	AL,83H
  1545 00000A7B 74DC                    	JZ	PUTBJ
  1546 00000A7D EB6A                    	JMP	PUTWOR
  1547                                  STIMM:
  1548 00000A7F A0[2120]                	MOV	AL,[FLAG]
  1549 00000A82 E80500                  	CALL	IMM
  1550 00000A85 E8D200                  	CALL	PUTADD
  1551 00000A88 EBE8                    	JMP SHORT	FINIMM
  1552                                  
  1553                                  IMM:
  1554 00000A8A 2401                    	AND	AL,1
  1555 00000A8C 08C8                    	OR	AL,CL
  1556 00000A8E 88C1                    	MOV	CL,AL
  1557 00000A90 E80700                  	CALL	PUT
  1558 00000A93 88E8                    	MOV	AL,CH
  1559 00000A95 2438                    	AND	AL,38H
  1560 00000A97 08D8                    	OR	AL,BL
  1561                                  IMMEDUDRET:
  1562 00000A99 C3                      	RET
  1563                                  
  1564                                  PUT:
  1565                                  ;Save byte in AL as pure code, with intermediate code bits 00. AL and
  1566                                  ;DI destroyed, no other registers affected.
  1567 00000A9A 53                      	PUSH	BX
  1568 00000A9B 51                      	PUSH	CX
  1569 00000A9C B500                    	MOV	CH,0		;Flag as pure code
  1570 00000A9E E80300                  	CALL	GEN
  1571 00000AA1 59                      	POP	CX
  1572 00000AA2 5B                      	POP	BX
  1573 00000AA3 C3                      	RET
  1574                                  
  1575                                  GEN:
  1576                                  ;Save byte of code in AL, given intermediate code bits in bits 7&8 of CH.
  1577 00000AA4 E83400                  	CALL	PUTINC		;Save it and bump code pointer
  1578                                  GEN1:
  1579 00000AA7 A0[8B20]                	MOV	AL,[RELOC]
  1580 00000AAA D0D5                    	RCL	CH,1
  1581 00000AAC D0D0                    	RCL	AL,1
  1582 00000AAE D0D5                    	RCL	CH,1
  1583 00000AB0 D0D0                    	RCL	AL,1
  1584 00000AB2 A2[8B20]                	MOV	[RELOC],AL
  1585 00000AB5 BB[8C20]                	MOV	BX,BCOUNT
  1586 00000AB8 FE0F                    	DEC	BYTE[BX]
  1587 00000ABA 751E                    	JNZ	GENUDRET
  1588 00000ABC C60704                  	MOV	BYTE[BX],4
  1589 00000ABF BB[8B20]                	MOV	BX,RELOC
  1590 00000AC2 8A07                    	MOV	AL,[BX]
  1591 00000AC4 C60700                  	MOV	BYTE[BX],0
  1592 00000AC7 8B3E[A920]              	MOV	DI,[IY]
  1593 00000ACB 8805                    	MOV	[DI],AL
  1594 00000ACD 8B1E[8820]              	MOV	BX,[CODE]
  1595 00000AD1 891E[A920]              	MOV	[IY],BX
  1596 00000AD5 43                      	INC	BX
  1597 00000AD6 891E[8820]              	MOV	[CODE],BX
  1598                                  GENUDRET:
  1599 00000ADA C3                      	RET
  1600                                  PUTINC:
  1601 00000ADB FF06[1B20]              	INC	WORD[PC]
  1602                                  PUTCD:
  1603 00000ADF 8B3E[8820]              	MOV	DI,[CODE]
  1604 00000AE3 AA                      	STOSB
  1605 00000AE4 893E[8820]              	MOV	[CODE],DI
  1606 00000AE8 C3                      	RET
  1607                                  
  1608                                  PUTWOR:
  1609                                  ;Save the word value described by [DLABEL] and [DATA] as code. If defined,
  1610                                  ;two bytes of pure code will be produced. Otherwise, appropriate intermediate
  1611                                  ;code will be generated.
  1612 00000AE9 51                      	PUSH	CX
  1613 00000AEA B580                    	MOV	CH,80H
  1614 00000AEC 52                      	PUSH	DX
  1615 00000AED 53                      	PUSH	BX
  1616 00000AEE EB20                    	JMP SHORT	PUTBW
  1617                                  
  1618                                  PUTBYT:
  1619                                  ;Same as PUTWOR, above, but for byte value.
  1620 00000AF0 51                      	PUSH	CX
  1621 00000AF1 B540                    	MOV	CH,40H
  1622 00000AF3 52                      	PUSH	DX
  1623 00000AF4 53                      	PUSH	BX
  1624 00000AF5 8B1E[2920]              	MOV	BX,[DLABEL]
  1625 00000AF9 88F8                    	MOV	AL,BH
  1626 00000AFB 08D8                    	OR	AL,BL
  1627 00000AFD 7511                    	JNZ	PUTBW
  1628 00000AFF 8B1E[2720]              	MOV	BX,[DATA]
  1629 00000B03 08F8                    	OR	AL,BH
  1630 00000B05 7409                    	JZ	PUTBW
  1631 00000B07 FEC7                    	INC	BH
  1632 00000B09 7405                    	JZ	PUTBW
  1633 00000B0B B11F                    	MOV	CL,31
  1634 00000B0D E9A2F6                  	JMP	ERROR
  1635                                  PUTBW:
  1636 00000B10 8B16[2920]              	MOV	DX,[DLABEL]
  1637 00000B14 8B1E[2720]              	MOV	BX,[DATA]
  1638                                  PUTCHK:
  1639 00000B18 09D2                    	OR	DX,DX
  1640 00000B1A 7425                    	JZ	NOUNDEF
  1641 00000B1C 88D0                    	MOV	AL,DL
  1642 00000B1E E8BEFF                  	CALL	PUTCD
  1643 00000B21 88F0                    	MOV	AL,DH
  1644 00000B23 E8B9FF                  	CALL	PUTCD
  1645 00000B26 88D8                    	MOV	AL,BL
  1646 00000B28 E8B0FF                  	CALL	PUTINC
  1647 00000B2B 88F8                    	MOV	AL,BH
  1648 00000B2D F6C580                  	TEST	CH,080H
  1649 00000B30 7405                    	JZ	SMPUT
  1650 00000B32 E86FFF                  	CALL	GEN
  1651 00000B35 EB06                    	JMP SHORT	PRET
  1652                                  SMPUT:
  1653 00000B37 E8A5FF                  	CALL	PUTCD
  1654 00000B3A E86AFF                  	CALL	GEN1
  1655                                  PRET:
  1656 00000B3D 5B                      	POP	BX
  1657 00000B3E 5A                      	POP	DX
  1658 00000B3F 59                      	POP	CX
  1659 00000B40 C3                      	RET
  1660                                  
  1661                                  NOUNDEF:
  1662 00000B41 88D8                    	MOV	AL,BL
  1663 00000B43 88F9                    	MOV	CL,BH
  1664 00000B45 51                      	PUSH	CX
  1665 00000B46 B500                    	MOV	CH,0
  1666 00000B48 E859FF                  	CALL	GEN
  1667 00000B4B 59                      	POP	CX
  1668 00000B4C 88C8                    	MOV	AL,CL
  1669 00000B4E F6C580                  	TEST	CH,080H
  1670 00000B51 B500                    	MOV	CH,0
  1671 00000B53 74E8                    	JZ	PRET
  1672 00000B55 E84CFF                  	CALL	GEN
  1673 00000B58 EBE3                    	JMP SHORT	PRET
  1674                                  
  1675                                  PUTADD:
  1676                                  ;Save complete addressing mode. Addressing mode is in AL; if this is a register
  1677                                  ;operation (>=C0), then the one byte will be saved as pure code. Otherwise,
  1678                                  ;the details of the addressing mode will be investigated and the optional one-
  1679                                  ;or two-byte displacement will be added, as described by [ADDR] and [ALABEL].
  1680 00000B5A 51                      	PUSH	CX
  1681 00000B5B 52                      	PUSH	DX
  1682 00000B5C 53                      	PUSH	BX
  1683 00000B5D B500                    	MOV	CH,0
  1684 00000B5F 88C1                    	MOV	CL,AL
  1685 00000B61 E840FF                  	CALL	GEN		;Save the addressing mode as pure code
  1686 00000B64 88C8                    	MOV	AL,CL
  1687 00000B66 B580                    	MOV	CH,80H
  1688 00000B68 24C7                    	AND	AL,0C7H
  1689 00000B6A 3C06                    	CMP	AL,6
  1690 00000B6C 740A                    	JZ	TWOBT		;Direct address?
  1691 00000B6E 24C0                    	AND	AL,0C0H
  1692 00000B70 74CB                    	JZ	PRET		;Indirect through reg, no displacement?
  1693 00000B72 3CC0                    	CMP	AL,0C0H
  1694 00000B74 74C7                    	JZ	PRET		;Register to register operation?
  1695 00000B76 88C5                    	MOV	CH,AL		;Save whether one- or two-byte displacement
  1696                                  TWOBT:
  1697 00000B78 8B1E[2320]              	MOV	BX,[ADDR]
  1698 00000B7C 8B16[2520]              	MOV	DX,[ALABEL]
  1699 00000B80 EB96                    	JMP SHORT	PUTCHK
  1700                                  
  1701                                  GRP2:
  1702 00000B82 E843F7                  	CALL	GETOP
  1703 00000B85 B930FF                  	MOV	CX,0FF30H
  1704 00000B88 3C00                    	CMP	AL,UNDEFID
  1705 00000B8A 7414                    	JZ	PMEM
  1706 00000B8C B550                    	MOV	CH,50H
  1707 00000B8E 3C03                    	CMP	AL,XREG
  1708 00000B90 7419                    	JZ	PXREG
  1709 00000B92 B506                    	MOV	CH,6
  1710 00000B94 3C04                    	CMP	AL,SREG
  1711 00000B96 7503                    	JNZ	$+5
  1712 00000B98 E90004                  	JMP	PACKREG
  1713 00000B9B B114                    	MOV	CL,20
  1714 00000B9D E912F6                  	JMP	ERROR
  1715                                  
  1716                                  PMEM:
  1717 00000BA0 88E8                    	MOV	AL,CH
  1718 00000BA2 E8F5FE                  	CALL	PUT
  1719 00000BA5 88C8                    	MOV	AL,CL
  1720 00000BA7 08D0                    	OR	AL,DL
  1721 00000BA9 EBAF                    	JMP	PUTADD
  1722                                  
  1723                                  PXREG:
  1724 00000BAB 88E8                    	MOV	AL,CH
  1725 00000BAD 08D0                    	OR	AL,DL
  1726 00000BAF E9E8FE                  	JMP	PUT
  1727                                  
  1728                                  GRP3:
  1729 00000BB2 E813F7                  	CALL	GETOP
  1730 00000BB5 52                      	PUSH	DX
  1731 00000BB6 E806F7                  	CALL	GETOP2
  1732 00000BB9 5B                      	POP	BX
  1733 00000BBA B91486                  	MOV	CX,8614H
  1734 00000BBD B004                    	MOV	AL,SREG
  1735 00000BBF 38F8                    	CMP	AL,BH
  1736 00000BC1 744C                    	JZ	ERR6
  1737 00000BC3 38F0                    	CMP	AL,DH
  1738 00000BC5 7448                    	JZ	ERR6
  1739 00000BC7 B001                    	MOV	AL,CONST
  1740 00000BC9 38F8                    	CMP	AL,BH
  1741 00000BCB 7442                    	JZ	ERR6
  1742 00000BCD 38F0                    	CMP	AL,DH
  1743 00000BCF 743E                    	JZ	ERR6
  1744 00000BD1 B000                    	MOV	AL,UNDEFID
  1745 00000BD3 38F8                    	CMP	AL,BH
  1746 00000BD5 742D                    	JZ	EXMEM
  1747 00000BD7 38F0                    	CMP	AL,DH
  1748 00000BD9 742B                    	JZ	EXMEM1
  1749 00000BDB 88F8                    	MOV	AL,BH
  1750 00000BDD 38F0                    	CMP	AL,DH
  1751 00000BDF B116                    	MOV	CL,22
  1752 00000BE1 752C                    	JNZ	ERR6
  1753 00000BE3 3C03                    	CMP	AL,XREG
  1754 00000BE5 7403                    	JZ	L0008
  1755 00000BE7 E83BF6                  	CALL	RR1
  1756                                  L0008:			;RR1 never returns
  1757 00000BEA 88D8                    	MOV	AL,BL
  1758 00000BEC 08C0                    	OR	AL,AL
  1759 00000BEE 740D                    	JZ	EXACC
  1760 00000BF0 87DA                    	XCHG	DX,BX
  1761 00000BF2 88D8                    	MOV	AL,BL
  1762 00000BF4 08C0                    	OR	AL,AL
  1763 00000BF6 88F8                    	MOV	AL,BH
  1764 00000BF8 7403                    	JZ	EXACC
  1765 00000BFA E828F6                  	CALL	RR1
  1766                                  EXACC:
  1767 00000BFD B090                    	MOV	AL,90H
  1768 00000BFF 08D0                    	OR	AL,DL
  1769 00000C01 E996FE                  	JMP	PUT
  1770                                  
  1771                                  EXMEM:
  1772 00000C04 87DA                    	XCHG	DX,BX
  1773                                  EXMEM1:
  1774 00000C06 38F8                    	CMP	AL,BH
  1775 00000C08 7405                    	JZ	ERR6
  1776 00000C0A B101                    	MOV	CL,1	;Flag word as OK
  1777 00000C0C E890F6                  	CALL	NOTAC	;NOTAC never returns
  1778 00000C0F E9A0F5                  ERR6:	JMP	ERROR
  1779                                  
  1780                                  GRP4:
  1781 00000C12 50                      	PUSH	AX
  1782 00000C13 E8B2F6                  	CALL	GETOP
  1783 00000C16 59                      	POP	CX
  1784 00000C17 86E9                    	XCHG	CL,CH
  1785 00000C19 3C01                    	CMP	AL,CONST
  1786 00000C1B 7413                    	JZ	FIXED
  1787 00000C1D 2C03                    	SUB	AL,XREG
  1788 00000C1F FECA                    	DEC	DL
  1789 00000C21 FECA                    	DEC	DL
  1790 00000C23 08D0                    	OR	AL,DL
  1791 00000C25 B114                    	MOV	CL,20
  1792 00000C27 75E6                    	JNZ	ERR6
  1793 00000C29 88E8                    	MOV	AL,CH
  1794 00000C2B 0C08                    	OR	AL,8
  1795 00000C2D E96AFE                  	JMP	PUT
  1796                                  FIXED:
  1797 00000C30 88E8                    	MOV	AL,CH
  1798 00000C32 E865FE                  	CALL	PUT
  1799 00000C35 E9B8FE                  	JMP	PUTBYT
  1800                                  
  1801                                  GRP5:
  1802 00000C38 50                      	PUSH	AX
  1803 00000C39 E88CF6                  	CALL	GETOP
  1804 00000C3C B114                    	MOV	CL,20
  1805 00000C3E 3C01                    	CMP	AL,CONST
  1806 00000C40 75CD                    	JNZ	ERR6
  1807 00000C42 8B1E[2920]              	MOV	BX,[DLABEL]
  1808 00000C46 88F8                    	MOV	AL,BH
  1809 00000C48 08D8                    	OR	AL,BL
  1810 00000C4A B11E                    	MOV	CL,30
  1811 00000C4C 75C1                    	JNZ	ERR6
  1812 00000C4E 8B1E[2720]              	MOV	BX,[DATA]
  1813 00000C52 58                      	POP	AX
  1814 00000C53 08C0                    	OR	AL,AL
  1815 00000C55 7443                    	JZ	UDORG
  1816 00000C57 FEC8                    	DEC	AL
  1817 00000C59 7419                    	JZ	DSJ
  1818 00000C5B FEC8                    	DEC	AL
  1819 00000C5D 7427                    	JZ	EQU
  1820 00000C5F FEC8                    	DEC	AL
  1821 00000C61 7403                    	JZ	$+5
  1822 00000C63 E99803                  	JMP	UDIF
  1823                                  PUTOP:
  1824 00000C66 B0FD                    	MOV	AL,-3
  1825 00000C68 EB36                    	JMP SHORT	NEWLOC
  1826                                  UDALIGN:
  1827 00000C6A A0[1B20]                	MOV	AL,[PC]
  1828 00000C6D 2401                    	AND	AL,1
  1829 00000C6F 7428                    	JZ	UDALIGNUDRET
  1830 00000C71 BB0100                  	MOV	BX,1
  1831                                  DSJ:
  1832 00000C74 87DA                    	XCHG	DX,BX
  1833 00000C76 8B1E[1B20]              	MOV	BX,[PC]
  1834 00000C7A 01D3                    	ADD	BX,DX
  1835 00000C7C 891E[1B20]              	MOV	[PC],BX
  1836 00000C80 87DA                    	XCHG	DX,BX
  1837 00000C82 B0FC                    	MOV	AL,-4
  1838 00000C84 EB1A                    	JMP SHORT	NEWLOC
  1839                                  EQU:
  1840 00000C86 87DA                    	XCHG	DX,BX
  1841 00000C88 8B1E[1F20]              	MOV	BX,[LABPT]
  1842 00000C8C 88F8                    	MOV	AL,BH
  1843 00000C8E 08D8                    	OR	AL,BL
  1844 00000C90 B122                    	MOV	CL,34
  1845 00000C92 7427                    	JZ	ERR7
  1846 00000C94 8817                    	MOV	[BX],DL
  1847 00000C96 43                      	INC	BX
  1848 00000C97 8837                    	MOV	[BX],DH
  1849                                  UDALIGNUDRET:
  1850 00000C99 C3                      	RET
  1851                                  UDORG:
  1852 00000C9A 891E[1B20]              	MOV	[PC],BX
  1853 00000C9E B0FE                    	MOV	AL,-2
  1854                                  NEWLOC:
  1855 00000CA0 E83CFE                  	CALL	PUTCD
  1856 00000CA3 88D8                    	MOV	AL,BL
  1857 00000CA5 E837FE                  	CALL	PUTCD
  1858 00000CA8 88F8                    	MOV	AL,BH
  1859 00000CAA E832FE                  	CALL	PUTCD
  1860 00000CAD B5C0                    	MOV	CH,0C0H
  1861 00000CAF E9F5FD                  	JMP	GEN1
  1862                                  GRP6:
  1863 00000CB2 88C5                    	MOV	CH,AL
  1864 00000CB4 B104                    	MOV	CL,4
  1865 00000CB6 E833F5                  	CALL	MROPS
  1866 00000CB9 B117                    	MOV	CL,23
  1867 00000CBB E9F4F4                  ERR7:	JMP	ERROR
  1868                                  GRP7:
  1869 00000CBE 88C5                    	MOV	CH,AL
  1870 00000CC0 B101                    	MOV	CL,1
  1871 00000CC2 E827F5                  	CALL	MROPS
  1872 00000CC5 B180                    	MOV	CL,80H
  1873 00000CC7 8B16[2920]              	MOV	DX,[DLABEL]
  1874 00000CCB 88F0                    	MOV	AL,DH
  1875 00000CCD 08D0                    	OR	AL,DL
  1876 00000CCF 7512                    	JNZ	ACCJ
  1877 00000CD1 87DA                    	XCHG	DX,BX
  1878 00000CD3 8B1E[2720]              	MOV	BX,[DATA]
  1879 00000CD7 88D8                    	MOV	AL,BL
  1880 00000CD9 98                      	CBW
  1881 00000CDA 39D8                    	CMP	AX,BX
  1882 00000CDC 87DA                    	XCHG	DX,BX
  1883 00000CDE 7503                    	JNZ	ACCJ
  1884 00000CE0 80C902                  	OR	CL,002H
  1885 00000CE3 E9B700                  ACCJ:	JMP	ACCIMM
  1886                                  GRP8:
  1887 00000CE6 88C1                    	MOV	CL,AL
  1888 00000CE8 B5FE                    	MOV	CH,0FEH
  1889 00000CEA EB04                    	JMP SHORT	ONEOP
  1890                                  GRP9:
  1891 00000CEC 88C1                    	MOV	CL,AL
  1892 00000CEE B5F6                    	MOV	CH,0F6H
  1893                                  ONEOP:
  1894 00000CF0 51                      	PUSH	CX
  1895 00000CF1 E8D4F5                  	CALL	GETOP
  1896                                  ONE:
  1897 00000CF4 B11A                    	MOV	CL,26
  1898 00000CF6 3C01                    	CMP	AL,CONST
  1899 00000CF8 74C1                    	JZ	ERR7
  1900 00000CFA 3C04                    	CMP	AL,SREG
  1901 00000CFC B116                    	MOV	CL,22
  1902 00000CFE 74BB                    	JZ	ERR7
  1903 00000D00 59                      	POP	CX
  1904 00000D01 3C00                    	CMP	AL,UNDEFID
  1905 00000D03 7412                    	JZ	MOP
  1906 00000D05 2401                    	AND	AL,1
  1907 00000D07 7421                    	JZ	ROP
  1908 00000D09 F6C101                  	TEST	CL,001H
  1909 00000D0C 741C                    	JZ	ROP
  1910 00000D0E 88C8                    	MOV	AL,CL
  1911 00000D10 24F8                    	AND	AL,0F8H
  1912 00000D12 08D0                    	OR	AL,DL
  1913 00000D14 E983FD                  	JMP	PUT
  1914                                  MOP:
  1915 00000D17 A0[2120]                	MOV	AL,[FLAG]
  1916 00000D1A 2401                    	AND	AL,1
  1917 00000D1C 08E8                    	OR	AL,CH
  1918 00000D1E E879FD                  	CALL	PUT
  1919 00000D21 88C8                    	MOV	AL,CL
  1920 00000D23 2438                    	AND	AL,38H
  1921 00000D25 08D0                    	OR	AL,DL
  1922 00000D27 E930FE                  	JMP	PUTADD
  1923                                  ROP:
  1924 00000D2A 08E8                    	OR	AL,CH
  1925 00000D2C E86BFD                  	CALL	PUT
  1926 00000D2F 88C8                    	MOV	AL,CL
  1927 00000D31 2438                    	AND	AL,38H
  1928 00000D33 0CC0                    	OR	AL,0C0H
  1929 00000D35 08D0                    	OR	AL,DL
  1930 00000D37 E960FD                  	JMP	PUT
  1931                                  GRP10:
  1932 00000D3A 88C1                    	MOV	CL,AL
  1933 00000D3C B5F6                    	MOV	CH,0F6H
  1934 00000D3E 51                      	PUSH	CX
  1935 00000D3F E886F5                  	CALL	GETOP
  1936 00000D42 B114                    	MOV	CL,20
  1937 00000D44 88D0                    	MOV	AL,DL
  1938 00000D46 08C0                    	OR	AL,AL
  1939 00000D48 7508                    	JNZ	ERRJ1
  1940 00000D4A 88F0                    	MOV	AL,DH
  1941 00000D4C 3C03                    	CMP	AL,XREG
  1942 00000D4E 7404                    	JZ	G10
  1943 00000D50 3C02                    	CMP	AL,REG
  1944 00000D52 7567                    ERRJ1:	JNZ	ERR8
  1945                                  G10:
  1946 00000D54 50                      	PUSH	AX
  1947 00000D55 E870F5                  	CALL	GETOP
  1948 00000D58 58                      	POP	AX
  1949 00000D59 2401                    	AND	AL,1
  1950 00000D5B A2[2120]                	MOV	[FLAG],AL
  1951 00000D5E 88F0                    	MOV	AL,DH
  1952 00000D60 EB92                    ONEJ:	JMP SHORT	ONE
  1953                                  GRP11:
  1954 00000D62 E835FD                  	CALL	PUT
  1955 00000D65 B00A                    	MOV	AL,0AH
  1956 00000D67 E930FD                  	JMP	PUT
  1957                                  GRP12:
  1958 00000D6A 88C1                    	MOV	CL,AL
  1959 00000D6C B5D0                    	MOV	CH,0D0H
  1960 00000D6E 51                      	PUSH	CX
  1961 00000D6F E856F5                  	CALL	GETOP
  1962 00000D72 A0[8120]                	MOV	AL,[SYM]
  1963 00000D75 3C2C                    	CMP	AL,','
  1964 00000D77 88F0                    	MOV	AL,DH
  1965 00000D79 75E5                    	JNZ	ONEJ
  1966 00000D7B 52                      	PUSH	DX
  1967 00000D7C E849F5                  	CALL	GETOP
  1968 00000D7F 2C02                    	SUB	AL,REG
  1969 00000D81 B114                    	MOV	CL,20
  1970 00000D83 FECA                    	DEC	DL
  1971 00000D85 08D0                    	OR	AL,DL
  1972 00000D87 7532                    	JNZ	ERR8
  1973 00000D89 5A                      	POP	DX
  1974 00000D8A 88F0                    	MOV	AL,DH
  1975 00000D8C 59                      	POP	CX
  1976 00000D8D 80CD02                  	OR	CH,002H
  1977 00000D90 51                      	PUSH	CX
  1978 00000D91 E960FF                  	JMP	ONE
  1979                                  GRP13:
  1980 00000D94 88C5                    	MOV	CH,AL
  1981 00000D96 B101                    	MOV	CL,1
  1982 00000D98 E851F4                  	CALL	MROPS
  1983 00000D9B B180                    	MOV	CL,80H
  1984                                  ACCIMM:
  1985 00000D9D E8BCFC                  	CALL	IMMED
  1986 00000DA0 80CD04                  	OR	CH,004H
  1987 00000DA3 80E5FD                  	AND	CH,0FDH
  1988                                  AIMM:
  1989 00000DA6 88F8                    	MOV	AL,BH
  1990 00000DA8 2401                    	AND	AL,1
  1991 00000DAA 9F                      	LAHF
  1992 00000DAB 50                      	PUSH	AX
  1993 00000DAC 08E8                    	OR	AL,CH
  1994 00000DAE E8E9FC                  	CALL	PUT
  1995 00000DB1 58                      	POP	AX
  1996 00000DB2 9E                      	SAHF
  1997 00000DB3 7503                    	JNZ	$+5
  1998 00000DB5 E938FD                  	JMP	PUTBYT
  1999 00000DB8 E92EFD                  	JMP	PUTWOR
  2000                                  
  2001 00000DBB E9F4F3                  ERR8:	JMP	ERROR
  2002                                  
  2003                                  GRP14:
  2004                                  ;JMP and CALL mnemonics
  2005 00000DBE 9F                      	LAHF
  2006 00000DBF 86C4                    	XCHG	AH,AL
  2007 00000DC1 50                      	PUSH	AX
  2008 00000DC2 86C4                    	XCHG	AH,AL
  2009 00000DC4 C606[2220]03            	MOV	BYTE[MAXFLG],3	;Allow "L" flag
  2010 00000DC9 E8FCF4                  	CALL	GETOP
  2011 00000DCC 3C01                    	CMP	AL,CONST
  2012 00000DCE 7433                    	JZ	DIRECT
  2013 00000DD0 B114                    	MOV	CL,20
  2014 00000DD2 3C02                    	CMP	AL,REG
  2015 00000DD4 74E5                    	JZ	ERR8
  2016 00000DD6 3C04                    	CMP	AL,SREG
  2017 00000DD8 74E1                    	JZ	ERR8
  2018 00000DDA 3C03                    	CMP	AL,XREG
  2019 00000DDC 7503                    	JNZ	NOTRG
  2020 00000DDE 80CAC0                  	OR	DL,0C0H
  2021                                  NOTRG:
  2022                                  ;Indirect jump. DL has addressing mode.
  2023 00000DE1 B0FF                    	MOV	AL,0FFH
  2024 00000DE3 E8B4FC                  	CALL	PUT
  2025 00000DE6 58                      	POP	AX
  2026 00000DE7 86C4                    	XCHG	AH,AL
  2027 00000DE9 9E                      	SAHF
  2028 00000DEA 2438                    	AND	AL,38H
  2029 00000DEC 08D0                    	OR	AL,DL
  2030 00000DEE 8A2E[2120]              	MOV	CH,[FLAG]
  2031 00000DF2 80FD03                  	CMP	CH,3		;Flag "L" present?
  2032 00000DF5 7409                    	JZ	PUTADDJ		;If so, do inter-segment
  2033 00000DF7 B127                    	MOV	CL,27H
  2034 00000DF9 80FDFF                  	CMP	CH,-1		;Better not be a flag
  2035 00000DFC 75BD                    	JNZ	ERR8
  2036 00000DFE 24F7                    	AND	AL,0F7H		;Convert to intra-segment
  2037                                  PUTADDJ:
  2038 00000E00 E957FD                  	JMP	PUTADD
  2039                                  DIRECT:
  2040 00000E03 A0[8120]                	MOV	AL,[SYM]
  2041 00000E06 3C2C                    	CMP	AL,','
  2042 00000E08 741C                    	JZ	LONGJ
  2043 00000E0A 58                      	POP	AX
  2044 00000E0B 86C4                    	XCHG	AH,AL
  2045 00000E0D 9E                      	SAHF
  2046 00000E0E FEC8                    	DEC	AL
  2047 00000E10 3CE9                    	CMP	AL,0E9H
  2048 00000E12 7402                    	JZ	GOTOP
  2049 00000E14 B0E8                    	MOV	AL,0E8H
  2050                                  GOTOP:
  2051 00000E16 E881FC                  	CALL	PUT
  2052 00000E19 8B16[1B20]              	MOV	DX,[PC]
  2053 00000E1D 42                      	INC	DX
  2054 00000E1E 42                      	INC	DX
  2055 00000E1F 2916[2720]              	SUB	[DATA],DX
  2056 00000E23 E9C3FC                  	JMP	PUTWOR
  2057                                  LONGJ:
  2058 00000E26 58                      	POP	AX
  2059 00000E27 86C4                    	XCHG	AH,AL
  2060 00000E29 9E                      	SAHF
  2061 00000E2A E86DFC                  	CALL	PUT
  2062 00000E2D E8B9FC                  	CALL	PUTWOR
  2063 00000E30 E895F4                  	CALL	GETOP
  2064 00000E33 B114                    	MOV	CL,20
  2065 00000E35 3C01                    	CMP	AL,CONST
  2066 00000E37 7582                    	JNZ	ERR8
  2067 00000E39 E9ADFC                  	JMP	PUTWOR
  2068                                  
  2069                                  GRP16:
  2070                                  ;RET mnemonic
  2071 00000E3C 9F                      	LAHF
  2072 00000E3D 86C4                    	XCHG	AH,AL
  2073 00000E3F 50                      	PUSH	AX
  2074 00000E40 86C4                    	XCHG	AH,AL
  2075 00000E42 E8BDF6                  	CALL	GETSYM
  2076 00000E45 3C05                    	CMP	AL,5
  2077 00000E47 741C                    	JZ	LONGR
  2078 00000E49 3C0D                    	CMP	AL,EOL
  2079 00000E4B 743F                    	JZ	NODEC
  2080 00000E4D 3C3B                    	CMP	AL,';'
  2081 00000E4F 743B                    	JZ	NODEC
  2082                                  GETSP:
  2083 00000E51 E877F4                  	CALL	GETOP1
  2084 00000E54 59                      	POP	CX
  2085 00000E55 3C01                    	CMP	AL,CONST
  2086 00000E57 B114                    	MOV	CL,20
  2087 00000E59 7563                    	JNZ	ERR9
  2088 00000E5B 88E8                    	MOV	AL,CH
  2089 00000E5D 24FE                    	AND	AL,0FEH
  2090 00000E5F E838FC                  	CALL	PUT
  2091 00000E62 E984FC                  	JMP	PUTWOR
  2092                                  LONGR:
  2093 00000E65 80FA03                  	CMP	DL,3		;Is flag "L"?
  2094 00000E68 B127                    	MOV	CL,27H
  2095 00000E6A 757D                    	JNZ	ERR10		;If not, bad flag
  2096 00000E6C 58                      	POP	AX
  2097 00000E6D 86C4                    	XCHG	AH,AL
  2098 00000E6F 9E                      	SAHF
  2099 00000E70 0C08                    	OR	AL,8
  2100 00000E72 9F                      	LAHF
  2101 00000E73 86C4                    	XCHG	AH,AL
  2102 00000E75 50                      	PUSH	AX
  2103 00000E76 86C4                    	XCHG	AH,AL
  2104                                  NOTLON:
  2105 00000E78 E887F6                  	CALL	GETSYM
  2106 00000E7B 3C0D                    	CMP	AL,EOL
  2107 00000E7D 742E                    	JZ	DORET
  2108 00000E7F 3C3B                    	CMP	AL,';'
  2109 00000E81 742A                    	JZ	DORET
  2110 00000E83 3C2C                    	CMP	AL,','
  2111 00000E85 7503                    	JNZ	L0011
  2112 00000E87 E878F6                  	CALL	GETSYM
  2113                                  L0011:	
  2114 00000E8A EBC5                    	JMP SHORT	GETSP
  2115                                  NODEC:
  2116                                  ;Return is intra-segment (short) without add to SP. 
  2117                                  ;Record position for RET symbol.
  2118 00000E8C 8B1E[1B20]              	MOV	BX,[PC]
  2119 00000E90 891E[9F20]              	MOV	[LSTRET],BX
  2120 00000E94 87DA                    	XCHG	DX,BX
  2121 00000E96 8B1E[A120]              	MOV	BX,[RETPT]
  2122 00000E9A 88F8                    	MOV	AL,BH
  2123 00000E9C 08D8                    	OR	AL,BL
  2124 00000E9E 740D                    	JZ	DORET
  2125 00000EA0 C60701                  	MOV	BYTE[BX],1
  2126 00000EA3 43                      	INC	BX
  2127 00000EA4 8917                    	MOV	[BX],DX
  2128 00000EA6 BB0000                  	MOV	BX,0
  2129 00000EA9 891E[A120]              	MOV	[RETPT],BX
  2130                                  DORET:
  2131 00000EAD 58                      	POP	AX
  2132 00000EAE 86C4                    	XCHG	AH,AL
  2133 00000EB0 9E                      	SAHF
  2134 00000EB1 E9E6FB                  	JMP	PUT
  2135                                  
  2136                                  GRP17:
  2137 00000EB4 E8E3FB                  	CALL	PUT
  2138 00000EB7 E80EF4                  	CALL	GETOP
  2139 00000EBA 3C01                    	CMP	AL,CONST
  2140 00000EBC B114                    	MOV	CL,20
  2141 00000EBE 7529                    ERR9:	JNZ	ERR10
  2142 00000EC0 8B1E[2720]              	MOV	BX,[DATA]
  2143 00000EC4 8B16[1B20]              	MOV	DX,[PC]
  2144 00000EC8 42                      	INC	DX
  2145 00000EC9 29D3                    	SUB	BX,DX
  2146 00000ECB 891E[2720]              	MOV	[DATA],BX
  2147 00000ECF E81EFC                  	CALL	PUTBYT
  2148 00000ED2 8B1E[2920]              	MOV	BX,[DLABEL]
  2149 00000ED6 88F8                    	MOV	AL,BH
  2150 00000ED8 08D8                    	OR	AL,BL
  2151 00000EDA 7510                    	JNZ	GRP17UDRET
  2152 00000EDC 8B1E[2720]              	MOV	BX,[DATA]
  2153 00000EE0 88D8                    	MOV	AL,BL
  2154 00000EE2 98                      	CBW
  2155 00000EE3 39D8                    	CMP	AX,BX		;Signed 8-bit number?
  2156 00000EE5 7405                    	JZ	GRP17UDRET
  2157 00000EE7 B11F                    	MOV	CL,31
  2158 00000EE9 E9C6F2                  ERR10:	JMP	ERROR
  2159                                  GRP17UDRET:
  2160 00000EEC C3                      	RET
  2161                                  GRP18:
  2162 00000EED E8D8F3                  	CALL	GETOP
  2163 00000EF0 3C01                    	CMP	AL,CONST
  2164 00000EF2 B114                    	MOV	CL,20
  2165 00000EF4 75F3                    	JNZ	ERR10
  2166 00000EF6 8B1E[2920]              	MOV	BX,[DLABEL]
  2167 00000EFA 88F8                    	MOV	AL,BH
  2168 00000EFC 08D8                    	OR	AL,BL
  2169 00000EFE 7510                    	JNZ	GENINT
  2170 00000F00 8B1E[2720]              	MOV	BX,[DATA]
  2171 00000F04 BA0300                  	MOV	DX,3
  2172 00000F07 19D3                    	SBB	BX,DX
  2173 00000F09 7505                    	JNZ	GENINT
  2174 00000F0B B0CC                    	MOV	AL,0CCH
  2175 00000F0D E98AFB                  	JMP	PUT
  2176                                  GENINT:
  2177 00000F10 B0CD                    	MOV	AL,0CDH
  2178 00000F12 E885FB                  	CALL	PUT
  2179 00000F15 E9D8FB                  	JMP	PUTBYT
  2180                                  
  2181                                  GRP19:	;ESC opcode
  2182 00000F18 E8ADF3                  	CALL	GETOP
  2183 00000F1B B114                    	MOV	CL,20
  2184 00000F1D 3C01                    	CMP	AL,CONST
  2185 00000F1F 7539                    	JNZ	ERRJ		;First operand must be immediate
  2186 00000F21 B11E                    	MOV	CL,1EH
  2187 00000F23 F706[2920]FFFF          	TEST	WORD[DLABEL],-1	;See if all labels have been defined
  2188 00000F29 752F                    	JNZ	ERRJ
  2189 00000F2B A1[2720]                	MOV	AX,[DATA]
  2190 00000F2E 83F840                  	CMP	AX,64		;Must only be 6 bits
  2191 00000F31 B11F                    	MOV	CL,1FH
  2192 00000F33 7325                    	JNB	ERRJ
  2193 00000F35 88C3                    	MOV	BL,AL		;Save for second byte
  2194 00000F37 D0E8                    	SHR	AL,1
  2195 00000F39 D0E8                    	SHR	AL,1
  2196 00000F3B D0E8                    	SHR	AL,1
  2197 00000F3D 0CD8                    	OR	AL,0D8H		;ESC opcode
  2198 00000F3F E858FB                  	CALL	PUT
  2199 00000F42 53                      	PUSH	BX
  2200 00000F43 E879F3                  	CALL	GETOP2
  2201 00000F46 5B                      	POP	BX
  2202 00000F47 80E307                  	AND	BL,7		;Low 3 bits of first operand
  2203 00000F4A D0E3                    	SHL	BL,1
  2204 00000F4C D0E3                    	SHL	BL,1
  2205 00000F4E D0E3                    	SHL	BL,1
  2206 00000F50 3C00                    	CMP	AL,UNDEFID	;Check for memory operand
  2207 00000F52 7409                    	JZ	ESCMEM
  2208 00000F54 3C01                    	CMP	AL,CONST	;Check for another immediate
  2209 00000F56 740C                    	JZ	ESCIMM
  2210 00000F58 B114                    	MOV	CL,20
  2211 00000F5A E955F2                  ERRJ:	JMP	ERROR
  2212                                  
  2213                                  ESCMEM:
  2214 00000F5D 08D3                    	OR	BL,DL		;Combine mode with first operand
  2215 00000F5F 88D8                    	MOV	AL,BL
  2216 00000F61 E9F6FB                  	JMP	PUTADD
  2217                                  
  2218                                  ESCIMM:
  2219 00000F64 B11E                    	MOV	CL,1EH
  2220 00000F66 F706[2920]FFFF          	TEST WORD[DLABEL],-1	;See if second operand is fully defined
  2221 00000F6C 75EC                    	JNZ	ERRJ
  2222 00000F6E A1[2720]                	MOV	AX,[DATA]
  2223 00000F71 B11F                    	MOV	CL,1FH
  2224 00000F73 83F808                  	CMP	AX,8		;Must only be 3 bit value
  2225 00000F76 73E2                    	JNB	ERRJ
  2226 00000F78 08D8                    	OR	AL,BL		;Combine first and second operands
  2227 00000F7A 0CC0                    	OR	AL,0C0H		;Force "register" mode
  2228 00000F7C E91BFB                  	JMP	PUT
  2229                                  
  2230                                  GRP20:
  2231 00000F7F 88C5                    	MOV	CH,AL
  2232 00000F81 B101                    	MOV	CL,1
  2233 00000F83 E866F2                  	CALL	MROPS
  2234 00000F86 B1F6                    	MOV	CL,0F6H
  2235 00000F88 E8D1FA                  	CALL	IMMED
  2236 00000F8B B5A8                    	MOV	CH,0A8H
  2237 00000F8D E916FE                  	JMP	AIMM
  2238                                  GRP21:
  2239 00000F90 E835F3                  	CALL	GETOP
  2240 00000F93 3C04                    	CMP	AL,SREG
  2241 00000F95 B11C                    	MOV	CL,28
  2242 00000F97 75C1                    	JNZ	ERRJ
  2243 00000F99 B526                    	MOV	CH,26H
  2244                                  PACKREG:
  2245 00000F9B 88D0                    	MOV	AL,DL
  2246 00000F9D 00C0                    	ADD	AL,AL
  2247 00000F9F 00C0                    	ADD	AL,AL
  2248 00000FA1 00C0                    	ADD	AL,AL
  2249 00000FA3 08E8                    	OR	AL,CH
  2250 00000FA5 E9F2FA                  	JMP	PUT
  2251                                  GRP22:
  2252 00000FA8 E81DF3                  	CALL	GETOP
  2253 00000FAB B9008F                  	MOV	CX,8F00H
  2254 00000FAE 3C00                    	CMP	AL,UNDEFID
  2255 00000FB0 7503                    	JNZ	$+5
  2256 00000FB2 E9EBFB                  	JMP	PMEM
  2257 00000FB5 B558                    	MOV	CH,58H
  2258 00000FB7 3C03                    	CMP	AL,XREG
  2259 00000FB9 7503                    	JNZ	$+5
  2260 00000FBB E9EDFB                  	JMP	PXREG
  2261 00000FBE B507                    	MOV	CH,7
  2262 00000FC0 3C04                    	CMP	AL,SREG
  2263 00000FC2 74D7                    	JZ	PACKREG
  2264 00000FC4 B114                    	MOV	CL,20
  2265 00000FC6 E9E9F1                  ERR11:	JMP	ERROR
  2266                                  GRP23:
  2267 00000FC9 A2[8A20]                	MOV	[DATSIZ],AL
  2268                                  GETDAT:
  2269 00000FCC E833F5                  	CALL	GETSYM
  2270 00000FCF B002                    	MOV	AL,2
  2271 00000FD1 E80DF3                  	CALL	VAL1
  2272 00000FD4 A0[8120]                	MOV	AL,[SYM]
  2273 00000FD7 3C2C                    	CMP	AL,','
  2274 00000FD9 A0[8A20]                	MOV	AL,[DATSIZ]
  2275 00000FDC 7505                    	JNZ	ENDDAT
  2276 00000FDE E81300                  	CALL	SAVDAT
  2277 00000FE1 EBE9                    	JMP SHORT	GETDAT
  2278                                  ENDDAT:
  2279 00000FE3 3C02                    	CMP	AL,2
  2280 00000FE5 750D                    	JNZ	SAVDAT
  2281 00000FE7 8B1E[2720]              	MOV	BX,[DATA]
  2282 00000FEB 9F                      	LAHF
  2283 00000FEC 80CB80                  	OR	BL,080H
  2284 00000FEF 9E                      	SAHF
  2285 00000FF0 891E[2720]              	MOV	[DATA],BX
  2286                                  SAVDAT:
  2287 00000FF4 08C0                    	OR	AL,AL
  2288 00000FF6 7403                    	JZ	$+5
  2289 00000FF8 E9F5FA                  	JMP	PUTBYT
  2290 00000FFB E9EBFA                  	JMP	PUTWOR
  2291                                  UDIF:
  2292 00000FFE 09DB                    	OR	BX,BX
  2293 00001000 7405                    	JZ	SKIPCD
  2294 00001002 FE06[9B20]              	INC	BYTE[IFFLG]
  2295 00001006 C3                      	RET
  2296                                  
  2297                                  SKIPCD:
  2298 00001007 FE06[9C20]              	INC	BYTE[CHKLAB]
  2299                                  SKIPLP:
  2300 0000100B 30C0                    	XOR	AL,AL
  2301 0000100D E84BF1                  	CALL	NEXLIN
  2302 00001010 E8A3F1                  	CALL	NEXTCHR
  2303 00001013 3C1A                    	CMP	AL,1AH
  2304 00001015 7440                    	JZ	UDEND
  2305 00001017 E8E7F7                  	CALL	GETLAB
  2306 0000101A 72EF                    	JC	SKIPLP
  2307 0000101C BF[2F20]                	MOV	DI,LENID
  2308 0000101F BE[C51F]                	MOV	SI,IFEND
  2309 00001022 B500                    	MOV	CH,0
  2310 00001024 8A0D                    	MOV	CL,[DI]
  2311 00001026 FEC1                    	INC	CL
  2312 00001028 F3                      	REPE
  2313 00001029 A6                      	CMPSB
  2314 0000102A 7414                    	JZ	ENDCOND
  2315 0000102C BF[2F20]                	MOV	DI,LENID
  2316 0000102F BE[CB1F]                	MOV	SI,IFNEST
  2317 00001032 8A0D                    	MOV	CL,[DI]
  2318 00001034 FEC1                    	INC	CL
  2319 00001036 F3                      	REPE
  2320 00001037 A6                      	CMPSB
  2321 00001038 75D1                    	JNZ	SKIPLP
  2322 0000103A FE06[9C20]              	INC	BYTE[CHKLAB]
  2323 0000103E EBCB                    	JMP SHORT	SKIPLP
  2324                                  
  2325                                  ENDCOND:
  2326 00001040 FE0E[9C20]              	DEC	BYTE[CHKLAB]
  2327 00001044 75C5                    	JNZ	SKIPLP
  2328 00001046 C3                      	RET
  2329                                  
  2330                                  UDENDIF:
  2331 00001047 A0[9B20]                	MOV	AL,[IFFLG]
  2332 0000104A B124                    	MOV	CL,36
  2333 0000104C FEC8                    	DEC	AL
  2334 0000104E 7804                    	JS	ERRJMP
  2335 00001050 A2[9B20]                	MOV	[IFFLG],AL
  2336 00001053 C3                      	RET
  2337                                  
  2338 00001054 E95BF1                  ERRJMP:	JMP	ERROR
  2339                                  
  2340                                  ;*********************************************************************
  2341                                  ;
  2342                                  ;	PASS 2
  2343                                  ;
  2344                                  ;*********************************************************************
  2345                                  
  2346                                  UDEND:
  2347                                  	;DB 0CCH
  2348 00001057 B204                    	MOV	DL,4
  2349                                  WREND:
  2350 00001059 B5FF                    	MOV	CH,0FFH
  2351 0000105B 88E8                    	MOV	AL,CH
  2352 0000105D E844FA                  	CALL	GEN
  2353 00001060 FECA                    	DEC	DL
  2354 00001062 75F5                    	JNZ	WREND
  2355 00001064 C706[F524][F724]        	MOV	WORD[BUFPT],SRCBUF
  2356 0000106A C606[9720]FB            	MOV	BYTE[HEXCNT],-5	;FLAG HEX BUFFER AS EMPTY
  2357 0000106F C706[AD20][F520]        	MOV	WORD[LSTPNT],LSTBUF
  2358 00001075 C706[AB20][AF20]        	MOV	WORD[HEXPNT],HEXBUF
  2359 0000107B 31C0                    	XOR	AX,AX
  2360 0000107D A3[9D20]                	MOV	[ERRCNT],AX
  2361 00001080 A3[1B20]                	MOV	[PC],AX
  2362 00001083 A3[8F20]                	MOV	[LINE],AX	;Current line number
  2363 00001086 C706[9320]0001          	MOV	WORD[HEXADD],OBJECT
  2364                                  	
  2365 0000108C BA5C00                  	MOV	DX,FCB
  2366 0000108F B40F                    	MOV	AH,OPEN
  2367 00001091 CD21                    	INT	33		;Re-open source file
  2368 00001093 31C0                    	XOR	AX,AX
  2369 00001095 A36800                  	MOV	[FCB+12],AX	;Set CURRENT BLOCK to zero
  2370 00001098 A27C00                  	MOV	[FCB+20H],AL	;Set NEXT RECORD field to zero
  2371 0000109B C7066A000004            	MOV	WORD[FCB+14],BUFSIZ
  2372 000010A1 A2[8D20]                	MOV	[COUNT],AL
  2373 000010A4 B501                    	MOV	CH,1
  2374 000010A6 BE[F829]                	MOV	SI,START
  2375                                  FIXLINE:
  2376 000010A9 BF[F829]                	MOV	DI,START	;Store code over used up intermediate code
  2377 000010AC 30C0                    	XOR	AL,AL
  2378 000010AE A2[A520]                	MOV	[SPC],AL	;No "special" yet (ORG, PUT, DS)
  2379 000010B1 A2[8E20]                	MOV	[ERR],AL	;No second pass errors yet
  2380                                  NEXBT:
  2381 000010B4 D0E1                    	SHL	CL,1		;Shift out last bit of previous code
  2382 000010B6 FECD                    	DEC	CH		;Still have codes left?
  2383 000010B8 7505                    	JNZ	TESTTYP
  2384 000010BA AC                      	LODSB			;Get next flag byte
  2385 000010BB 88C1                    	MOV	CL,AL
  2386 000010BD B504                    	MOV	CH,4
  2387                                  TESTTYP:
  2388 000010BF D0E1                    	SHL	CL,1		;Set flags based on two bits
  2389 000010C1 7006                    	JO	FIXUP
  2390 000010C3 AC                      	LODSB
  2391 000010C4 724E                    	JC	EMARK
  2392                                  OBJBT:
  2393 000010C6 AA                      	STOSB
  2394 000010C7 EBEB                    	JMP SHORT	NEXBT
  2395                                  
  2396                                  FIXUP:
  2397                                  ;Either a word or byte fixup is needed from a forward reference
  2398 000010C9 AD                      	LODSW			;Get pointer to symbol
  2399 000010CA 93                      	XCHG	AX,BX
  2400 000010CB AD                      	LODSW			;Get constant part
  2401 000010CC 034701                  	ADD	AX,[BX+1]	;Add symbol value to constant part
  2402 000010CF 803F00                  	CMP	BYTE[BX],0	;See if symbol got defined
  2403 000010D2 7507                    	JNZ	HAVDEF
  2404 000010D4 C606[8E20]64            	MOV	BYTE[ERR],100	;Undefined - flag error
  2405 000010D9 31C0                    	XOR	AX,AX
  2406                                  HAVDEF:
  2407 000010DB 08C9                    	OR	CL,CL		;See if word or byte fixup
  2408 000010DD 7803                    	JS	DEFBYT
  2409 000010DF AB                      	STOSW
  2410 000010E0 EBD2                    	JMP SHORT	NEXBT
  2411                                  
  2412                                  DEFBYT:
  2413 000010E2 89C2                    	MOV	DX,AX
  2414 000010E4 98                      	CBW			;Extend sign
  2415 000010E5 39D0                    	CMP	AX,DX		;See if in range +127 to -128
  2416 000010E7 74DD                    	JZ	OBJBT		;If so, it's always OK
  2417 000010E9 F6D4                    	NOT	AH		;Check for range +255 to -256
  2418 000010EB 38F4                    	CMP	AH,DH
  2419 000010ED 751B                    	JNZ	RNGERR		;Must always be in this range
  2420                                  ;Check for short jump. If so, we're out of range; otherwise we're OK
  2421 000010EF 81FF[F929]              	CMP	DI,START+1	;Only one other byte on line?
  2422 000010F3 75D1                    	JNZ	OBJBT		;Can't be short jump if not
  2423 000010F5 A0[F829]                	MOV	AL,[START]	;Get the first byte of this line
  2424 000010F8 3CEB                    	CMP	AL,0EBH		;Direct short jump?
  2425 000010FA 740E                    	JZ	RNGERR
  2426 000010FC 24FC                    	AND	AL,0FCH
  2427 000010FE 3CE0                    	CMP	AL,0E0H		;LOOP or JCXZ instruction?
  2428 00001100 7408                    	JZ	RNGERR
  2429 00001102 24F0                    	AND	AL,0F0H
  2430 00001104 3C70                    	CMP	AL,70H		;Conditional jump?
  2431 00001106 88D0                    	MOV	AL,DL		;Get code byte in AL
  2432 00001108 75BC                    	JNZ	OBJBT		;If not, we're OK
  2433                                  RNGERR:
  2434 0000110A C606[8E20]65            	MOV	BYTE[ERR],101	;Value out of range
  2435 0000110F EBB5                    	JMP SHORT	OBJBT
  2436                                  
  2437 00001111 E97C01                  FINIJ:	JMP	FINI
  2438                                  
  2439                                  EMARK:
  2440 00001114 3CFF                    	CMP	AL,-1		;End of file?
  2441 00001116 74F9                    	JZ	FINIJ
  2442 00001118 3CF6                    	CMP	AL,-10		;Special item?
  2443 0000111A 775C                    	JA	SPEND
  2444 0000111C 51                      	PUSH	CX
  2445 0000111D 56                      	PUSH	SI
  2446 0000111E 50                      	PUSH	AX		;Save error code
  2447 0000111F 8A26[A320]              	MOV	AH,[LSTDEV]
  2448 00001123 80E4FE                  	AND	AH,0FEH		;Reset error indicator
  2449 00001126 0A06[8E20]              	OR	AL,[ERR]	;See if any errors on this line
  2450 0000112A 7403                    	JZ	NOERR
  2451 0000112C 80CC01                  	OR	AH,1		;Send line to console if error occured
  2452                                  NOERR:
  2453 0000112F 8826[A320]              	MOV	[LSTDEV],AH
  2454 00001133 89F9                    	MOV	CX,DI
  2455 00001135 E8F000                  	CALL	STRTLIN		;Print address of line
  2456 00001138 BE[F829]                	MOV	SI,START
  2457 0000113B 29F1                    	SUB	CX,SI		;Get count of bytes of code
  2458 0000113D 7406                    	JZ	SHOLIN
  2459                                  CODLP:
  2460 0000113F AC                      	LODSB
  2461 00001140 E87702                  	CALL	SAVCD		;Ouput code to HEX and PRN files
  2462 00001143 E2FA                    	LOOP	CODLP
  2463                                  SHOLIN:
  2464 00001145 B000                    	MOV	AL,0
  2465 00001147 8606[8D20]              	XCHG	AL,[COUNT]
  2466 0000114B B90700                  	MOV	CX,7		;Allow 7 bytes of code per line
  2467 0000114E 28C1                    	SUB	CL,AL
  2468 00001150 B020                    	MOV	AL,' '
  2469 00001152 740B                    	JZ	NOFIL
  2470                                  BLNK:				;Put in 3 blanks for each byte not present
  2471 00001154 E8E600                  	CALL	LIST
  2472 00001157 E8E300                  	CALL	LIST
  2473 0000115A E8E000                  	CALL	LIST
  2474 0000115D E2F5                    	LOOP	BLNK
  2475                                  NOFIL:
  2476 0000115F E84500                  	CALL	OUTLIN
  2477 00001162 58                      	POP	AX		;Restore error code
  2478 00001163 E88A02                  	CALL	REPERR
  2479 00001166 A0[8E20]                	MOV	AL,[ERR]
  2480 00001169 E88402                  	CALL	REPERR
  2481 0000116C 5E                      	POP	SI
  2482 0000116D 59                      	POP	CX
  2483 0000116E A0[A520]                	MOV	AL,[SPC]	;Any special funtion?
  2484 00001171 08C0                    	OR	AL,AL
  2485 00001173 750D                    	JNZ	SPCFUN
  2486 00001175 E931FF                  	JMP	FIXLINE
  2487                                  
  2488                                  SPEND:
  2489 00001178 A2[A520]                	MOV	[SPC],AL	;Record special function
  2490 0000117B AD                      	LODSW			;Get it's data
  2491 0000117C A3[2720]                	MOV	[DATA],AX
  2492 0000117F E932FF                  	JMP	NEXBT
  2493                                  
  2494                                  SPCFUN:
  2495 00001182 8B16[2720]              	MOV	DX,[DATA]
  2496 00001186 3CFE                    	CMP	AL,-2
  2497 00001188 740F                    	JZ	DORG
  2498 0000118A 3CFD                    	CMP	AL,-3
  2499 0000118C 7412                    	JZ	DPUT
  2500                                  DDS:
  2501                                  ;Handle DS pseudo-op
  2502 0000118E 0116[1B20]              	ADD	[PC],DX
  2503 00001192 0116[9320]              	ADD	[HEXADD],DX
  2504 00001196 E910FF                  	JMP	FIXLINE
  2505                                  
  2506                                  DORG:
  2507                                  ;Handle ORG pseudo-op
  2508 00001199 8916[1B20]              	MOV	[PC],DX
  2509 0000119D E909FF                  	JMP	FIXLINE
  2510                                  
  2511                                  DPUT:
  2512                                  ;Handle PUT pseudo-op
  2513 000011A0 8916[9320]              	MOV	[HEXADD],DX
  2514 000011A4 E902FF                  	JMP	FIXLINE
  2515                                  
  2516                                  OUTLIN:
  2517                                  ;Copy the source line to the ouput device. Line will be preceded by
  2518                                  ;assembler-generated line number. This routine may be called several times
  2519                                  ;on one line (once for each line of object code bytes), so it sets a flag
  2520                                  ;so the line will only be output on the first call.
  2521 000011A7 B0FF                    	MOV	AL,-1
  2522 000011A9 8606[9920]              	XCHG	AL,[LINFLG]
  2523 000011AD 08C0                    	OR	AL,AL
  2524 000011AF 7535                    	JNZ	CRLF		;Output line only if first time
  2525 000011B1 A1[8F20]                	MOV	AX,[LINE]
  2526 000011B4 40                      	INC	AX
  2527 000011B5 A3[8F20]                	MOV	[LINE],AX
  2528 000011B8 B700                    	MOV	BH,0		;No leading zero suppression
  2529 000011BA E83200                  	CALL	OUT10
  2530 000011BD B020                    	MOV	AL," "
  2531 000011BF E87B00                  	CALL	LIST
  2532 000011C2 A0[F61F]                	MOV	AL,[LSTFCB]
  2533 000011C5 3C5A                    	CMP	AL,'Z'
  2534 000011C7 741D                    	JZ	CRLF		;Don't call NEXTCHR if listing suppressed
  2535 000011C9 56                      	PUSH	SI		;Save the only register destroyed by NEXTCHR
  2536                                  OUTLN:
  2537 000011CA E8E9EF                  	CALL	NEXTCHR
  2538 000011CD E86D00                  	CALL	LIST
  2539 000011D0 3C0A                    	CMP	AL,10		;Output until linefeed found
  2540 000011D2 75F6                    	JNZ	OUTLN
  2541 000011D4 5E                      	POP	SI
  2542 000011D5 C3                      	RET
  2543                                  
  2544                                  PRTCNT:
  2545 000011D6 A1[9D20]                	MOV	AX,[ERRCNT]
  2546 000011D9 BB[731F]                	MOV	BX,ERCNTM
  2547                                  PRNT10:
  2548 000011DC 50                      	PUSH	AX
  2549 000011DD E83F02                  	CALL	PRINT
  2550 000011E0 58                      	POP	AX
  2551 000011E1 B710                    	MOV	BH,"0"-" "	;Enable leading zero suppression
  2552 000011E3 E80900                  	CALL	OUT10
  2553                                  CRLF:
  2554 000011E6 B00D                    	MOV	AL,13
  2555 000011E8 E85200                  	CALL	LIST
  2556 000011EB B00A                    	MOV	AL,10
  2557 000011ED EB4E                    	JMP SHORT	LIST
  2558                                  
  2559                                  OUT10:
  2560 000011EF 31D2                    	XOR	DX,DX
  2561 000011F1 BF1027                  	MOV	DI,10000
  2562 000011F4 F7F7                    	DIV	DI
  2563 000011F6 08C0                    	OR	AL,AL		;>10,000?
  2564 000011F8 7502                    	JNZ	LEAD
  2565 000011FA 2C10                    	SUB	AL,"0"-" "	;Convert leading zero to blank
  2566                                  LEAD:
  2567 000011FC 0430                    	ADD	AL,"0"
  2568 000011FE E83C00                  	CALL	LIST
  2569 00001201 92                      	XCHG	AX,DX
  2570 00001202 B364                    	MOV	BL,100
  2571 00001204 F6F3                    	DIV	BL
  2572 00001206 88E3                    	MOV	BL,AH
  2573 00001208 E80C00                  	CALL	HIDIG		;Convert to decimal and print 1000s digit
  2574 0000120B E80E00                  	CALL	DIGIT		;Print 100s digit
  2575 0000120E 88D8                    	MOV	AL,BL
  2576 00001210 E80400                  	CALL	HIDIG		;Convert to decimal and print 10s digit
  2577 00001213 B700                    	MOV	BH,0		;Ensure leading zero suppression is off
  2578 00001215 EB05                    	JMP SHORT	DIGIT
  2579                                  
  2580                                  HIDIG:
  2581 00001217 D40A                    	AAM			;Convert binary to unpacked BCD
  2582 00001219 0D3030                  	OR	AX,3030H	;Add "0" bias
  2583                                  DIGIT:
  2584 0000121C 86E0                    	XCHG	AL,AH
  2585 0000121E 3C30                    	CMP	AL,"0"
  2586 00001220 7402                    	JZ	SUPZ
  2587 00001222 B700                    	MOV	BH,0		;Turn off zero suppression if not zero
  2588                                  SUPZ:
  2589 00001224 28F8                    	SUB	AL,BH		;Convert leading zeros to blanks
  2590 00001226 EB15                    	JMP SHORT	LIST
  2591                                  
  2592                                  STRTLIN:
  2593 00001228 C606[9920]00            	MOV	BYTE[LINFLG],0
  2594 0000122D 8B1E[1B20]              	MOV	BX,[PC]
  2595 00001231 88F8                    	MOV	AL,BH
  2596 00001233 E84D00                  	CALL	PHEX
  2597 00001236 88D8                    	MOV	AL,BL
  2598                                  PHEXB:
  2599 00001238 E84800                  	CALL	PHEX
  2600 0000123B B020                    	MOV	AL,' '
  2601                                  LIST:
  2602 0000123D 50                      	PUSH	AX
  2603 0000123E 52                      	PUSH	DX
  2604 0000123F 247F                    	AND	AL,7FH
  2605 00001241 88C2                    	MOV	DL,AL
  2606 00001243 F606[A320]03            	TEST	BYTE[LSTDEV],3	;See if output goes to console
  2607 00001248 7404                    	JZ	PRNCHK
  2608 0000124A B402                    	MOV	AH,2
  2609 0000124C CD21                    	INT	33		;Output to console
  2610                                  PRNCHK:
  2611 0000124E F606[A320]04            	TEST	BYTE[LSTDEV],4	;See if output goes to printer
  2612 00001253 7404                    	JZ	FILCHK
  2613 00001255 B405                    	MOV	AH,5
  2614 00001257 CD21                    	INT	33		;Output to printer
  2615                                  FILCHK:
  2616 00001259 88D0                    	MOV	AL,DL
  2617 0000125B 5A                      	POP	DX
  2618 0000125C F606[A320]80            	TEST	BYTE[LSTDEV],80H	;See if output goes to a file
  2619 00001261 7403                    	JZ	LISTRET
  2620 00001263 E80200                  	CALL	WRTBUF
  2621                                  LISTRET:
  2622 00001266 58                      	POP	AX
  2623 00001267 C3                      	RET
  2624                                  
  2625                                  WRTBUF:
  2626 00001268 57                      	PUSH	DI
  2627 00001269 8B3E[AD20]              	MOV	DI,[LSTPNT]
  2628 0000126D AA                      	STOSB
  2629 0000126E 81FF[F524]              	CMP	DI,LSTBUF+LSTBUFSIZ
  2630 00001272 7509                    	JNZ	SAVPT
  2631 00001274 50                      	PUSH	AX
  2632 00001275 51                      	PUSH	CX
  2633 00001276 52                      	PUSH	DX
  2634 00001277 E88802                  	CALL	FLUSHBUF
  2635 0000127A 5A                      	POP	DX
  2636 0000127B 59                      	POP	CX
  2637 0000127C 58                      	POP	AX
  2638                                  SAVPT:
  2639 0000127D 893E[AD20]              	MOV	[LSTPNT],DI
  2640 00001281 5F                      	POP	DI
  2641 00001282 C3                      	RET
  2642                                  
  2643                                  PHEX:
  2644 00001283 50                      	PUSH	AX
  2645 00001284 E89B02                  	CALL	UHALF
  2646 00001287 E8B3FF                  	CALL	LIST
  2647 0000128A 58                      	POP	AX
  2648 0000128B E89C02                  	CALL	LHALF
  2649 0000128E EBAD                    	JMP SHORT	LIST
  2650                                  
  2651                                  FINI:
  2652                                  
  2653 00001290 800E[A320]01            	OR	BYTE[LSTDEV],1
  2654 00001295 E83EFF                  	CALL	PRTCNT
  2655 00001298 BB[841F]                	MOV	BX,SYMSIZE
  2656 0000129B A10600                  	MOV	AX,[6]
  2657 0000129E 2B06[8420]              	SUB	AX,[HEAP]		;Size of symbol table
  2658 000012A2 E837FF                  	CALL	PRNT10
  2659 000012A5 BB[9A1F]                	MOV	BX,FRESIZE
  2660 000012A8 A1[8420]                	MOV	AX,[HEAP]
  2661 000012AB 2B06[8820]              	SUB	AX,[CODE]		;Free space remaining
  2662 000012AF E82AFF                  	CALL	PRNT10
  2663 000012B2 8026[A320]FE            	AND	BYTE[LSTDEV],0FEH
  2664 000012B7 A0[D11F]                	MOV	AL,[HEXFCB]
  2665 000012BA 3C5A                    	CMP	AL,'Z'
  2666 000012BC 7435                    	JZ	SYMDMP
  2667 000012BE A0[9720]                	MOV	AL,[HEXCNT]
  2668 000012C1 3CFB                    	CMP	AL,-5
  2669 000012C3 7403                    	JZ	L0012
  2670 000012C5 E8EC01                  	CALL	ENHEXL
  2671                                  L0012:	
  2672 000012C8 B03A                    	MOV	AL,':'
  2673 000012CA E82B02                  	CALL	PUTCHR
  2674 000012CD B50A                    	MOV	CH,10
  2675                                  HEXEND:
  2676 000012CF 51                      	PUSH	CX
  2677 000012D0 B030                    	MOV	AL,'0'
  2678 000012D2 E82302                  	CALL	PUTCHR
  2679 000012D5 59                      	POP	CX
  2680 000012D6 FECD                    	DEC	CH
  2681 000012D8 75F5                    	JNZ	HEXEND
  2682 000012DA B00D                    	MOV	AL,13
  2683 000012DC E81902                  	CALL	PUTCHR
  2684 000012DF B00A                    	MOV	AL,10
  2685 000012E1 E81402                  	CALL	PUTCHR
  2686 000012E4 B01A                    	MOV	AL,1AH
  2687 000012E6 E80F02                  	CALL	PUTCHR
  2688 000012E9 E8F101                  	CALL	WRTHEX		;Flush HEX file buffer
  2689 000012EC BA[D11F]                	MOV	DX,HEXFCB
  2690 000012EF B410                    	MOV	AH,CLOSE
  2691 000012F1 CD21                    	INT	33
  2692                                  SYMDMP:
  2693 000012F3 A0[8620]                	MOV	AL,[SYMFLG]
  2694 000012F6 3C53                    	CMP	AL,'S'
  2695 000012F8 752A                    	JNZ	ENDSYM
  2696 000012FA A0[A320]                	MOV	AL,[LSTDEV]
  2697 000012FD 08C0                    	OR	AL,AL		;Any output device for symbol table dump?
  2698 000012FF 7505                    	JNZ	DOSYMTAB
  2699 00001301 0C01                    	OR	AL,1		;If not, send it to console
  2700 00001303 A2[A320]                	MOV	[LSTDEV],AL
  2701                                  DOSYMTAB:
  2702                                  
  2703 00001306 BB[AE1F]                	MOV	BX,SYMMES
  2704 00001309 E81301                  	CALL	PRINT
  2705 0000130C 8B16[8220]              	MOV	DX,[BASE]
  2706 00001310 88F0                    	MOV	AL,DH
  2707 00001312 08D0                    	OR	AL,DL
  2708 00001314 740E                    	JZ	ENDSYM
  2709 00001316 C606[8720]05            	MOV	BYTE[SYMLIN],SYMWID  ;No symbols on this line yet
  2710 0000131B 8B1E[8420]              	MOV	BX,[HEAP]
  2711 0000131F 89DC                    	MOV	SP,BX		;Need maximum stack for recursive tree walk
  2712 00001321 E81C00                  	CALL	NODE
  2713                                  ENDSYM:
  2714 00001324 F606[A320]80            	TEST	BYTE[LSTDEV],80H	;Print listing to file?
  2715 00001329 7410                    	JZ	EXIT
  2716 0000132B B01A                    	MOV	AL,1AH
  2717 0000132D E838FF                  	CALL	WRTBUF		;Write end-of-file mark
  2718 00001330 8B3E[AD20]              	MOV	DI,[LSTPNT]
  2719 00001334 E8CB01                  	CALL	FLUSHBUF
  2720 00001337 B410                    	MOV	AH,CLOSE
  2721 00001339 CD21                    	INT	33
  2722                                  EXIT:
  2723 0000133B B8004C                  	MOV AX,4C00H
  2724 0000133E CD21                    	INT 33
  2725                                  
  2726                                  NODE:
  2727 00001340 87DA                    	XCHG	DX,BX
  2728 00001342 53                      	PUSH	BX
  2729 00001343 8A17                    	MOV	DL,[BX]
  2730 00001345 B600                    	MOV	DH,0
  2731 00001347 43                      	INC	BX
  2732 00001348 01D3                    	ADD	BX,DX
  2733 0000134A 8B17                    	MOV	DX,[BX]
  2734 0000134C 09D2                    	OR	DX,DX
  2735 0000134E 7403                    	JZ	L0014
  2736 00001350 E8EDFF                  	CALL	NODE
  2737                                  L0014:	
  2738 00001353 5B                      	POP	BX
  2739 00001354 8A07                    	MOV	AL,[BX]
  2740 00001356 43                      	INC	BX
  2741 00001357 88C5                    	MOV	CH,AL
  2742 00001359 0418                    	ADD	AL,24
  2743 0000135B D0E8                    	SHR	AL,1
  2744 0000135D D0E8                    	SHR	AL,1
  2745 0000135F D0E8                    	SHR	AL,1
  2746 00001361 88C1                    	MOV	CL,AL
  2747 00001363 FEC1                    	INC	CL		;Invert last bit
  2748 00001365 80E101                  	AND	CL,1		;Number of extra tabs needed (0 or 1)
  2749 00001368 D0E8                    	SHR	AL,1		;Number of positions wide this symbol needs
  2750 0000136A 2806[8720]              	SUB	[SYMLIN],AL
  2751 0000136E 730A                    	JNC	WRTSYM		;Will it fit?
  2752 00001370 2C05                    	SUB	AL,SYMWID
  2753 00001372 F6D8                    	NEG	AL
  2754 00001374 A2[8720]                	MOV	[SYMLIN],AL
  2755 00001377 E86CFE                  	CALL	CRLF		;Start new line if not
  2756                                  WRTSYM:
  2757 0000137A 8A07                    	MOV	AL,[BX]
  2758 0000137C 43                      	INC	BX
  2759 0000137D E8BDFE                  	CALL	LIST
  2760 00001380 FECD                    	DEC	CH
  2761 00001382 75F6                    	JNZ	WRTSYM
  2762 00001384 FEC1                    	INC	CL
  2763                                  TABVAL:
  2764 00001386 B009                    	MOV	AL,9
  2765 00001388 E8B2FE                  	CALL	LIST
  2766 0000138B E2F9                    	LOOP	TABVAL
  2767 0000138D 43                      	INC	BX
  2768 0000138E 43                      	INC	BX
  2769 0000138F 53                      	PUSH	BX
  2770 00001390 8A4704                  	MOV	AL,[BX+4]
  2771 00001393 E8EDFE                  	CALL	PHEX
  2772 00001396 8A4703                  	MOV	AL,[BX+3]
  2773 00001399 E8E7FE                  	CALL	PHEX
  2774 0000139C 803E[8720]00            	CMP	BYTE[SYMLIN],0	;Will any more fit on line?
  2775 000013A1 7407                    	JZ	NEXSYMLIN
  2776 000013A3 B009                    	MOV	AL,9
  2777 000013A5 E895FE                  	CALL	LIST
  2778 000013A8 EB08                    	JMP SHORT	RIGHTSON
  2779                                  NEXSYMLIN:
  2780 000013AA E839FE                  	CALL	CRLF
  2781 000013AD C606[8720]05            	MOV	BYTE[SYMLIN],SYMWID
  2782                                  RIGHTSON:
  2783 000013B2 5B                      	POP	BX
  2784 000013B3 8B17                    	MOV	DX,[BX]
  2785 000013B5 09D2                    	OR	DX,DX
  2786 000013B7 7587                    	JNZ	NODE
  2787 000013B9 C3                      	RET
  2788                                  
  2789                                  SAVCD:
  2790 000013BA A2[9A20]                	MOV	[PREV],AL
  2791 000013BD 53                      	PUSH	BX
  2792 000013BE 51                      	PUSH	CX
  2793 000013BF 50                      	PUSH	AX
  2794 000013C0 52                      	PUSH	DX
  2795 000013C1 E87B00                  	CALL	CODBYT
  2796 000013C4 5A                      	POP	DX
  2797 000013C5 BB[8D20]                	MOV	BX,COUNT
  2798 000013C8 FE07                    	INC	BYTE[BX]
  2799 000013CA 8A07                    	MOV	AL,[BX]
  2800 000013CC 3C08                    	CMP	AL,8
  2801 000013CE 7511                    	JNZ	NOEXT
  2802 000013D0 C60701                  	MOV	BYTE[BX],1
  2803 000013D3 E8D1FD                  	CALL	OUTLIN
  2804 000013D6 B020                    	MOV	AL,' '
  2805 000013D8 B505                    	MOV	CH,5
  2806                                  TAB:
  2807 000013DA E860FE                  	CALL	LIST
  2808 000013DD FECD                    	DEC	CH
  2809 000013DF 75F9                    	JNZ	TAB
  2810                                  NOEXT:
  2811 000013E1 58                      	POP	AX
  2812 000013E2 E853FE                  	CALL	PHEXB
  2813 000013E5 59                      	POP	CX
  2814 000013E6 FF06[1B20]              	INC	WORD[PC]
  2815 000013EA FF06[9320]              	INC	WORD[HEXADD]
  2816 000013EE 5B                      	POP	BX
  2817                                  REPERRUDRET:
  2818                                  PRINTUDRET:
  2819 000013EF C3                      	RET
  2820                                  
  2821                                  REPERR:
  2822 000013F0 08C0                    	OR	AL,AL		;Did an error occur?
  2823 000013F2 74FB                    	JZ	REPERRUDRET
  2824 000013F4 FF06[9D20]              	INC	WORD[ERRCNT]
  2825 000013F8 50                      	PUSH	AX
  2826 000013F9 BB[FD1E]                	MOV	BX,ERRMES	;Print "ERROR"
  2827 000013FC E82000                  	CALL	PRINT
  2828 000013FF 58                      	POP	AX
  2829                                  ;We have error number in AL. See if there's an error message for it
  2830 00001400 BF[2E1B]                	MOV	DI,ERRTAB
  2831 00001403 B380                    	MOV	BL,80H
  2832                                  ERRLOOK:
  2833 00001405 AE                      	SCASB			;Do we have the error message
  2834 00001406 7607                    	JBE	HAVMES		;Quit looking if we have it or passed it
  2835 00001408 93                      	XCHG	AX,BX		;Put 80H in AL to look for end of this message
  2836                                  NEXTMES:
  2837 00001409 AE                      	SCASB			;Look for high bit set in message
  2838 0000140A 77FD                    	JA	NEXTMES		;   which means we've reached the end
  2839 0000140C 93                      	XCHG	AX,BX		;Restore error number to AL
  2840 0000140D EBF6                    	JMP SHORT	ERRLOOK		;Keep looking
  2841                                  
  2842                                  HAVMES:
  2843 0000140F 89FB                    	MOV	BX,DI		;Put address of message in BX
  2844 00001411 7406                    	JZ	PRNERR		;Do we have a message for this error?
  2845 00001413 E86DFE                  	CALL	PHEX		;If not, just print error number
  2846 00001416 E9CDFD                  	JMP	CRLF
  2847                                  
  2848                                  PRNERR:
  2849 00001419 E80300                  	CALL	PRINT
  2850 0000141C E9C7FD                  	JMP	CRLF
  2851                                  
  2852                                  PRINT:
  2853 0000141F 8A07                    	MOV	AL,[BX]
  2854 00001421 E819FE                  	CALL	LIST
  2855 00001424 08C0                    	OR	AL,AL
  2856 00001426 78C7                    	JS	PRINTUDRET
  2857 00001428 43                      	INC	BX
  2858 00001429 EBF4                    	JMP SHORT	PRINT
  2859                                  OUTA:
  2860 0000142B 88C2                    	MOV	DL,AL
  2861                                  OUT:
  2862 0000142D 80E27F                  	AND	DL,7FH
  2863 00001430 B102                    	MOV	CL,2
  2864                                  SYSTEM:
  2865                                  	;CLOSE INPUT FILE
  2866 00001432 BA5C00                  	MOV	DX,FCB
  2867 00001435 B410                    	MOV	AH,CLOSE
  2868 00001437 CD21                    	INT	33
  2869 00001439 90                      	NOP
  2870 0000143A B8004C                  	MOV AX,4C00H
  2871 0000143D CD21                    	INT 21H		;Terminate program
  2872                                  	;CALL	5
  2873                                  	;RET
  2874                                  
  2875                                  CODBYT:
  2876 0000143F 803E[D11F]5A            	CMP	BYTE[HEXFCB],"Z"
  2877 00001444 0F84AF00                	JZ	CODBYTUDRET
  2878 00001448 50                      	PUSH	AX
  2879 00001449 8B16[9520]              	MOV	DX,[LASTAD]
  2880 0000144D 8B1E[9320]              	MOV	BX,[HEXADD]
  2881 00001451 891E[9520]              	MOV	[LASTAD],BX
  2882 00001455 42                      	INC	DX
  2883 00001456 A0[9720]                	MOV	AL,[HEXCNT]
  2884 00001459 3CFB                    	CMP	AL,-5
  2885 0000145B 7407                    	JZ	NEWLIN
  2886 0000145D 39D3                    	CMP	BX,DX
  2887 0000145F 742E                    	JZ	AFHEX
  2888 00001461 E85000                  	CALL	ENHEXL
  2889                                  NEWLIN:
  2890 00001464 B03A                    	MOV	AL,':'
  2891 00001466 E88F00                  	CALL	PUTCHR
  2892 00001469 B0FC                    	MOV	AL,-4
  2893 0000146B A2[9720]                	MOV	[HEXCNT],AL
  2894 0000146E 30C0                    	XOR	AL,AL
  2895 00001470 A2[9820]                	MOV	[CHKSUM],AL
  2896 00001473 8B1E[AB20]              	MOV	BX,[HEXPNT]
  2897 00001477 891E[9120]              	MOV	[HEXLEN],BX
  2898 0000147B E81200                  	CALL	HEXBYT
  2899 0000147E A0[9420]                	MOV	AL,[HEXADD+1]
  2900 00001481 E80C00                  	CALL	HEXBYT
  2901 00001484 A0[9320]                	MOV	AL,[HEXADD]
  2902 00001487 E80600                  	CALL	HEXBYT
  2903 0000148A 30C0                    	XOR	AL,AL
  2904 0000148C E80100                  	CALL	HEXBYT
  2905                                  AFHEX:
  2906 0000148F 58                      	POP	AX
  2907                                  HEXBYT:
  2908 00001490 88C5                    	MOV	CH,AL
  2909 00001492 BB[9820]                	MOV	BX,CHKSUM
  2910 00001495 0207                    	ADD	AL,[BX]
  2911 00001497 8807                    	MOV	[BX],AL
  2912 00001499 88E8                    	MOV	AL,CH
  2913 0000149B E88400                  	CALL	UHALF
  2914 0000149E E85700                  	CALL	PUTCHR
  2915 000014A1 88E8                    	MOV	AL,CH
  2916 000014A3 E88400                  	CALL	LHALF
  2917 000014A6 E84F00                  	CALL	PUTCHR
  2918 000014A9 BB[9720]                	MOV	BX,HEXCNT
  2919 000014AC FE07                    	INC	BYTE[BX]
  2920 000014AE 8A07                    	MOV	AL,[BX]
  2921 000014B0 3C1A                    	CMP	AL,26
  2922 000014B2 7543                    	JNZ	CODBYTUDRET
  2923                                  ENHEXL:
  2924 000014B4 8B3E[9120]              	MOV	DI,[HEXLEN]
  2925 000014B8 88C5                    	MOV	CH,AL
  2926 000014BA E86500                  	CALL	UHALF
  2927 000014BD AA                      	STOSB
  2928 000014BE 88E8                    	MOV	AL,CH
  2929 000014C0 E86700                  	CALL	LHALF
  2930 000014C3 AA                      	STOSB
  2931 000014C4 B0FA                    	MOV	AL,-6
  2932 000014C6 A2[9720]                	MOV	[HEXCNT],AL
  2933 000014C9 A0[9820]                	MOV	AL,[CHKSUM]
  2934 000014CC 00E8                    	ADD	AL,CH
  2935 000014CE F6D8                    	NEG	AL
  2936 000014D0 E8BDFF                  	CALL	HEXBYT
  2937 000014D3 B00D                    	MOV	AL,13
  2938 000014D5 E82000                  	CALL	PUTCHR
  2939 000014D8 B00A                    	MOV	AL,10
  2940 000014DA E81B00                  	CALL	PUTCHR
  2941                                  WRTHEX:
  2942                                  ;Write out the line
  2943 000014DD BA[AF20]                	MOV	DX,HEXBUF
  2944 000014E0 8916[AB20]              	MOV	[HEXPNT],DX
  2945 000014E4 B41A                    	MOV	AH,SETDMA
  2946 000014E6 CD21                    	INT	33
  2947 000014E8 29D7                    	SUB	DI,DX		;Length of buffer
  2948 000014EA 89F9                    	MOV	CX,DI
  2949 000014EC BA[D11F]                	MOV	DX,HEXFCB
  2950 000014EF B428                    	MOV	AH,BLKWRT
  2951 000014F1 CD21                    	INT	33
  2952 000014F3 08C0                    	OR	AL,AL
  2953 000014F5 7525                    	JNZ	DSKFUL
  2954                                  CODBYTUDRET:
  2955                                  FLUSHBUFUDRET:
  2956 000014F7 C3                      	RET
  2957                                  PUTCHR:
  2958 000014F8 8B3E[AB20]              	MOV	DI,[HEXPNT]
  2959 000014FC AA                      	STOSB
  2960 000014FD 893E[AB20]              	MOV	[HEXPNT],DI
  2961 00001501 C3                      	RET
  2962                                  
  2963                                  FLUSHBUF:
  2964 00001502 89F9                    	MOV	CX,DI
  2965 00001504 BA[F520]                	MOV	DX,LSTBUF
  2966 00001507 89D7                    	MOV	DI,DX
  2967 00001509 29D1                    	SUB	CX,DX
  2968 0000150B 74EA                    	JZ	FLUSHBUFUDRET		;Buffer empty?
  2969 0000150D B41A                    	MOV	AH,SETDMA
  2970 0000150F CD21                    	INT	33
  2971 00001511 BA[F61F]                	MOV	DX,LSTFCB
  2972 00001514 B428                    	MOV	AH,BLKWRT
  2973 00001516 CD21                    	INT	33
  2974 00001518 08C0                    	OR	AL,AL
  2975 0000151A 74DB                    	JZ	FLUSHBUFUDRET
  2976                                  DSKFUL:
  2977 0000151C BB[4E1F]                	MOV	BX,WRTERR
  2978 0000151F E954EC                  	JMP	PRERR
  2979                                  UHALF:
  2980 00001522 D0D8                    	RCR	AL,1
  2981 00001524 D0D8                    	RCR	AL,1
  2982 00001526 D0D8                    	RCR	AL,1
  2983 00001528 D0D8                    	RCR	AL,1
  2984                                  LHALF:
  2985 0000152A 240F                    	AND	AL,0FH
  2986 0000152C 0C30                    	OR	AL,30H
  2987 0000152E 3C3A                    	CMP	AL,'9'+1
  2988 00001530 7202                    	JC	LHALFUDRET
  2989 00001532 0407                    	ADD	AL,7
  2990                                  LHALFUDRET:
  2991 00001534 C3                      	RET
  2992                                  
  2993 00001535 00                      NONE:	DB	0
  2994                                  
  2995                                  ; 8086 MNEMONIC TABLE
  2996                                  
  2997                                  ; This table is actually a sequence of subtables, each starting with a label.
  2998                                  ; The label signifies which mnemonics the subtable applies to--A3, for example,
  2999                                  ; means all 3-letter mnemonics beginning with A.
  3000                                  
  3001                                  A3:
  3002 00001536 07                      	DB	7
  3003 00001537 6464                    	DB	'dd'
  3004 00001539 [BE0C]                  	DW	GRP7
  3005 0000153B 02                      	DB	2
  3006 0000153C 6E64                    	DB	'nd'
  3007 0000153E [940D]                  	DW	GRP13
  3008 00001540 22                      	DB	22H
  3009 00001541 6463                    	DB	'dc'
  3010 00001543 [BE0C]                  	DW	GRP7
  3011 00001545 12                      	DB	12H
  3012 00001546 6161                    	DB	'aa'
  3013 00001548 [9A0A]                  	DW	PUT
  3014 0000154A 37                      	DB	37H
  3015 0000154B 6173                    	DB	'as'
  3016 0000154D [9A0A]                  	DW	PUT
  3017 0000154F 3F                      	DB	3FH
  3018 00001550 616D                    	DB	'am'
  3019 00001552 [620D]                  	DW	GRP11
  3020 00001554 D4                      	DB	0D4H
  3021 00001555 6164                    	DB	'ad'
  3022 00001557 [620D]                  	DW	GRP11
  3023 00001559 D5                      	DB	0D5H
  3024                                  A5:
  3025 0000155A 01                      	DB	1
  3026 0000155B 6C69676E                	DB	'lign'
  3027 0000155F [6A0C]                  	DW	UDALIGN
  3028 00001561 00                      	DB	0
  3029                                  C3:
  3030 00001562 07                      	DB	7
  3031 00001563 6D70                    	DB	'mp'
  3032 00001565 [BE0C]                  	DW	GRP7
  3033 00001567 3A                      	DB	3AH
  3034 00001568 6C63                    	DB	'lc'
  3035 0000156A [9A0A]                  	DW	PUT
  3036 0000156C F8                      	DB	0F8H
  3037 0000156D 6C64                    	DB	'ld'
  3038 0000156F [9A0A]                  	DW	PUT
  3039 00001571 FC                      	DB	0FCH
  3040 00001572 6C69                    	DB	'li'
  3041 00001574 [9A0A]                  	DW	PUT
  3042 00001576 FA                      	DB	0FAH
  3043 00001577 6D63                    	DB	'mc'
  3044 00001579 [9A0A]                  	DW	PUT
  3045 0000157B F5                      	DB	0F5H
  3046 0000157C 6277                    	DB	'bw'
  3047 0000157E [9A0A]                  	DW	PUT
  3048 00001580 98                      	DB	98H
  3049 00001581 7764                    	DB	'wd'
  3050 00001583 [9A0A]                  	DW	PUT
  3051 00001585 99                      	DB	99H
  3052                                  C4:
  3053 00001586 03                      	DB	3
  3054 00001587 616C6C                  	DB	'all'
  3055 0000158A [BE0D]                  	DW	GRP14
  3056 0000158C 9A                      	DB	9AH
  3057 0000158D 6D7062                  	DB	'mpb'
  3058 00001590 [9A0A]                  	DW	PUT
  3059 00001592 A6                      	DB	0A6H
  3060 00001593 6D7077                  	DB	'mpw'
  3061 00001596 [9A0A]                  	DW	PUT
  3062 00001598 A7                      	DB	0A7H
  3063                                  C5:
  3064 00001599 02                      	DB	2
  3065 0000159A 6D707362                	DB	'mpsb'
  3066 0000159E [9A0A]                  	DW	PUT
  3067 000015A0 A6                      	DB	0A6H
  3068 000015A1 6D707377                	DB	'mpsw'
  3069 000015A5 [9A0A]                  	DW	PUT
  3070 000015A7 A7                      	DB	0A7H
  3071                                  D2:
  3072 000015A8 05                      	DB	5
  3073 000015A9 62                      	DB	'b'
  3074 000015AA [C90F]                  	DW	GRP23
  3075 000015AC 01                      	DB	1
  3076 000015AD 77                      	DB	'w'
  3077 000015AE [C90F]                  	DW	GRP23
  3078 000015B0 00                      	DB	0
  3079 000015B1 6D                      	DB	'm'
  3080 000015B2 [C90F]                  	DW	GRP23
  3081 000015B4 02                      	DB	2
  3082 000015B5 73                      	DB	's'
  3083 000015B6 [380C]                  	DW	GRP5
  3084 000015B8 01                      	DB	1
  3085 000015B9 69                      	DB	'i'
  3086 000015BA [9A0A]                  	DW	PUT
  3087 000015BC FA                      	DB	0FAH
  3088                                  D3:
  3089 000015BD 04                      	DB	4
  3090 000015BE 6563                    	DB	'ec'
  3091 000015C0 [E60C]                  	DW	GRP8
  3092 000015C2 49                      	DB	49H
  3093 000015C3 6976                    	DB	'iv'
  3094 000015C5 [3A0D]                  	DW	GRP10
  3095 000015C7 30                      	DB	30H
  3096 000015C8 6161                    	DB	'aa'
  3097 000015CA [9A0A]                  	DW	PUT
  3098 000015CC 27                      	DB	27H
  3099 000015CD 6173                    	DB	'as'
  3100 000015CF [9A0A]                  	DW	PUT
  3101 000015D1 2F                      	DB	2FH
  3102                                  D4:
  3103 000015D2 01                      	DB	1
  3104 000015D3 6F776E                  	DB	'own'
  3105 000015D6 [9A0A]                  	DW	PUT
  3106 000015D8 FD                      	DB	0FDH
  3107                                  E2:
  3108 000015D9 01                      	DB	1
  3109 000015DA 69                      	DB	'i'
  3110 000015DB [9A0A]                  	DW	PUT
  3111 000015DD FB                      	DB	0FBH
  3112                                  E3:
  3113 000015DE 03                      	DB	3
  3114 000015DF 7175                    	DB	'qu'
  3115 000015E1 [380C]                  	DW	GRP5
  3116 000015E3 02                      	DB	2
  3117 000015E4 7363                    	DB	'sc'
  3118 000015E6 [180F]                  	DW	GRP19
  3119 000015E8 D8                      	DB	0D8H
  3120 000015E9 6E64                    	DB	'nd'
  3121 000015EB [5710]                  	DW	UDEND
  3122 000015ED 00                      	DB	0
  3123                                  E5:
  3124 000015EE 01                      	DB	1
  3125 000015EF 6E646966                	DB	'ndif'
  3126 000015F3 [4710]                  	DW	UDENDIF
  3127 000015F5 00                      	DB	0
  3128                                  H3:
  3129 000015F6 01                      	DB	1
  3130 000015F7 6C74                    	DB	'lt'
  3131 000015F9 [9A0A]                  	DW	PUT
  3132 000015FB F4                      	DB	0F4H
  3133                                  H4:
  3134 000015FC 01                      	DB	1
  3135 000015FD 616C74                  	DB	'alt'
  3136 00001600 [9A0A]                  	DW	PUT
  3137 00001602 F4                      	DB	0F4H
  3138                                  I2:
  3139 00001603 02                      	DB	2
  3140 00001604 6E                      	DB	'n'
  3141 00001605 [120C]                  	DW	GRP4
  3142 00001607 E4                      	DB	0E4H
  3143 00001608 66                      	DB	'f'
  3144 00001609 [380C]                  	DW	GRP5
  3145 0000160B 04                      	DB	4
  3146                                  I3:
  3147 0000160C 04                      	DB	4
  3148 0000160D 6E63                    	DB	'nc'
  3149 0000160F [E60C]                  	DW	GRP8
  3150 00001611 41                      	DB	41H
  3151 00001612 6E62                    	DB	'nb'
  3152 00001614 [120C]                  	DW	GRP4
  3153 00001616 E4                      	DB	0E4H
  3154 00001617 6E77                    	DB	'nw'
  3155 00001619 [120C]                  	DW	GRP4
  3156 0000161B E5                      	DB	0E5H
  3157 0000161C 6E74                    	DB	'nt'
  3158 0000161E [ED0E]                  	DW	GRP18
  3159 00001620 CC                      	DB	0CCH
  3160                                  I4:
  3161 00001621 04                      	DB	4
  3162 00001622 6D756C                  	DB	'mul'
  3163 00001625 [3A0D]                  	DW	GRP10
  3164 00001627 28                      	DB	28H
  3165 00001628 646976                  	DB	'div'
  3166 0000162B [3A0D]                  	DW	GRP10
  3167 0000162D 38                      	DB	38H
  3168 0000162E 726574                  	DB	'ret'
  3169 00001631 [9A0A]                  	DW	PUT
  3170 00001633 CF                      	DB	0CFH
  3171 00001634 6E746F                  	DB	'nto'
  3172 00001637 [9A0A]                  	DW	PUT
  3173 00001639 CE                      	DB	0CEH
  3174                                  J2:
  3175 0000163A 0A                      	DB	10
  3176 0000163B 70                      	DB	'p'
  3177 0000163C [B40E]                  	DW	GRP17
  3178 0000163E EB                      	DB	0EBH
  3179 0000163F 7A                      	DB	'z'
  3180 00001640 [B40E]                  	DW	GRP17
  3181 00001642 74                      	DB	74H
  3182 00001643 65                      	DB	'e'
  3183 00001644 [B40E]                  	DW	GRP17
  3184 00001646 74                      	DB	74H
  3185 00001647 6C                      	DB	'l'
  3186 00001648 [B40E]                  	DW	GRP17
  3187 0000164A 7C                      	DB	7CH
  3188 0000164B 62                      	DB	'b'
  3189 0000164C [B40E]                  	DW	GRP17
  3190 0000164E 72                      	DB	72H
  3191 0000164F 61                      	DB	'a'
  3192 00001650 [B40E]                  	DW	GRP17
  3193 00001652 77                      	DB	77H
  3194 00001653 67                      	DB	'g'
  3195 00001654 [B40E]                  	DW	GRP17
  3196 00001656 7F                      	DB	7FH
  3197 00001657 6F                      	DB	'o'
  3198 00001658 [B40E]                  	DW	GRP17
  3199 0000165A 70                      	DB	70H
  3200 0000165B 73                      	DB	's'
  3201 0000165C [B40E]                  	DW	GRP17
  3202 0000165E 78                      	DB	78H
  3203 0000165F 63                      	DB	'c'
  3204 00001660 [B40E]                  	DW	GRP17
  3205 00001662 72                      	DB	72H
  3206                                  J3:
  3207 00001663 11                      	DB	17
  3208 00001664 6D70                    	DB	'mp'
  3209 00001666 [BE0D]                  	DW	GRP14
  3210 00001668 EA                      	DB	0EAH
  3211 00001669 6E7A                    	DB	'nz'
  3212 0000166B [B40E]                  	DW	GRP17
  3213 0000166D 75                      	DB	75H
  3214 0000166E 6E65                    	DB	'ne'
  3215 00001670 [B40E]                  	DW	GRP17
  3216 00001672 75                      	DB	75H
  3217 00001673 6E6C                    	DB	'nl'
  3218 00001675 [B40E]                  	DW	GRP17
  3219 00001677 7D                      	DB	7DH
  3220 00001678 6765                    	DB	'ge'
  3221 0000167A [B40E]                  	DW	GRP17
  3222 0000167C 7D                      	DB	7DH
  3223 0000167D 6E62                    	DB	'nb'
  3224 0000167F [B40E]                  	DW	GRP17
  3225 00001681 73                      	DB	73H
  3226 00001682 6165                    	DB	'ae'
  3227 00001684 [B40E]                  	DW	GRP17
  3228 00001686 73                      	DB	73H
  3229 00001687 6E63                    	DB	'nc'
  3230 00001689 [B40E]                  	DW	GRP17
  3231 0000168B 73                      	DB	73H
  3232 0000168C 6E67                    	DB	'ng'
  3233 0000168E [B40E]                  	DW	GRP17
  3234 00001690 7E                      	DB	7EH
  3235 00001691 6C65                    	DB	'le'
  3236 00001693 [B40E]                  	DW	GRP17
  3237 00001695 7E                      	DB	7EH
  3238 00001696 6E61                    	DB	'na'
  3239 00001698 [B40E]                  	DW	GRP17
  3240 0000169A 76                      	DB	76H
  3241 0000169B 6265                    	DB	'be'
  3242 0000169D [B40E]                  	DW	GRP17
  3243 0000169F 76                      	DB	76H
  3244 000016A0 7065                    	DB	'pe'
  3245 000016A2 [B40E]                  	DW	GRP17
  3246 000016A4 7A                      	DB	7AH
  3247 000016A5 6E70                    	DB	'np'
  3248 000016A7 [B40E]                  	DW	GRP17
  3249 000016A9 7B                      	DB	7BH
  3250 000016AA 706F                    	DB	'po'
  3251 000016AC [B40E]                  	DW	GRP17
  3252 000016AE 7B                      	DB	7BH
  3253 000016AF 6E6F                    	DB	'no'
  3254 000016B1 [B40E]                  	DW	GRP17
  3255 000016B3 71                      	DB	71H
  3256 000016B4 6E73                    	DB	'ns'
  3257 000016B6 [B40E]                  	DW	GRP17
  3258 000016B8 79                      	DB	79H
  3259                                  J4:
  3260 000016B9 06                      	DB	6
  3261 000016BA 6D7073                  	DB	'mps'
  3262 000016BD [B40E]                  	DW	GRP17
  3263 000016BF EB                      	DB	0EBH
  3264 000016C0 63787A                  	DB	'cxz'
  3265 000016C3 [B40E]                  	DW	GRP17
  3266 000016C5 E3                      	DB	0E3H
  3267 000016C6 6E6765                  	DB	'nge'
  3268 000016C9 [B40E]                  	DW	GRP17
  3269 000016CB 7C                      	DB	7CH
  3270 000016CC 6E6165                  	DB	'nae'
  3271 000016CF [B40E]                  	DW	GRP17
  3272 000016D1 72                      	DB	72H
  3273 000016D2 6E6265                  	DB	'nbe'
  3274 000016D5 [B40E]                  	DW	GRP17
  3275 000016D7 77                      	DB	77H
  3276 000016D8 6E6C65                  	DB	'nle'
  3277 000016DB [B40E]                  	DW	GRP17
  3278 000016DD 7F                      	DB	7FH
  3279                                  L3:
  3280 000016DE 03                      	DB	3
  3281 000016DF 6561                    	DB	'ea'
  3282 000016E1 [B20C]                  	DW	GRP6
  3283 000016E3 8D                      	DB	8DH
  3284 000016E4 6473                    	DB	'ds'
  3285 000016E6 [B20C]                  	DW	GRP6
  3286 000016E8 C5                      	DB	0C5H
  3287 000016E9 6573                    	DB	'es'
  3288 000016EB [B20C]                  	DW	GRP6
  3289 000016ED C4                      	DB	0C4H
  3290                                  L4:
  3291 000016EE 05                      	DB	5
  3292 000016EF 6F6F70                  	DB	'oop'
  3293 000016F2 [B40E]                  	DW	GRP17
  3294 000016F4 E2                      	DB	0E2H
  3295 000016F5 6F6462                  	DB	'odb'
  3296 000016F8 [9A0A]                  	DW	PUT
  3297 000016FA AC                      	DB	0ACH
  3298 000016FB 6F6477                  	DB	'odw'
  3299 000016FE [9A0A]                  	DW	PUT
  3300 00001700 AD                      	DB	0ADH
  3301 00001701 616866                  	DB	'ahf'
  3302 00001704 [9A0A]                  	DW	PUT
  3303 00001706 9F                      	DB	9FH
  3304 00001707 6F636B                  	DB	'ock'
  3305 0000170A [9A0A]                  	DW	PUT
  3306 0000170C F0                      	DB	0F0H
  3307                                  L5:
  3308 0000170D 04                      	DB	4
  3309 0000170E 6F6F7065                	DB	'oope'
  3310 00001712 [B40E]                  	DW	GRP17
  3311 00001714 E1                      	DB	0E1H
  3312 00001715 6F6F707A                	DB	'oopz'
  3313 00001719 [B40E]                  	DW	GRP17
  3314 0000171B E1                      	DB	0E1H
  3315 0000171C 6F647362                	DB	'odsb'
  3316 00001720 [9A0A]                  	DW	PUT
  3317 00001722 AC                      	DB	0ACH
  3318 00001723 6F647377                	DB	'odsw'
  3319 00001727 [9A0A]                  	DW	PUT
  3320 00001729 AD                      	DB	0ADH
  3321                                  L6:
  3322 0000172A 02                      	DB	2
  3323 0000172B 6F6F706E65              	DB	'oopne'
  3324 00001730 [B40E]                  	DW	GRP17
  3325 00001732 E0                      	DB	0E0H
  3326 00001733 6F6F706E7A              	DB	'oopnz'
  3327 00001738 [B40E]                  	DW	GRP17
  3328 0000173A E0                      	DB	0E0H
  3329                                  M3:
  3330 0000173B 02                      	DB	2
  3331 0000173C 6F76                    	DB	'ov'
  3332 0000173E [320A]                  	DW	GRP1
  3333 00001740 88                      	DB	88H
  3334 00001741 756C                    	DB	'ul'
  3335 00001743 [3A0D]                  	DW	GRP10
  3336 00001745 20                      	DB	20H
  3337                                  M4:
  3338 00001746 02                      	DB	2
  3339 00001747 6F7662                  	DB	'ovb'
  3340 0000174A [9A0A]                  	DW	PUT
  3341 0000174C A4                      	DB	0A4H
  3342 0000174D 6F7677                  	DB	'ovw'
  3343 00001750 [9A0A]                  	DW	PUT
  3344 00001752 A5                      	DB	0A5H
  3345                                  M5:
  3346 00001753 02                      	DB	2
  3347 00001754 6F767362                	DB	'ovsb'
  3348 00001758 [9A0A]                  	DW	PUT
  3349 0000175A A4                      	DB	0A4H
  3350 0000175B 6F767377                	DB	'ovsw'
  3351 0000175F [9A0A]                  	DW	PUT
  3352 00001761 A5                      	DB	0A5H
  3353                                  N3:
  3354 00001762 03                      	DB	3
  3355 00001763 6F74                    	DB	'ot'
  3356 00001765 [EC0C]                  	DW	GRP9
  3357 00001767 10                      	DB	10H
  3358 00001768 6567                    	DB	'eg'
  3359 0000176A [EC0C]                  	DW	GRP9
  3360 0000176C 18                      	DB	18H
  3361 0000176D 6F70                    	DB	'op'
  3362 0000176F [9A0A]                  	DW	PUT
  3363 00001771 90                      	DB	90H
  3364                                  O2:
  3365 00001772 01                      	DB	1
  3366 00001773 72                      	DB	'r'
  3367 00001774 [940D]                  	DW	GRP13
  3368 00001776 0A                      	DB	0AH
  3369                                  O3:
  3370 00001777 02                      	DB	2
  3371 00001778 7574                    	DB	'ut'
  3372 0000177A [120C]                  	DW	GRP4
  3373 0000177C E6                      	DB	0E6H
  3374 0000177D 7267                    	DB	'rg'
  3375 0000177F [380C]                  	DW	GRP5
  3376 00001781 00                      	DB	0
  3377                                  O4:
  3378 00001782 02                      	DB	2
  3379 00001783 757462                  	DB	'utb'
  3380 00001786 [120C]                  	DW	GRP4
  3381 00001788 E6                      	DB	0E6H
  3382 00001789 757477                  	DB	'utw'
  3383 0000178C [120C]                  	DW	GRP4
  3384 0000178E E7                      	DB	0E7H
  3385                                  P3:
  3386 0000178F 02                      	DB	2
  3387 00001790 6F70                    	DB	'op'
  3388 00001792 [A80F]                  	DW	GRP22
  3389 00001794 8F                      	DB	8FH
  3390 00001795 7574                    	DB	'ut'
  3391 00001797 [380C]                  	DW	GRP5
  3392 00001799 03                      	DB	3
  3393                                  P4:
  3394 0000179A 02                      	DB	2
  3395 0000179B 757368                  	DB	'ush'
  3396 0000179E [820B]                  	DW	GRP2
  3397 000017A0 FF                      	DB	0FFH
  3398 000017A1 6F7066                  	DB	'opf'
  3399 000017A4 [9A0A]                  	DW	PUT
  3400 000017A6 9D                      	DB	9DH
  3401                                  P5:
  3402 000017A7 01                      	DB	1
  3403 000017A8 75736866                	DB	'ushf'
  3404 000017AC [9A0A]                  	DW	PUT
  3405 000017AE 9C                      	DB	9CH
  3406                                  R3:
  3407 000017AF 06                      	DB	6
  3408 000017B0 6574                    	DB	'et'
  3409 000017B2 [3C0E]                  	DW	GRP16
  3410 000017B4 C3                      	DB	0C3H
  3411 000017B5 6570                    	DB	'ep'
  3412 000017B7 [9A0A]                  	DW	PUT
  3413 000017B9 F3                      	DB	0F3H
  3414 000017BA 6F6C                    	DB	'ol'
  3415 000017BC [6A0D]                  	DW	GRP12
  3416 000017BE 00                      	DB	0
  3417 000017BF 6F72                    	DB	'or'
  3418 000017C1 [6A0D]                  	DW	GRP12
  3419 000017C3 08                      	DB	8
  3420 000017C4 636C                    	DB	'cl'
  3421 000017C6 [6A0D]                  	DW	GRP12
  3422 000017C8 10                      	DB	10H
  3423 000017C9 6372                    	DB	'cr'
  3424 000017CB [6A0D]                  	DW	GRP12
  3425 000017CD 18                      	DB	18H
  3426                                  R4:
  3427 000017CE 02                      	DB	2
  3428 000017CF 65707A                  	DB	'epz'
  3429 000017D2 [9A0A]                  	DW	PUT
  3430 000017D4 F3                      	DB	0F3H
  3431 000017D5 657065                  	DB	'epe'
  3432 000017D8 [9A0A]                  	DW	PUT
  3433 000017DA F3                      	DB	0F3H
  3434                                  R5:
  3435 000017DB 02                      	DB	2
  3436 000017DC 65706E7A                	DB	'epnz'
  3437 000017E0 [9A0A]                  	DW	PUT
  3438 000017E2 F2                      	DB	0F2H
  3439 000017E3 65706E65                	DB	'epne'
  3440 000017E7 [9A0A]                  	DW	PUT
  3441 000017E9 F2                      	DB	0F2H
  3442                                  S3:
  3443 000017EA 0B                      	DB	11
  3444 000017EB 7562                    	DB	'ub'
  3445 000017ED [BE0C]                  	DW	GRP7
  3446 000017EF 2A                      	DB	2AH
  3447 000017F0 6262                    	DB	'bb'
  3448 000017F2 [BE0C]                  	DW	GRP7
  3449 000017F4 1A                      	DB	1AH
  3450 000017F5 6263                    	DB	'bc'
  3451 000017F7 [BE0C]                  	DW	GRP7
  3452 000017F9 1A                      	DB	1AH
  3453 000017FA 7463                    	DB	'tc'
  3454 000017FC [9A0A]                  	DW	PUT
  3455 000017FE F9                      	DB	0F9H
  3456 000017FF 7464                    	DB	'td'
  3457 00001801 [9A0A]                  	DW	PUT
  3458 00001803 FD                      	DB	0FDH
  3459 00001804 7469                    	DB	'ti'
  3460 00001806 [9A0A]                  	DW	PUT
  3461 00001808 FB                      	DB	0FBH
  3462 00001809 686C                    	DB	'hl'
  3463 0000180B [6A0D]                  	DW	GRP12
  3464 0000180D 20                      	DB	20H
  3465 0000180E 6872                    	DB	'hr'
  3466 00001810 [6A0D]                  	DW	GRP12
  3467 00001812 28                      	DB	28H
  3468 00001813 616C                    	DB	'al'
  3469 00001815 [6A0D]                  	DW	GRP12
  3470 00001817 20                      	DB	20H
  3471 00001818 6172                    	DB	'ar'
  3472 0000181A [6A0D]                  	DW	GRP12
  3473 0000181C 38                      	DB	38H
  3474 0000181D 6567                    	DB	'eg'
  3475 0000181F [900F]                  	DW	GRP21
  3476 00001821 26                      	DB	26H
  3477                                  S4:
  3478 00001822 05                      	DB	5
  3479 00001823 636162                  	DB	'cab'
  3480 00001826 [9A0A]                  	DW	PUT
  3481 00001828 AE                      	DB	0AEH
  3482 00001829 636177                  	DB	'caw'
  3483 0000182C [9A0A]                  	DW	PUT
  3484 0000182E AF                      	DB	0AFH
  3485 0000182F 746F62                  	DB	'tob'
  3486 00001832 [9A0A]                  	DW	PUT
  3487 00001834 AA                      	DB	0AAH
  3488 00001835 746F77                  	DB	'tow'
  3489 00001838 [9A0A]                  	DW	PUT
  3490 0000183A AB                      	DB	0ABH
  3491 0000183B 616866                  	DB	'ahf'
  3492 0000183E [9A0A]                  	DW	PUT
  3493 00001840 9E                      	DB	9EH
  3494                                  S5:
  3495 00001841 04                      	DB	4
  3496 00001842 63617362                	DB	'casb'
  3497 00001846 [9A0A]                  	DW	PUT
  3498 00001848 AE                      	DB	0AEH
  3499 00001849 63617377                	DB	'casw'
  3500 0000184D [9A0A]                  	DW	PUT
  3501 0000184F AF                      	DB	0AFH
  3502 00001850 746F7362                	DB	'tosb'
  3503 00001854 [9A0A]                  	DW	PUT
  3504 00001856 AA                      	DB	0AAH
  3505 00001857 746F7377                	DB	'tosw'
  3506 0000185B [9A0A]                  	DW	PUT
  3507 0000185D AB                      	DB	0ABH
  3508                                  T4:
  3509 0000185E 01                      	DB	1
  3510 0000185F 657374                  	DB	'est'
  3511 00001862 [7F0F]                  	DW	GRP20
  3512 00001864 84                      	DB	84H
  3513                                  U2:
  3514 00001865 01                      	DB	1
  3515 00001866 70                      	DB	'p'
  3516 00001867 [9A0A]                  	DW	PUT
  3517 00001869 FC                      	DB	0FCH
  3518                                  W4:
  3519 0000186A 01                      	DB	1
  3520 0000186B 616974                  	DB	'ait'
  3521 0000186E [9A0A]                  	DW	PUT
  3522 00001870 9B                      	DB	9BH
  3523                                  X3:
  3524 00001871 01                      	DB	1
  3525 00001872 6F72                    	DB	'or'
  3526 00001874 [940D]                  	DW	GRP13
  3527 00001876 32                      	DB	32H
  3528                                  X4:
  3529 00001877 02                      	DB	2
  3530 00001878 636867                  	DB	'chg'
  3531 0000187B [B20B]                  	DW	GRP3
  3532 0000187D 86                      	DB	86H
  3533 0000187E 6C6174                  	DB	'lat'
  3534 00001881 [9A0A]                  	DW	PUT
  3535 00001883 D7                      	DB	0D7H
  3536                                  
  3537                                  
  3538                                  ; 8087 MNEMONIC TABLE
  3539                                  ; Similar to 8086 table above, except NOT distinguished by opcode length
  3540                                  
  3541                                  XM1:	;F2XM1
  3542 00001884 01                      	DB	1		;One opcode
  3543 00001885 786DB1                  	DB	"xm", '1'+ 080H
  3544 00001888 01F0                    	DB	1,0F0H
  3545                                  
  3546                                  NDPA:
  3547 0000188A 03                      	DB	3
  3548 0000188B 64E4                    	DB	"d", 'd'+ 080H
  3549 0000188D 0EC1                    	DB	6+ARITH,0C1H
  3550 0000188F 6464F0                  	DB	"dd", 'p'+ 080H
  3551 00001892 9000                    	DB	NEEDOP+STACKOP,0
  3552 00001894 62F3                    	DB	"b", 's'+ 080H
  3553 00001896 01E1                    	DB	1,0E1H
  3554                                  
  3555                                  NDPB:
  3556 00001898 02                      	DB	2
  3557 00001899 6CE4                    	DB	"l", 'd'+ 080H
  3558 0000189B 9F20                    	DB	7+NEEDOP+MEMORY,20H
  3559 0000189D 7374F0                  	DB	"st", 'p'+ 080H
  3560 000018A0 9F30                    	DB	7+NEEDOP+MEMORY,30H
  3561                                  
  3562                                  NDPC:
  3563 000018A2 05                      	DB	5
  3564 000018A3 6FED                    	DB	"o", 'm'+ 080H
  3565 000018A5 68D1                    	DB	0+ONEREG+REAL,0D1H
  3566 000018A7 6F6DF0                  	DB	"om", 'p'+ 080H
  3567 000018AA 68D9                    	DB	0+ONEREG+REAL,0D9H
  3568 000018AC 68F3                    	DB	"h", 's'+ 080H
  3569 000018AE 01E0                    	DB	1,0E0H
  3570 000018B0 6F6D70F0                	DB	"omp", 'p'+ 080H
  3571 000018B4 06D9                    	DB	6,0D9H
  3572 000018B6 6C65F8                  	DB	"le", 'x'+ 080H
  3573 000018B9 03E2                    	DB	3,0E2H
  3574                                  
  3575                                  NDPD:
  3576 000018BB 06                      	DB	6
  3577 000018BC 69F6                    	DB	"i", 'v'+ 080H
  3578 000018BE 0EF1                    	DB	6+ARITH,0F1H
  3579 000018C0 6976F0                  	DB	"iv", 'p'+ 080H
  3580 000018C3 9030                    	DB	NEEDOP+STACKOP,30H
  3581 000018C5 6976F2                  	DB	"iv", 'r'+ 080H
  3582 000018C8 0EF9                    	DB	6+ARITH,0F9H
  3583 000018CA 697672F0                	DB	"ivr", 'p'+ 080H
  3584 000018CE 9038                    	DB	NEEDOP+STACKOP,38H
  3585 000018D0 65637374F0              	DB	"ecst", 'p'+ 080H
  3586 000018D5 01F6                    	DB	1,0F6H
  3587 000018D7 6973E9                  	DB	"is", 'i'+ 080H
  3588 000018DA 03E1                    	DB	3,0E1H
  3589                                  
  3590                                  NDPE:
  3591 000018DC 01                      	DB	1
  3592 000018DD 6EE9                    	DB	"n", 'i'+ 080H
  3593 000018DF 03E0                    	DB	3,0E0H
  3594                                  
  3595                                  NDPF:
  3596 000018E1 01                      	DB	1
  3597 000018E2 7265E5                  	DB	"re", 'e'+ 080H
  3598 000018E5 C500                    	DB	5+NEEDOP+ONEREG,0
  3599                                  
  3600                                  NDPI:
  3601 000018E7 0D                      	DB	13
  3602 000018E8 6164E4                  	DB	"ad", 'd'+ 080H
  3603 000018EB A200                    	DB	2+NEEDOP+INTEGER,0
  3604 000018ED 6CE4                    	DB	"l", 'd'+ 080H
  3605 000018EF B300                    	DB	3+NEEDOP+INTEGER+EXTENDED,0
  3606 000018F1 7375E2                  	DB	"su", 'b'+ 080H
  3607 000018F4 A220                    	DB	2+NEEDOP+INTEGER,20H
  3608 000018F6 7374F0                  	DB	"st", 'p'+ 080H
  3609 000018F9 B318                    	DB	3+NEEDOP+INTEGER+EXTENDED,18H
  3610 000018FB 73F4                    	DB	"s", 't'+ 080H
  3611 000018FD A310                    	DB	3+NEEDOP+INTEGER,10H
  3612 000018FF 6D75EC                  	DB	"mu", 'l'+ 080H
  3613 00001902 A208                    	DB	2+NEEDOP+INTEGER,8
  3614 00001904 6469F6                  	DB	"di", 'v'+ 080H
  3615 00001907 A230                    	DB	2+NEEDOP+INTEGER,30H
  3616 00001909 737562F2                	DB	"sub", 'r'+ 080H
  3617 0000190D A228                    	DB	2+NEEDOP+INTEGER,28H
  3618 0000190F 646976F2                	DB	"div", 'r'+ 080H
  3619 00001913 A238                    	DB	2+NEEDOP+INTEGER,38H
  3620 00001915 636FED                  	DB	"co", 'm'+ 080H
  3621 00001918 A210                    	DB	2+NEEDOP+INTEGER,10H
  3622 0000191A 636F6DF0                	DB	"com", 'p'+ 080H
  3623 0000191E A218                    	DB	2+NEEDOP+INTEGER,18H
  3624 00001920 6E637374F0              	DB	"ncst", 'p'+ 080H
  3625 00001925 01F7                    	DB	1,0F7H
  3626 00001927 6E69F4                  	DB	"ni", 't'+ 080H
  3627 0000192A 03E3                    	DB	3,0E3H
  3628                                  
  3629                                  NDPL:
  3630 0000192C 0A                      	DB	10
  3631 0000192D E4                      	DB	'd' + 080H
  3632 0000192E F900                    	DB	1+NEEDOP+ONEREG+REAL+EXTENDED,0
  3633 00001930 64FA                    	DB	"d", 'z'+ 080H
  3634 00001932 01EE                    	DB	1,0EEH
  3635 00001934 64B1                    	DB	"d", '1'+ 080H
  3636 00001936 01E8                    	DB	1,0E8H
  3637 00001938 6470E9                  	DB	"dp", 'i'+ 080H
  3638 0000193B 01EB                    	DB	1,0EBH
  3639 0000193D 646C32F4                	DB	"dl2", 't'+ 080H
  3640 00001941 01E9                    	DB	1,0E9H
  3641 00001943 646C32E5                	DB	"dl2", 'e'+ 080H
  3642 00001947 01EA                    	DB	1,0EAH
  3643 00001949 646C67B2                	DB	"dlg", '2'+ 080H
  3644 0000194D 01EC                    	DB	1,0ECH
  3645 0000194F 646C6EB2                	DB	"dln", '2'+ 080H
  3646 00001953 01ED                    	DB	1,0EDH
  3647 00001955 6463F7                  	DB	"dc", 'w'+ 080H
  3648 00001958 9928                    	DB	1+NEEDOP+MEMORY,28H
  3649 0000195A 64656EF6                	DB	"den", 'v'+ 080H
  3650 0000195E 9920                    	DB	1+NEEDOP+MEMORY,20H
  3651                                  
  3652                                  NDPM:
  3653 00001960 02                      	DB	2
  3654 00001961 75EC                    	DB	"u", 'l'+ 080H
  3655 00001963 0EC9                    	DB	6+ARITH,0C9H
  3656 00001965 756CF0                  	DB	"ul", 'p'+ 080H
  3657 00001968 9008                    	DB	NEEDOP+STACKOP,8
  3658                                  
  3659                                  NDPO:
  3660 0000196A 01                      	DB	1
  3661 0000196B F0                      	DB	'p' + 080H
  3662 0000196C 8100                    	DB	NEEDOP+1,0	;Flag special handling
  3663                                  
  3664                                  NDPN:
  3665 0000196E 01                      	DB	1
  3666 0000196F 6FF0                    	DB	"o", 'p'+ 080H
  3667 00001971 01D0                    	DB	1,0D0H
  3668                                  
  3669                                  NDPP:
  3670 00001973 03                      	DB	3
  3671 00001974 7265ED                  	DB	"re", 'm'+ 080H
  3672 00001977 01F8                    	DB	1,0F8H
  3673 00001979 7461EE                  	DB	"ta", 'n'+ 080H
  3674 0000197C 01F2                    	DB	1,0F2H
  3675 0000197E 617461EE                	DB	"ata", 'n'+ 080H
  3676 00001982 01F3                    	DB	1,0F3H
  3677                                  
  3678                                  NDPR:
  3679 00001984 02                      	DB	2
  3680 00001985 6E64696EF4              	DB	"ndin", 't'+ 080H
  3681 0000198A 01FC                    	DB	1,0FCH
  3682 0000198C 73746FF2                	DB	"sto", 'r'+ 080H
  3683 00001990 9D20                    	DB	5+NEEDOP+MEMORY,20H
  3684                                  
  3685                                  NDPS:
  3686 00001992 0C                      	DB	12
  3687 00001993 F4                      	DB	't' + 080H
  3688 00001994 EDD0                    	DB	5+NEEDOP+ONEREG+REAL,0D0H
  3689 00001996 74F0                    	DB	"t", 'p'+ 080H
  3690 00001998 FFD8                    	DB	7+NEEDOP+ONEREG+REAL+EXTENDED,0D8H
  3691 0000199A 75E2                    	DB	"u", 'b'+ 080H
  3692 0000199C 0EE1                    	DB	6+ARITH,0E1H
  3693 0000199E 7562F0                  	DB	"ub", 'p'+ 080H
  3694 000019A1 90E0                    	DB	NEEDOP+STACKOP,0E0H
  3695 000019A3 7562F2                  	DB	"ub", 'r'+ 080H
  3696 000019A6 0EE9                    	DB	6+ARITH,0E9H
  3697 000019A8 756272F0                	DB	"ubr", 'p'+ 080H
  3698 000019AC 90E8                    	DB	NEEDOP+STACKOP,0E8H
  3699 000019AE 7172F4                  	DB	"qr", 't'+ 080H
  3700 000019B1 01FA                    	DB	1,0FAH
  3701 000019B3 63616CE5                	DB	"cal", 'e'+ 080H
  3702 000019B7 01FD                    	DB	1,0FDH
  3703 000019B9 6176E5                  	DB	"av", 'e'+ 080H
  3704 000019BC 9D30                    	DB	5+NEEDOP+MEMORY,30H
  3705 000019BE 7463F7                  	DB	"tc", 'w'+ 080H
  3706 000019C1 9938                    	DB	1+NEEDOP+MEMORY,38H
  3707 000019C3 74656EF6                	DB	"ten", 'v'+ 080H
  3708 000019C7 9930                    	DB	1+NEEDOP+MEMORY,30H
  3709 000019C9 7473F7                  	DB	"ts", 'w'+ 080H
  3710 000019CC 9D38                    	DB	5+NEEDOP+MEMORY,38H
  3711                                  
  3712                                  NDPT:
  3713 000019CE 01                      	DB	1
  3714 000019CF 73F4                    	DB	"s", 't'+ 080H
  3715 000019D1 01E4                    	DB	1,0E4H
  3716                                  
  3717                                  NDPW:
  3718 000019D3 01                      	DB	1
  3719 000019D4 6169F4                  	DB	"ai", 't'+ 080H
  3720 000019D7 8000                    	DB	NEEDOP,0	;Flag special handling
  3721                                  
  3722                                  NDPX:
  3723 000019D9 03                      	DB	3
  3724 000019DA 63E8                    	DB	"c", 'h'+ 080H
  3725 000019DC 41C9                    	DB	1+ONEREG,0C9H
  3726 000019DE 61ED                    	DB	"a", 'm'+ 080H
  3727 000019E0 01E5                    	DB	1,0E5H
  3728 000019E2 74726163F4              	DB	"trac", 't'+ 080H
  3729 000019E7 01F4                    	DB	1,0F4H
  3730                                  
  3731                                  NDPY:
  3732 000019E9 02                      	DB	2
  3733 000019EA 6C32F8                  	DB	"l2", 'x'+ 080H
  3734 000019ED 01F1                    	DB	1,0F1H
  3735 000019EF 6C327870B1              	DB	"l2xp", '1'+ 080H
  3736 000019F4 01F9                    	DB	1,0F9H
  3737                                  
  3738                                  
  3739                                  OPTAB:
  3740                                  ; Table of pointers  to mnemonics. For each letter of the alphabet (the
  3741                                  ; starting letter of the mnemonic), there are 5 entries. Each entry
  3742                                  ; corresponds to a mnemonic whose length is 2, 3, 4, 5, and 6 characters
  3743                                  ; long, respectively. If there are no mnemonics for a given combination
  3744                                  ; of first letter and length (such as A-2), then the corresponding entry
  3745                                  ; points to NONE. Otherwise, it points to a place in the mnemonic table
  3746                                  ; for that type.
  3747                                  
  3748                                  ; This table only needs to be modified if a mnemonic is added to a group
  3749                                  ; previously marked NONE. Change the NONE to a label made up of the first
  3750                                  ; letter of the mnemonic and its length, then add a new subsection to
  3751                                  ; the mnemonic table in alphabetical order.
  3752                                  
  3753 000019F6 [3515]                  	DW	NONE
  3754 000019F8 [3615]                  	DW	A3
  3755 000019FA [3515]                  	DW	NONE
  3756 000019FC [5A15]                  	DW	A5
  3757 000019FE [3515]                  	DW	NONE
  3758 00001A00 [3515]                  	DW	NONE	;B
  3759 00001A02 [3515]                  	DW	NONE
  3760 00001A04 [3515]                  	DW	NONE
  3761 00001A06 [3515]                  	DW	NONE
  3762 00001A08 [3515]                  	DW	NONE
  3763 00001A0A [3515]                  	DW	NONE	;C
  3764 00001A0C [6215]                  	DW	C3
  3765 00001A0E [8615]                  	DW	C4
  3766 00001A10 [9915]                  	DW	C5
  3767 00001A12 [3515]                  	DW	NONE
  3768 00001A14 [A815]                  	DW	D2	;D
  3769 00001A16 [BD15]                  	DW	D3
  3770 00001A18 [D215]                  	DW	D4
  3771 00001A1A [3515]                  	DW	NONE
  3772 00001A1C [3515]                  	DW	NONE
  3773 00001A1E [D915]                  	DW	E2	;E
  3774 00001A20 [DE15]                  	DW	E3
  3775 00001A22 [3515]                  	DW	NONE
  3776 00001A24 [EE15]                  	DW	E5
  3777 00001A26 [3515]                  	DW	NONE
  3778 00001A28 [3515]                  	DW	NONE	;F
  3779 00001A2A [3515]                  	DW	NONE
  3780 00001A2C [3515]                  	DW	NONE
  3781 00001A2E [3515]                  	DW	NONE
  3782 00001A30 [3515]                  	DW	NONE
  3783 00001A32 [3515]                  	DW	NONE	;G
  3784 00001A34 [3515]                  	DW	NONE
  3785 00001A36 [3515]                  	DW	NONE
  3786 00001A38 [3515]                  	DW	NONE
  3787 00001A3A [3515]                  	DW	NONE
  3788 00001A3C [3515]                  	DW	NONE	;H
  3789 00001A3E [F615]                  	DW	H3
  3790 00001A40 [FC15]                  	DW	H4
  3791 00001A42 [3515]                  	DW	NONE
  3792 00001A44 [3515]                  	DW	NONE
  3793 00001A46 [0316]                  	DW	I2	;I
  3794 00001A48 [0C16]                  	DW	I3
  3795 00001A4A [2116]                  	DW	I4
  3796 00001A4C [3515]                  	DW	NONE
  3797 00001A4E [3515]                  	DW	NONE
  3798 00001A50 [3A16]                  	DW	J2	;J
  3799 00001A52 [6316]                  	DW	J3
  3800 00001A54 [B916]                  	DW	J4
  3801 00001A56 [3515]                  	DW	NONE
  3802 00001A58 [3515]                  	DW	NONE
  3803 00001A5A [3515]                  	DW	NONE	;K
  3804 00001A5C [3515]                  	DW	NONE
  3805 00001A5E [3515]                  	DW	NONE
  3806 00001A60 [3515]                  	DW	NONE
  3807 00001A62 [3515]                  	DW	NONE
  3808 00001A64 [3515]                  	DW	NONE	;L
  3809 00001A66 [DE16]                  	DW	L3
  3810 00001A68 [EE16]                  	DW	L4
  3811 00001A6A [0D17]                  	DW	L5
  3812 00001A6C [2A17]                  	DW	L6
  3813 00001A6E [3515]                  	DW	NONE	;M
  3814 00001A70 [3B17]                  	DW	M3
  3815 00001A72 [4617]                  	DW	M4
  3816 00001A74 [5317]                  	DW	M5
  3817 00001A76 [3515]                  	DW	NONE
  3818 00001A78 [3515]                  	DW	NONE	;N
  3819 00001A7A [6217]                  	DW	N3
  3820 00001A7C [3515]                  	DW	NONE
  3821 00001A7E [3515]                  	DW	NONE
  3822 00001A80 [3515]                  	DW	NONE
  3823 00001A82 [7217]                  	DW	O2	;O
  3824 00001A84 [7717]                  	DW	O3
  3825 00001A86 [8217]                  	DW	O4
  3826 00001A88 [3515]                  	DW	NONE
  3827 00001A8A [3515]                  	DW	NONE
  3828 00001A8C [3515]                  	DW	NONE	;P
  3829 00001A8E [8F17]                  	DW	P3
  3830 00001A90 [9A17]                  	DW	P4
  3831 00001A92 [A717]                  	DW	P5
  3832 00001A94 [3515]                  	DW	NONE
  3833 00001A96 [3515]                  	DW	NONE	;Q
  3834 00001A98 [3515]                  	DW	NONE
  3835 00001A9A [3515]                  	DW	NONE
  3836 00001A9C [3515]                  	DW	NONE
  3837 00001A9E [3515]                  	DW	NONE
  3838 00001AA0 [3515]                  	DW	NONE	;R
  3839 00001AA2 [AF17]                  	DW	R3
  3840 00001AA4 [CE17]                  	DW	R4
  3841 00001AA6 [DB17]                  	DW	R5
  3842 00001AA8 [3515]                  	DW	NONE
  3843 00001AAA [3515]                  	DW	NONE	;S
  3844 00001AAC [EA17]                  	DW	S3
  3845 00001AAE [2218]                  	DW	S4
  3846 00001AB0 [4118]                  	DW	S5
  3847 00001AB2 [3515]                  	DW	NONE
  3848 00001AB4 [3515]                  	DW	NONE	;T
  3849 00001AB6 [3515]                  	DW	NONE
  3850 00001AB8 [5E18]                  	DW	T4
  3851 00001ABA [3515]                  	DW	NONE
  3852 00001ABC [3515]                  	DW	NONE
  3853 00001ABE [6518]                  	DW	U2	;U
  3854 00001AC0 [3515]                  	DW	NONE
  3855 00001AC2 [3515]                  	DW	NONE
  3856 00001AC4 [3515]                  	DW	NONE
  3857 00001AC6 [3515]                  	DW	NONE
  3858 00001AC8 [3515]                  	DW	NONE	;V
  3859 00001ACA [3515]                  	DW	NONE
  3860 00001ACC [3515]                  	DW	NONE
  3861 00001ACE [3515]                  	DW	NONE
  3862 00001AD0 [3515]                  	DW	NONE
  3863 00001AD2 [3515]                  	DW	NONE	;W
  3864 00001AD4 [3515]                  	DW	NONE
  3865 00001AD6 [6A18]                  	DW	W4
  3866 00001AD8 [3515]                  	DW	NONE
  3867 00001ADA [3515]                  	DW	NONE
  3868 00001ADC [3515]                  	DW	NONE	;X
  3869 00001ADE [7118]                  	DW	X3
  3870 00001AE0 [7718]                  	DW	X4
  3871 00001AE2 [3515]                  	DW	NONE
  3872 00001AE4 [3515]                  	DW	NONE
  3873 00001AE6 [3515]                  	DW	NONE	;Y
  3874 00001AE8 [3515]                  	DW	NONE
  3875 00001AEA [3515]                  	DW	NONE
  3876 00001AEC [3515]                  	DW	NONE
  3877 00001AEE [3515]                  	DW	NONE
  3878 00001AF0 [3515]                  	DW	NONE	;Z
  3879 00001AF2 [3515]                  	DW	NONE
  3880 00001AF4 [3515]                  	DW	NONE
  3881 00001AF6 [3515]                  	DW	NONE
  3882 00001AF8 [3515]                  	DW	NONE
  3883                                  
  3884                                  NDPTAB:
  3885                                  ;Lookup table for 8087 mnemonics. There is one entry for each letter of the
  3886                                  ;alphabet
  3887 00001AFA [8A18]                  	DW	NDPA
  3888 00001AFC [9818]                  	DW	NDPB
  3889 00001AFE [A218]                  	DW	NDPC
  3890 00001B00 [BB18]                  	DW	NDPD
  3891 00001B02 [DC18]                  	DW	NDPE
  3892 00001B04 [E118]                  	DW	NDPF
  3893 00001B06 [3515]                  	DW	NONE	;G
  3894 00001B08 [3515]                  	DW	NONE	;H
  3895 00001B0A [E718]                  	DW	NDPI
  3896 00001B0C [3515]                  	DW	NONE	;J
  3897 00001B0E [3515]                  	DW	NONE	;K
  3898 00001B10 [2C19]                  	DW	NDPL
  3899 00001B12 [6019]                  	DW	NDPM
  3900 00001B14 [6E19]                  	DW	NDPN
  3901 00001B16 [6A19]                  	DW	NDPO
  3902 00001B18 [7319]                  	DW	NDPP
  3903 00001B1A [3515]                  	DW	NONE	;Q
  3904 00001B1C [8419]                  	DW	NDPR
  3905 00001B1E [9219]                  	DW	NDPS
  3906 00001B20 [CE19]                  	DW	NDPT
  3907 00001B22 [3515]                  	DW	NONE	;U
  3908 00001B24 [3515]                  	DW	NONE	;V
  3909 00001B26 [D319]                  	DW	NDPW
  3910 00001B28 [D919]                  	DW	NDPX
  3911 00001B2A [E919]                  	DW	NDPY
  3912 00001B2C [3515]                  	DW	NONE	;Z
  3913                                  
  3914                                  ;Error message table
  3915                                  
  3916                                  ERRTAB:
  3917 00001B2E 015265676973746572-     	DB	1, "Register not allowed in immediate valu", 'e'+ 080H
  3917 00001B37 206E6F7420616C6C6F-
  3917 00001B40 77656420696E20696D-
  3917 00001B49 6D6564696174652076-
  3917 00001B52 616C75E5           
  3918 00001B56 02496E646578206F72-     	DB	2, "Index or base register must be BP, BX, SI, or D", 'I'+ 080H
  3918 00001B5F 206261736520726567-
  3918 00001B68 6973746572206D7573-
  3918 00001B71 742062652042502C20-
  3918 00001B7A 42582C2053492C206F-
  3918 00001B83 722044C9           
  3919 00001B87 034F6E6C79206F6E65-     	DB	3, "Only one base register (BX, BP) allowe", 'd'+ 080H
  3919 00001B90 206261736520726567-
  3919 00001B99 697374657220284258-
  3919 00001BA2 2C2042502920616C6C-
  3919 00001BAB 6F7765E4           
  3920 00001BAF 044F6E6C79206F6E65-     	DB	4, "Only one index register (SI or DI) allowe", 'd'+ 080H
  3920 00001BB8 20696E646578207265-
  3920 00001BC1 676973746572202853-
  3920 00001BCA 49206F722044492920-
  3920 00001BD3 616C6C6F7765E4     
  3921 00001BDA 054F6E6C7920616464-     	DB	5, "Only addition allowed on register or undefined labe", 'l'+ 080H
  3921 00001BE3 6974696F6E20616C6C-
  3921 00001BEC 6F776564206F6E2072-
  3921 00001BF5 65676973746572206F-
  3921 00001BFE 7220756E646566696E-
  3921 00001C07 6564206C616265EC   
  3922 00001C0F 064F6E6C79206F6E65-     	DB	6, "Only one undefined label per expression allowe", 'd'+ 080H
  3922 00001C18 20756E646566696E65-
  3922 00001C21 64206C6162656C2070-
  3922 00001C2A 657220657870726573-
  3922 00001C33 73696F6E20616C6C6F-
  3922 00001C3C 7765E4             
  3923 00001C3F 07496C6C6567616C20-     	DB	7, "Illegal digit in hexadecimal numbe", 'r'+ 080H
  3923 00001C48 646967697420696E20-
  3923 00001C51 68657861646563696D-
  3923 00001C5A 616C206E756D6265F2 
  3924 00001C63 08496C6C6567616C20-     	DB	8, "Illegal digit in decimal numbe", 'r'+ 080H
  3924 00001C6C 646967697420696E20-
  3924 00001C75 646563696D616C206E-
  3924 00001C7E 756D6265F2         
  3925 00001C83 0A496C6C6567616C20-     	DB	10, "Illegal character in label or opcod", 'e'+ 080H
  3925 00001C8C 636861726163746572-
  3925 00001C95 20696E206C6162656C-
  3925 00001C9E 206F72206F70636F64-
  3925 00001CA7 E5                 
  3926 00001CA8 0B4C6162656C206465-     	DB	11, "Label defined twic", 'e'+ 080H
  3926 00001CB1 66696E656420747769-
  3926 00001CBA 63E5               
  3927 00001CBC 0C4F70636F6465206E-     	DB	12, "Opcode not recognize", 'd'+ 080H
  3927 00001CC5 6F74207265636F676E-
  3927 00001CCE 697A65E4           
  3928 00001CD2 14496E76616C696420-     	DB	20, "Invalid operan", 'd'+ 080H
  3928 00001CDB 6F706572616EE4     
  3929 00001CE2 15222C202220616E64-     	DB	21, '", " and second operand expected'
  3929 00001CEB 207365636F6E64206F-
  3929 00001CF4 706572616E64206578-
  3929 00001CFD 706563746564       
  3930 00001D03 165265676973746572-     	DB	22, "Register mismatc", 'h'+ 080H
  3930 00001D0C 206D69736D617463E8 
  3931 00001D15 17496D6D6564696174-     	DB	23, "Immediate operand not allowe", 'd'+ 080H
  3931 00001D1E 65206F706572616E64-
  3931 00001D27 206E6F7420616C6C6F-
  3931 00001D30 7765E4             
  3932 00001D33 18225D222065787065-     	DB	24, '"]" expecte', 'd'+ 080H
  3932 00001D3C 637465E4           
  3933 00001D40 1954776F206D656D6F-     	DB	25, "Two memory operands not allowe", 'd'+ 080H
  3933 00001D49 7279206F706572616E-
  3933 00001D52 6473206E6F7420616C-
  3933 00001D5B 6C6F7765E4         
  3934 00001D60 1A44657374696E6174-     	DB	26, "Destination must not be immediate valu", 'e'+ 080H
  3934 00001D69 696F6E206D75737420-
  3934 00001D72 6E6F7420626520696D-
  3934 00001D7B 6D6564696174652076-
  3934 00001D84 616C75E5           
  3935 00001D88 1B426F7468206F7065-     	DB	27, "Both operands must not be register", 's'+ 080H
  3935 00001D91 72616E6473206D7573-
  3935 00001D9A 74206E6F7420626520-
  3935 00001DA3 7265676973746572F3 
  3936 00001DAC 1C4F706572616E6420-     	DB	28, "Operand must be segment registe", 'r'+ 080H
  3936 00001DB5 6D7573742062652073-
  3936 00001DBE 65676D656E74207265-
  3936 00001DC7 6769737465F2       
  3937 00001DCD 1D4669727374206F70-     	DB	29, "First operand must be registe", 'r'+ 080H
  3937 00001DD6 6572616E64206D7573-
  3937 00001DDF 742062652072656769-
  3937 00001DE8 737465F2           
  3938 00001DEC 1E556E646566696E65-     	DB	30, "Undefined label not allowe", 'd'+ 080H
  3938 00001DF5 64206C6162656C206E-
  3938 00001DFE 6F7420616C6C6F7765-
  3938 00001E07 E4                 
  3939 00001E08 1F56616C7565206F75-     	DB	31, "Value out of rang", 'e'+ 080H
  3939 00001E11 74206F662072616E67-
  3939 00001E1A E5                 
  3940 00001E1B 204D697373696E6720-     	DB	32, "Missing or illegal operand size fla", 'g'+ 080H
  3940 00001E24 6F7220696C6C656761-
  3940 00001E2D 6C206F706572616E64-
  3940 00001E36 2073697A6520666C61-
  3940 00001E3F E7                 
  3941 00001E40 214D75737420686176-     	DB	33, "Must have label on same lin", 'e'+ 080H
  3941 00001E49 65206C6162656C206F-
  3941 00001E52 6E2073616D65206C69-
  3941 00001E5B 6EE5               
  3942 00001E5D 235A65726F2D6C656E-     	DB	35, "Zero-length string illega", 'l'+ 080H
  3942 00001E66 67746820737472696E-
  3942 00001E6F 6720696C6C656761EC 
  3943 00001E78 24454E444946207769-     	DB	36, "ENDIF without I", 'F'+ 080H
  3943 00001E81 74686F75742049C6   
  3944 00001E89 254F6E652D63686172-     	DB	37, "One-character strings onl", 'y'+ 080H
  3944 00001E92 616374657220737472-
  3944 00001E9B 696E6773206F6E6CF9 
  3945 00001EA4 26496C6C6567616C20-     	DB	38, "Illegal expressio", 'n'+ 080H
  3945 00001EAD 65787072657373696F-
  3945 00001EB6 EE                 
  3946 00001EB7 27456E64206F662073-     	DB	39, "End of string not foun", 'd'+ 080H
  3946 00001EC0 7472696E67206E6F74-
  3946 00001EC9 20666F756EE4       
  3947 00001ECF 64556E646566696E65-     	DB	100, "Undefined labe", 'l'+ 080H
  3947 00001ED8 64206C616265EC     
  3948 00001EDF 6556616C7565206F75-     	DB	101, "Value out of range (forward", ')'+ 080H
  3948 00001EE8 74206F662072616E67-
  3948 00001EF1 652028666F72776172-
  3948 00001EFA 64A9               
  3949 00001EFC FF                      	DB	255
  3950                                  
  3951 00001EFD 2A2A2A2A2A20455252-     ERRMES:	DB	'***** ERROR: ', ' '+ 080H
  3951 00001F06 4F523A20A0         
  3952 00001F0B 0D0A46696C65206372-     NOSPAC:	DB	13,10,'File creation error',13,10,"$"
  3952 00001F14 656174696F6E206572-
  3952 00001F1D 726F720D0A24       
  3953 00001F23 0D0A496E7375666669-     NOMEM:	DB	13,10,'Insufficient memory',13,10,'$'
  3953 00001F2C 6369656E74206D656D-
  3953 00001F35 6F72790D0A24       
  3954 00001F3B 0D0A46696C65206E6F-     NOFILE:	DB	13,10,'File not found',13,10,'$'
  3954 00001F44 7420666F756E640D0A-
  3954 00001F4D 24                 
  3955 00001F4E 0D0A4469736B206675-     WRTERR:	DB	13,10,'Disk full',13,10,'$'
  3955 00001F57 6C6C0D0A24         
  3956 00001F5C 0D0A42616420646973-     BADDSK:	DB	13,10,'Bad disk specifier',13,10,'$'
  3956 00001F65 6B2073706563696669-
  3956 00001F6E 65720D0A24         
  3957 00001F73 0D0A0D0A4572726F72-     ERCNTM:	DB	13, 10, 13, 10, 'Error Count ', '='+ 080H
  3957 00001F7C 20436F756E7420BD   
  3958 00001F84 0D0A53796D626F6C20-     SYMSIZE:	DB	13, 10, 'Symbol Table size =', ' '+ 080H
  3958 00001F8D 5461626C652073697A-
  3958 00001F96 65203DA0           
  3959 00001F9A 467265652073706163-     FRESIZE:	DB	'Free space =       ', ' '+ 080H
  3959 00001FA3 65203D202020202020-
  3959 00001FAC 20A0               
  3960 00001FAE 0D0A53796D626F6C20-     SYMMES:	DB	13, 10, 'Symbol Tabl', 'e'+ 080H, 13, 10, 13, 10
  3960 00001FB7 5461626CE50D0A0D0A 
  3961 00001FC0 41534D0000              EXTEND:	DB	'ASM',0,0
  3962 00001FC5 05656E646966            IFEND:	DB	5,'endif'
  3963 00001FCB 026966                  IFNEST:	DB	2,'if'
  3964 00001FCE 7265F4                  RETSTR:	DB	're', 't'+ 080H
  3965 00001FD1 002020202020202020-     HEXFCB:	DB	0,'        HEX',0,0,0,0
  3965 00001FDA 48455800000000     
  3966 00001FE1 000000000000000000-     	DB	16 DUP(0)
  3966 00001FEA 00000000000000     
  3967 00001FF1 0000000000              	DB	0,0,0,0,0
  3968 00001FF6 002020202020202020-     LSTFCB:	DB	0,'        PRN',0,0,0,0
  3968 00001FFF 50524E00000000     
  3969 00002006 000000000000000000-     	DB	16 DUP(0)
  3969 0000200F 00000000000000     
  3970 00002016 0000000000              	DB	0,0,0,0,0
  3971 0000201B ????                    PC	RESW 1
  3971          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3972 0000201D ????                    OLDPC	RESW 1
  3972          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3973 0000201F ????                    LABPT	RESW 1
  3973          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3974 00002021 ??                      FLAG	RESB 1
  3974          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3975 00002022 ??                      MAXFLG	RESB 1
  3975          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3976 00002023 ????                    ADDR	RESW 1
  3976          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3977 00002025 ????                    ALABEL	RESW 1
  3977          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3978 00002027 ????                    DATA	RESW 1
  3978          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3979 00002029 ????                    DLABEL	RESW 1
  3979          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3980 0000202B ????                    CON		RESW 1
  3980          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3981 0000202D ????                    UNDEF	RESW 1
  3981          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3982 0000202F ??                      LENID	RESB 1
  3982          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3983 00002030 <res 50h>               ID	RESB 80
  3983          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3984 00002080 ??                      CHR	RESB 1
  3984          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3985 00002081 ??                      SYM	RESB 1
  3985          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3986 00002082 ????                    BASE	RESW 1
  3986          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3987 00002084 ????                    HEAP	RESW 1
  3987          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3988 00002086 ??                      SYMFLG	RESB 1
  3988          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3989 00002087 ??                      SYMLIN	RESB 1
  3989          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3990 00002088 ????                    CODE	RESW 1
  3990          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3991 0000208A ??                      DATSIZ	RESB 1
  3991          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3992 0000208B ??                      RELOC	RESB 1
  3992          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3993 0000208C ??                      BCOUNT	RESB 1
  3993          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3994 0000208D ??                      COUNT	RESB 1
  3994          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3995 0000208E ??                      ERR	RESB 1
  3995          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3996 0000208F ????                    LINE	RESW 1
  3996          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3997 00002091 ????                    HEXLEN	RESW 1
  3997          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3998 00002093 ????                    HEXADD	RESW 1
  3998          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  3999 00002095 ????                    LASTAD	RESW 1
  3999          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4000 00002097 ??                      HEXCNT	RESB 1
  4000          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4001 00002098 ??                      CHKSUM	RESB 1
  4001          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4002 00002099 ??                      LINFLG	RESB 1
  4002          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4003 0000209A ??                      PREV	RESB 1
  4003          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4004 0000209B ??                      IFFLG	RESB 1
  4004          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4005 0000209C ??                      CHKLAB	RESB 1
  4005          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4006 0000209D ????                    ERRCNT	RESW 1
  4006          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4007 0000209F ????                    LSTRET	RESW 1
  4007          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4008 000020A1 ????                    RETPT	RESW 1
  4008          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4009 000020A3 ????                    LSTDEV	RESW 1
  4009          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4010 000020A5 ??                      SPC	RESB 1
  4010          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4011 000020A6 ??                      NOWAIT	RESB 1
  4011          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4012 000020A7 ????                    IX	RESW 1
  4012          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4013 000020A9 ????                    IY	RESW 1
  4013          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4014 000020AB ????                    HEXPNT	RESW 1
  4014          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4015 000020AD ????                    LSTPNT	RESW 1
  4015          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4016 000020AF <res 46h>               HEXBUF	RESB HEXBUFSIZ
  4016          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4017 000020F5 <res 400h>              LSTBUF	RESB LSTBUFSIZ
  4017          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4018 000024F5 ????                    BUFPT	RESW 1
  4018          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4019 000024F7 <res 400h>              SRCBUF	RESB BUFSIZ
  4019          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4020 000028F7 <res 100h>              	RESB	100H
  4020          ******************       warning: uninitialized space declared in .text section: zeroing [-w+zeroing]
  4021 000029F7 90                      	ALIGN 2
  4022                                  STACK	EQU	$
  4023                                  START	EQU	$
